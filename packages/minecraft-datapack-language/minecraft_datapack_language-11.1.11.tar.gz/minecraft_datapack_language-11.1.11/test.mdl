// test.mdl - Simplified MDL Project (Minecraft 1.21+)
// Uses pack format 82+ with new directory structure (function/ instead of functions/)
pack "test" "A simplified MDL datapack" 82;

namespace "test";

// Number variables for scoreboard storage
var num player_count = 0;
var num game_timer = 0;
var num player_score = 0;

function "main" {
    // Basic variable assignment
    player_count = 0;
    game_timer = 0;
    player_score = 100;
    
    // While loop with counter
    while "$game_timer$ < 10" {
        game_timer = $game_timer$ + 1;
        say "Timer: $game_timer$";
    }
}

function "helper" {
    var num result = 0;
    result = 5 + 3;
    say "Calculation result: $result$";
    
    // Variable substitution in tellraw
    tellraw @a [{"text":"Score: "},{"score":{"name":"@a","objective":"player_score"}}];
}

// Hook to run main function every tick
on_load "test:main";

// Registry types with inline JSON
recipe "diamond_sword" {
  "type": "minecraft:crafting_shaped",
  "pattern": [
    " D ",
    " D ",
    " S "
  ],
  "key": {
    "D": {
      "item": "minecraft:diamond"
    },
    "S": {
      "item": "minecraft:stick"
    }
  },
  "result": {
    "item": "minecraft:diamond_sword",
    "count": 1
  }
}

loot_table "diamond_sword" {
  "type": "minecraft:block",
  "pools": [
    {
      "rolls": 1,
      "entries": [
        {
          "type": "minecraft:item",
          "name": "minecraft:diamond_sword",
          "functions": [
            {
              "function": "minecraft:enchant_randomly",
              "enchantments": [
                "minecraft:sharpness",
                "minecraft:looting"
              ]
            }
          ]
        }
      ]
    }
  ]
}

advancement "diamond_sword" {
  "display": {
    "icon": {
      "item": "minecraft:diamond_sword"
    },
    "title": {
      "text": "Diamond Sword"
    },
    "description": {
      "text": "Craft a diamond sword"
    }
  },
  "criteria": {
    "crafted": {
      "trigger": "minecraft:recipe_crafted",
      "conditions": {
        "recipe_id": "minecraft:diamond_sword"
      }
    }
  }
}

predicate "diamond_sword" {
  "condition": "minecraft:entity_properties",
  "entity": "this",
  "predicate": {
    "equipment": {
      "mainhand": {
        "item": "minecraft:diamond_sword"
      }
    }
  }
}

item_modifier "diamond_sword" {
  "function": "minecraft:set_nbt",
  "tag": "{CustomName:'{\"text\":\"Diamond Sword\"}'}"
}

structure "diamond_sword" {
  "type": "minecraft:jigsaw",
  "start_pool": "minecraft:empty",
  "size": 1,
  "max_distance_from_center": 80
}
