<!-- Custom head content -->
<!-- viewport is defined in layouts; avoid duplicates that can cause inconsistencies -->

<!-- Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="{{ '/icons/favicon-32.png' | relative_url }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ '/icons/favicon-16.png' | relative_url }}">
<link rel="icon" type="image/png" sizes="64x64" href="{{ '/icons/favicon-64.png' | relative_url }}">
<link rel="icon" type="image/png" sizes="48x48" href="{{ '/icons/favicon-48.png' | relative_url }}">
<link rel="apple-touch-icon" sizes="180x180" href="{{ '/icons/icon-128.png' | relative_url }}">
<meta name="theme-color" content="#0366d6">

<script>
  // Simple naive syntax highlighter (like VSCode)
  function highlightMDL(codeElement) {
    let content = codeElement.innerHTML;
    
    // Comments (// and /* */)
    content = content.replace(/\/\*[\s\S]*?\*\//g, '<span class="comment">$&</span>');
    content = content.replace(/\/\/.*$/gm, '<span class="comment">$&</span>');
    
    // Strings (quoted text)
    content = content.replace(/"([^"]*)"/g, '<span class="string">"$1"</span>');
    content = content.replace(/'([^']*)'/g, '<span class="string">\'$1\'</span>');
    
    // Keywords
    const keywords = ['pack', 'namespace', 'function', 'on_tick', 'on_load', 'tag', 'add', 'if', 'else if', 'else', 'while', 'for', 'in', 'var', 'let', 'const', 'num', 'str', 'list', 'try', 'catch', 'throw', 'switch', 'case', 'default', 'break', 'continue', 'return', 'import', 'from', 'as', 'recipe', 'loot_table', 'advancement', 'predicate', 'item_modifier', 'structure', 'scope', 'global'];
    keywords.forEach(keyword => {
      const regex = new RegExp(`\\b${keyword}\\b`, 'g');
      content = content.replace(regex, '<span class="keyword">$&</span>');
    });
    
    // Builtins (Minecraft commands)
    const builtins = ['say', 'tellraw', 'effect', 'particle', 'execute', 'scoreboard', 'data', 'function', 'tag', 'tp', 'kill', 'summon', 'give', 'clear', 'enchant', 'gamemode', 'weather', 'time', 'difficulty', 'gamerule', 'title', 'playsound', 'stopsound', 'kick', 'ban', 'ban-ip', 'pardon', 'pardon-ip', 'whitelist', 'op', 'deop', 'save-all', 'save-off', 'save-on', 'list', 'me', 'msg', 'team', 'trigger', 'advancement', 'recipe', 'loot', 'schedule', 'return', 'run'];
    builtins.forEach(builtin => {
      const regex = new RegExp(`\\b${builtin}\\b`, 'g');
      content = content.replace(regex, '<span class="builtin">$&</span>');
    });
    
    // Selectors
    content = content.replace(/\b(@p|@r|@a|@e|@s)\b/g, '<span class="selector">$&</span>');
    
    // Booleans and null
    content = content.replace(/\b(true|false|null|undefined)\b/g, '<span class="boolean">$&</span>');
    
    // Numbers
    content = content.replace(/\b\d+\b/g, '<span class="number">$&</span>');
    
    // Operators
    content = content.replace(/(\+|-|\*|\/|%|=|==|!=|<|>|<=|>=|&&|\|\||!|\+=|-=|\*=|\/=|%=)/g, '<span class="operator">$&</span>');
    
    codeElement.innerHTML = content;
  }
  
  // Theme management
  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    
    // Re-highlight all MDL code blocks
    document.querySelectorAll('code.language-mdl').forEach(highlightMDL);
  }
  
  // Initialize theme
  function initTheme() {
    const savedTheme = localStorage.getItem('theme');
    const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    const theme = savedTheme || systemTheme;
    setTheme(theme);
  }
  
  // Theme toggle
  function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    setTheme(newTheme);
  }
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    initTheme();
    
    // Highlight all MDL code blocks
    document.querySelectorAll('code.language-mdl').forEach(highlightMDL);
    
    // Set up theme toggle
    const themeToggle = document.querySelector('.theme-toggle, #themeToggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
    }
    
    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
      if (!localStorage.getItem('theme')) {
        setTheme(e.matches ? 'dark' : 'light');
      }
    });
  });
  
  // Re-highlight when content changes (for dynamic content)
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      mutation.addedNodes.forEach(function(node) {
        if (node.nodeType === 1) { // Element node
          if (node.classList && node.classList.contains('language-mdl')) {
            highlightMDL(node);
          }
          const mdlBlocks = node.querySelectorAll && node.querySelectorAll('code.language-mdl');
          if (mdlBlocks) {
            mdlBlocks.forEach(highlightMDL);
          }
        }
      });
    });
  });
  
  // Start observing
  document.addEventListener('DOMContentLoaded', function() {
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  });
</script>

<!-- Simple Dark Mode Styles -->
<style>
/* Dark mode styles */
[data-theme="dark"] {
  background-color: #0d1117 !important;
  color: #c9d1d9 !important;
}

[data-theme="dark"] body {
  background-color: #0d1117 !important;
  color: #c9d1d9 !important;
}

[data-theme="dark"] .main-content {
  background-color: #0d1117 !important;
  color: #c9d1d9 !important;
}

[data-theme="dark"] .post {
  background-color: #0d1117 !important;
  color: #c9d1d9 !important;
}

[data-theme="dark"] .post h1,
[data-theme="dark"] .post h2,
[data-theme="dark"] .post h3,
[data-theme="dark"] .post h4,
[data-theme="dark"] .post h5,
[data-theme="dark"] .post h6 {
  color: #e6edf3 !important;
}

[data-theme="dark"] .post p,
[data-theme="dark"] .post li {
  color: #c9d1d9 !important;
}

[data-theme="dark"] .post a {
  color: #58a6ff !important;
}

[data-theme="dark"] .post a:hover {
  color: #79c0ff !important;
}

[data-theme="dark"] h1,
[data-theme="dark"] h2,
[data-theme="dark"] h3,
[data-theme="dark"] h4,
[data-theme="dark"] h5,
[data-theme="dark"] h6 {
  color: #e6edf3 !important;
}

[data-theme="dark"] p,
[data-theme="dark"] li {
  color: #c9d1d9 !important;
}

[data-theme="dark"] a {
  color: #58a6ff !important;
}

[data-theme="dark"] a:hover {
  color: #79c0ff !important;
}

[data-theme="dark"] code {
  background-color: #21262d !important;
  color: #e6edf3 !important;
  border-color: #30363d !important;
}

[data-theme="dark"] pre {
  background-color: #161b22 !important;
  border-color: #30363d !important;
  color: #e6edf3 !important;
}

[data-theme="dark"] .highlight {
  background-color: #161b22 !important;
  border-color: #30363d !important;
}

[data-theme="dark"] .highlight pre {
  background-color: #161b22 !important;
  color: #e6edf3 !important;
}

[data-theme="dark"] .highlight code {
  background-color: transparent !important;
  color: #e6edf3 !important;
}

[data-theme="dark"] table {
  background-color: #161b22 !important;
  border-color: #30363d !important;
}

[data-theme="dark"] th {
  background-color: #21262d !important;
  border-color: #30363d !important;
  color: #e6edf3 !important;
}

[data-theme="dark"] td {
  border-color: #30363d !important;
  color: #c9d1d9 !important;
}

[data-theme="dark"] blockquote {
  background-color: #161b22 !important;
  border-left-color: #58a6ff !important;
  color: #c9d1d9 !important;
}

[data-theme="dark"] hr {
  border-color: #30363d !important;
}

[data-theme="dark"] .site-footer {
  background-color: #161b22 !important;
  color: #c9d1d9 !important;
  border-top-color: #30363d !important;
}

[data-theme="dark"] .site-footer a {
  color: #58a6ff !important;
}

[data-theme="dark"] .site-footer a:hover {
  color: #79c0ff !important;
}

/* Only override navigation colors in dark mode to prevent theme interference */
[data-theme="dark"] .nav-menu .nav-link,
[data-theme="dark"] .nav-menu .nav-link:visited,
[data-theme="dark"] .nav-menu .nav-link:hover,
[data-theme="dark"] .nav-menu .nav-link:active {
  color: rgba(255, 255, 255, 0.85) !important;
}

[data-theme="dark"] .nav-menu .nav-link:hover {
  color: #ffffff !important;
}

[data-theme="dark"] .nav-menu .nav-link.active {
  color: #ffffff !important;
}

[data-theme="dark"] .nav-menu .nav-icon-link,
[data-theme="dark"] .nav-menu .nav-icon-link:hover,
[data-theme="dark"] .nav-menu .nav-icon-link:active {
  color: #ffffff !important;
}

[data-theme="dark"] .nav-menu .theme-toggle,
[data-theme="dark"] .nav-menu .theme-toggle:hover,
[data-theme="dark"] .nav-menu .theme-toggle:active {
  color: #ffffff !important;
}

[data-theme="dark"] .nav-menu .nav-toggle,
[data-theme="dark"] .nav-menu .nav-toggle:hover,
[data-theme="dark"] .nav-menu .nav-toggle:active {
  color: #ffffff !important;
}

/* MDL Syntax Highlighting - Light Mode */
pre code.language-mdl .token.keyword,
code.language-mdl .token.keyword,
.language-mdl .token.keyword {
  color: #d73a49 !important;
  font-weight: 600 !important;
}

pre code.language-mdl .token.builtin,
code.language-mdl .token.builtin,
.language-mdl .token.builtin {
  color: #6f42c1 !important;
  font-weight: 500 !important;
}

pre code.language-mdl .token.selector,
code.language-mdl .token.selector,
.language-mdl .token.selector {
  color: #e36209 !important;
  font-weight: 600 !important;
}

pre code.language-mdl .token.string,
code.language-mdl .token.string,
.language-mdl .token.string {
  color: #032f62 !important;
}

pre code.language-mdl .token.comment,
code.language-mdl .token.comment,
.language-mdl .token.comment {
  color: #6a737d !important;
  font-style: italic !important;
}

pre code.language-mdl .token.number,
code.language-mdl .token.number,
.language-mdl .token.number {
  color: #005cc5 !important;
  font-weight: 500 !important;
}

pre code.language-mdl .token.boolean,
code.language-mdl .token.boolean,
.language-mdl .token.boolean {
  color: #005cc5 !important;
  font-weight: 500 !important;
}

pre code.language-mdl .token.operator,
code.language-mdl .token.operator,
.language-mdl .token.operator {
  color: #d73a49 !important;
  font-weight: 500 !important;
}

pre code.language-mdl .token.punctuation,
code.language-mdl .token.punctuation,
.language-mdl .token.punctuation {
  color: #24292e !important;
}

/* MDL Syntax Highlighting - Dark Mode */
[data-theme="dark"] pre code.language-mdl .token.keyword,
[data-theme="dark"] code.language-mdl .token.keyword,
[data-theme="dark"] .language-mdl .token.keyword {
  color: #ff7b72 !important;
}

[data-theme="dark"] pre code.language-mdl .token.builtin,
[data-theme="dark"] code.language-mdl .token.builtin,
[data-theme="dark"] .language-mdl .token.builtin {
  color: #d2a8ff !important;
}

[data-theme="dark"] pre code.language-mdl .token.selector,
[data-theme="dark"] code.language-mdl .token.selector,
[data-theme="dark"] .language-mdl .token.selector {
  color: #ffa657 !important;
}

[data-theme="dark"] pre code.language-mdl .token.string,
[data-theme="dark"] code.language-mdl .token.string,
[data-theme="dark"] .language-mdl .token.string {
  color: #a5d6ff !important;
}

[data-theme="dark"] pre code.language-mdl .token.comment,
[data-theme="dark"] code.language-mdl .token.comment,
[data-theme="dark"] .language-mdl .token.comment {
  color: #8b949e !important;
}

[data-theme="dark"] pre code.language-mdl .token.number,
[data-theme="dark"] code.language-mdl .token.number,
[data-theme="dark"] .language-mdl .token.number {
  color: #79c0ff !important;
}

[data-theme="dark"] pre code.language-mdl .token.boolean,
[data-theme="dark"] code.language-mdl .token.boolean,
[data-theme="dark"] .language-mdl .token.boolean {
  color: #79c0ff !important;
}

[data-theme="dark"] pre code.language-mdl .token.operator,
[data-theme="dark"] code.language-mdl .token.operator,
[data-theme="dark"] .language-mdl .token.operator {
  color: #ff7b72 !important;
}

[data-theme="dark"] pre code.language-mdl .token.punctuation,
[data-theme="dark"] code.language-mdl .token.punctuation,
[data-theme="dark"] .language-mdl .token.punctuation {
  color: #c9d1d9 !important;
}

/* Override any default Prism colors for MDL */
.language-mdl .token {
  color: #24292e !important;
}

[data-theme="dark"] .language-mdl .token {
  color: #c9d1d9 !important;
}

/* Fix code block sizing */
pre[class*="language-"],
pre,
.highlight,
.highlight pre {
  background-color: #f6f8fa !important;
  border: 1px solid #e1e4e8 !important;
  border-radius: 6px;
  margin: 1rem 0;
  color: #24292e !important;
  font-size: 0.9rem !important;
  line-height: 1.4 !important;
  padding: 1rem !important;
  overflow-x: auto !important;
  max-width: 100% !important;
}

[data-theme="dark"] pre[class*="language-"],
[data-theme="dark"] pre,
[data-theme="dark"] .highlight,
[data-theme="dark"] .highlight pre {
  background-color: #0d1117 !important;
  border: 1px solid #30363d !important;
  color: #c9d1d9 !important;
}

code[class*="language-"],
code,
.highlight code {
  font-size: 0.9rem !important;
  color: #24292e !important;
  background-color: transparent !important;
  padding: 0 !important;
  border: none !important;
}

[data-theme="dark"] code[class*="language-"],
[data-theme="dark"] code,
[data-theme="dark"] .highlight code {
  color: #c9d1d9 !important;
}

/* Feature grid styles */
.features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 2rem;
  margin: 2rem 0;
}

.feature {
  padding: 1.5rem;
  border: 1px solid #e1e4e8;
  border-radius: 6px;
  background: #f6f8fa;
  text-align: center;
}

[data-theme="dark"] .feature {
  background: #161b22;
  border-color: #30363d;
}

.feature h3 {
  margin-top: 0;
  color: #24292e;
}

[data-theme="dark"] .feature h3 {
  color: #e6edf3;
}

.feature p {
  margin-bottom: 0;
  color: #586069;
}

[data-theme="dark"] .feature p {
  color: #c9d1d9;
}

/* Docs grid styles */
.docs-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 1.5rem;
  margin: 2rem 0;
}

.doc-card {
  background: #ffffff;
  border: 1px solid #e1e4e8;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: transform 0.2s, box-shadow 0.2s;
}

[data-theme="dark"] .doc-card {
  background: #161b22;
  border-color: #30363d;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.doc-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

[data-theme="dark"] .doc-card:hover {
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}

.doc-card h3 {
  margin: 0 0 0.5rem 0;
  color: #24292e;
  font-size: 1.1rem;
}

[data-theme="dark"] .doc-card h3 {
  color: #e6edf3;
}

.doc-card p {
  color: #586069;
  margin-bottom: 1rem;
}

[data-theme="dark"] .doc-card p {
  color: #c9d1d9;
}

.doc-meta {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.category {
  background: #f1f3f4;
  color: #586069;
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
}

[data-theme="dark"] .category {
  background: #21262d;
  color: #c9d1d9;
}

.doc-link {
  display: inline-block;
  color: #0366d6;
  text-decoration: none;
  font-weight: 600;
  border: 2px solid #0366d6;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  transition: all 0.2s ease;
}

[data-theme="dark"] .doc-link {
  color: #58a6ff;
  border-color: #58a6ff;
}

.doc-link:hover {
  background: #0366d6;
  color: #ffffff;
  text-decoration: none;
}

[data-theme="dark"] .doc-link:hover {
  background: #58a6ff;
  color: #0d1117;
}

/* Responsive design */
@media (max-width: 768px) {
  .features,
  .docs-grid {
    grid-template-columns: 1fr;
  }
}
</style>
