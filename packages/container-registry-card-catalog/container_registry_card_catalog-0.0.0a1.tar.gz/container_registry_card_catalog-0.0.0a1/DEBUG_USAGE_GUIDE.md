# Debug Usage Guide

<!--
AI Attribution (AIA) Notice:
- Generated by: Claude (Anthropic AI Assistant)
- Session Date: 2025-08-25
- Vibe-Coder: Andrew Potozniak <potozniak@redhat.com>
-->

## Overview

Container Registry Card Catalog provides **dual debug systems** to help troubleshoot both TUI operations and registry API interactions. This guide explains how to use both debug systems effectively.

## Debug System Architecture

### **1. TUI Operations Debug Logging (`--debug` flag)**
- **Purpose**: Track TUI state changes, user interactions, navigation
- **Output**: File-based logging with timestamps (no console output to avoid TUI corruption)
- **Security**: Comprehensive credential masking
- **Use Case**: Troubleshoot UI bugs, config issues, application flow

### **2. API Debug Console (Ctrl+D in TUI)**
- **Purpose**: Monitor HTTP requests, authentication flows, API calls
- **Output**: Real-time interactive console within TUI
- **Security**: Credential masking for auth headers and tokens
- **Use Case**: Debug registry connections, auth failures, API issues

## TUI Debug Logging Usage

### **Basic Usage**
```bash
# Enable TUI debug logging (default location, minimal noise)
./container_registry_card_catalog.py --debug

# Enable verbose debug (includes httpcore/httpx HTTP library debug)
./container_registry_card_catalog.py --verbose-debug

# Custom debug log location
./container_registry_card_catalog.py --debug --debug-location /home/user/debug.log

# Debug with mock registries
./container_registry_card_catalog.py --debug --mock

# Debug with real registries (standard debug level)
./container_registry_card_catalog.py --debug --registry quay.io --registry docker.io

# Verbose debug for troubleshooting HTTP/auth issues
./container_registry_card_catalog.py --verbose-debug --registry quay.io
```

### **Default Debug Log Location**
```
/tmp/container-registry-tui-debug.log
```

### **Log Format**
```
TIMESTAMP [TUI-DEBUG] LOGGER: MESSAGE | key=value, sensitive_key=masked_value
```

### **Example Log Output**
```
2025-08-25 14:23:45,123 [TUI-DEBUG] TUI-Operations: Starting Container Registry Card Catalog | debug_enabled=True, debug_location=/tmp/container-registry-tui-debug.log
2025-08-25 14:23:45,124 [TUI-DEBUG] TUI-Operations: Configuration parsed | registries=[], local_runtimes=[], mock_mode=True
2025-08-25 14:23:45,125 [TUI-DEBUG] TUI-Operations: Using default mock registries | count=6
2025-08-25 14:23:47,234 [TUI-DEBUG] TUI-Operations: Registry configuration saved | registry_url=quay.io, auth_type=token_auth, username=myorg+robot, password=abc...xyz
2025-08-25 14:23:48,456 [TUI-DEBUG] TUI-Operations: Navigating to repository view | registry_name=Quay.io, mock_mode=False
2025-08-25 14:23:50,789 [TUI-DEBUG] TUI-Operations: Registry status check completed | registry_url=quay.io, status=✅, repo_count=245
```

### **What Gets Logged**
- Application startup and configuration parsing
- Command line argument processing
- Registry configuration saves and updates
- Authentication configuration (with masked credentials)
- WWW-Authenticate header discovery and parsing
- Token authentication flows and expiration
- Screen navigation and state transitions
- Registry status checks and updates
- User interactions and key events
- Error conditions and exceptions
- Application shutdown

## API Debug Console Usage

### **Accessing the Console**
1. Start the TUI application
2. Press **Ctrl+D** to open the debug console
3. Console shows real-time API interactions
4. Press **Escape** to return to main interface

### **What the Console Shows**
- HTTP request URLs and methods
- Authentication header generation
- Token requests and responses
- Registry API calls (catalog, repositories, tags)
- Response status codes and timing
- Error messages and retry attempts
- Performance metrics

### **Example Console Output**
```
14:23:45.123  TEST   Testing registry configuration for quay.io                ✅  245ms
14:23:45.234  GET    quay.io/v2/                                              ✅  122ms  
14:23:45.445  POST   quay.io/v2/auth                                          ✅  289ms
14:23:45.734  GET    quay.io/v2/_catalog                                      ✅  356ms
14:23:46.001  PERF   performance_test                                         ✅  156ms
14:23:46.157  TEST   Configuration test completed for quay.io                ✅  1034ms
```

## Security Features

### **Credential Masking**
Both debug systems automatically mask sensitive information:

**Sensitive Keywords Detected:**
- password, passwd, pass, passphrase, pwd
- token, credential, cred, creds, credentials
- auth, authorization, authenticate, bearer, basic
- key, secret, private, api_key, apikey, access_key
- robot, service_account, service_key
- oauth, jwt, access_token, refresh_token
- registry_token, docker_token, quay_token

**Masking Format:**
- **Short values (≤8 chars)**: `[REDACTED]`
- **Long values (>8 chars)**: `abc...xyz` (first 3 + last 3 characters)

**Examples:**
```
username=myorg+robot, password=abc...xyz
auth_type=token_auth, token=eyJ...T9A
authorization_header=Bea...123
```

## Troubleshooting Workflows

### **Authentication Issues**
1. **Enable TUI debug**: `--debug` to track config saves
2. **Check API console**: Ctrl+D to see auth flow
3. **Look for patterns**:
   - TUI: "Registry configuration saved" messages
   - API: Token request/response details
   - API: "Invalid bearer token" errors

### **Registry Connection Problems**
1. **TUI debug**: Monitor "Registry status check" messages
2. **API console**: Watch HTTP status codes and response times
3. **Check for**:
   - Network timeouts
   - SSL/TLS issues
   - Authentication failures
   - Rate limiting

### **UI Navigation Issues**
1. **TUI debug**: Track "Navigating to" messages
2. **Look for**:
   - Screen transition failures
   - State update problems
   - Key event handling issues

### **Configuration Problems**
1. **TUI debug**: Monitor config parsing and saves
2. **Check for**:
   - Invalid registry URLs
   - Auth type mismatches
   - Credential format issues

## Command Line Reference

### **Debug Flags**
```bash
--debug                    # Enable TUI operations debug logging (minimal noise)
--verbose-debug            # Enable verbose debug (includes HTTP libraries)
--debug-location PATH      # Custom debug log file path
```

### **Other Useful Flags for Debugging**
```bash
--mock                     # Use mock data for testing
--registry URL             # Add specific registry
--local podman             # Add local container runtime
```

### **Complete Debug Examples**
```bash
# Standard debug setup with custom log location
./container_registry_card_catalog.py \
  --debug \
  --debug-location /home/user/tui-debug.log \
  --registry quay.io \
  --registry docker.io

# Verbose debug for HTTP troubleshooting
./container_registry_card_catalog.py \
  --verbose-debug \
  --debug-location /home/user/verbose-debug.log \
  --registry quay.io

# Debug mock mode for UI testing
./container_registry_card_catalog.py --debug --mock

# Debug local container runtime
./container_registry_card_catalog.py --debug --local podman
```

## Log Analysis Tips

### **Finding Common Issues**
```bash
# Search for authentication problems
grep -i "auth\|token\|401\|403" /tmp/container-registry-tui-debug.log

# Find navigation issues
grep -i "navigating\|screen\|transition" /tmp/container-registry-tui-debug.log

# Look for configuration problems
grep -i "config\|saved\|parsed" /tmp/container-registry-tui-debug.log

# Find performance issues
grep -i "response_time\|timeout\|slow" /tmp/container-registry-tui-debug.log
```

### **Understanding Log Patterns**
- **INFO level**: Major operations (startup, config saves, navigation)
- **DEBUG level**: Detailed state information and intermediate steps
- **ERROR level**: Exception conditions and failures

## Best Practices

### **When to Use Each Debug System**
- **TUI Debug**: Configuration issues, UI bugs, application flow problems
- **API Debug**: Authentication failures, HTTP errors, registry connectivity

### **Performance Considerations**
- Debug logging adds minimal overhead
- File-only logging prevents TUI corruption (no console output)
- API console updates in real-time during operations
- Large repositories may generate extensive API debug output

### **Security Guidelines**
- Debug logs safe to share (credentials automatically masked)
- Verify masking before sharing logs externally
- Use custom debug location for sensitive environments

## Integration with Development

### **Continuous Debugging**
```bash
# Monitor debug log in real-time
tail -f /tmp/container-registry-tui-debug.log

# Filter for specific patterns
tail -f /tmp/container-registry-tui-debug.log | grep -i "error\|auth"
```

### **Automated Testing**
Debug logs can be parsed programmatically for automated testing and monitoring.

---

This dual debug system provides comprehensive visibility into both TUI operations and registry API interactions, enabling effective troubleshooting while maintaining security through automatic credential masking.