name: Testing different platforms

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  test-platforms:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        python-version: ["3.9", "3.10", "3.11"] # match those in tox.ini

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}

      - name: Run Pip-Based Tests
        run: |
          pip install pytest pandas
          pip install -e .
          pytest

      - name: Set up Miniconda
        uses: conda-incubator/setup-miniconda@v2
        with:
          miniconda-version: "latest"
          python-version: ${{ matrix.python-version }}
          environment-file: env-ci.yml
          activate-environment: test-env

      - name: Run Conda-Based Tests
        run: |
          pip install pytest pandas
          pip install -e .
          pytest

# jobs:
#   test-platforms:
#     runs-on: ${{ matrix.os }}
#     strategy:
#       matrix:
#         os: [ubuntu-latest, macos-latest]
#         python-version: ["3.9", "3.10", "3.11"] # match those in tox.ini

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3

#       - name: Set up Python
#         uses: actions/setup-python@v4
#         with:
#           python-version: ${{ matrix.python-version }}

#       # - name: Install Tox
#       #   run: python -m pip install tox

#       # - name: Run Pip-Based Tests
#       #   run: tox -e py${{ matrix.python-version }}

#       - name: Set up Miniconda
#         uses: conda-incubator/setup-miniconda@v2
#         with:
#           miniconda-version: "latest"
#           python-version: ${{ matrix.python-version }}

#       - name: Modify env-ci.yml with Python version
#         run: |
#           sed -i.bak "s/python/python=${{ matrix.python-version }}/g" env-ci.yml
#           less env-ci.yml

#           # run: |
#           # sed 's/python/python=${{ matrix.python-version }}/g' env-ci.yml > env-ci-${{ matrix.python-version }}.yml
#           # less env-ci-${{ matrix.python-version }}.yml

#       - name: Create conda environment
#         run: |
#           conda env create -f env-ci.yml

#       - name: Run Conda-Based Tests
#         run: |
#           conda init
#           source ~/.bashrc
#           conda activate test-env
#           pip install pytest pandas
#           pip install -e .
#           pytest
