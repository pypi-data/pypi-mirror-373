[project]

name = "ctitools"

description = "Work with cti index files for the Heise papers c't and iX"

authors = [
    { name = "Berthold Höllmann", email = "berthold@xn--hllmanns-n4a.de" }
]
maintainers = [
    { name = "Berthold Höllmann", email = "berthold@xn--hllmanns-n4a.de" }
]
license = { text = "BSD 3" }

repository = "https://gitlab.com/berhoel/python/ctitools.git"
homepage = "https://python.xn--hllmanns-n4a.de/"
documentation = "https://python.xn--hllmanns-n4a.de/ctitools/"
readme = "README.rst"

requires-python = ">=3.12,<4.0"

dynamic = [
    "version",
    "classifiers",
    "dependencies"
]

[tool.poetry]
version = "0.5.3"

packages = [{ include = "berhoel" }]
exclude = ["**/.#*.py", "**/#*.py#"]

classifiers = [
  "Development Status :: 1 - Planning",
  "Environment :: Console",
  "Intended Audience :: End Users/Desktop",
  "License :: OSI Approved :: BSD License",
  "Natural Language :: German",
  "Programming Language :: Python :: 3",
  "Topic :: Utilities",
]

[tool.poetry.scripts]
cti2bibtex = 'berhoel.ctitools.cti2bibtex.__main__:main'
cti_statistics = 'berhoel.ctitools:cti_statistics'

[tool.poetry.dependencies]
rich = "*"
typing-extensions = "*"

[tool.poetry.group.dev.dependencies]
black = "*"
ipython = "*"
isort = "*"
mypy = "*"
pdbp = "*"
ruff = "*"

[tool.poetry.group.test.dependencies]
pytest = "*"
pytest-benchmark = { extras = ["histogram"], version = "*" }
pytest-cache = "*"
pytest-cov = "*"
pytest-mock = "*"
pytest-ruff = "*"
pytest-runner = "*"
pytest-sugar = "*"
rope = "*"
tox = "*"

[tool.poetry.group.doc.dependencies]
berhoel-sphinx-settings = { git = "https://gitlab.com/berhoel/python/berhoel-sphinx-settings.git", rev = "main" }
doc8 = "*"
sphinx-argparse-cli = "*"
xdoctest = "*"

[tool.isort]
dedup_headings = true
include_trailing_comma = true
float_to_top = true
namespace_packages = ['berhoel']
force_grid_wrap = 0
balanced_wrapping = true
use_parentheses = true
length_sort = true
line_length = 88
combine_as_imports = true
known_first_party = ["berhoel"]
known_third_party = ["pytest"]

[tool.ruff]
namespace-packages = ['berhoel']
line-length = 88

[tool.ruff.lint]
select = ["ALL"]
ignore = ["D211", "D213", "COM812"]

[tool.ruff.lint.pydocstyle]
convention = "numpy"

[tool.ruff.lint.per-file-ignores]
"docs/**.py" = ["INP001"]

[tool.ruff.format]
# Enable auto-formatting of code examples in docstrings. Markdown,
docstring-code-format = true

# Set the line length limit used when formatting code snippets in
# docstrings.
#
# This only has an effect when the `docstring-code-format` setting is
# enabled.
docstring-code-line-length = "dynamic"

[tool.ruff.lint.isort]
force-sort-within-sections = true
force-wrap-aliases = true
combine-as-imports = true
required-imports = ["from __future__ import annotations"]
section-order = [
  "future",
  "standard-library",
  "third-party",
  "first-party",
  "local-folder",
]
default-section = "third-party"
known-first-party = ["berhoel"]
known-third-party = ["pytest"]

[tool.ruff.lint.flake8-quotes]
docstring-quotes = "double"

[tool.ruff.lint.flake8-annotations]
mypy-init-return = true

[tool.mypy]
packages = ["berhoel"]
mypy_path = "$MYPY_CONFIG_FILE_DIR/.stubs/"

[tool.tox]
requires = ["tox>=4.19"]
env_list = ["3.12", "3.13", "3.13t", "3.14", "3.14t"]

[tool.tox.env_run_base]
description = "Run test under {base_python}"
deps = [
  "pdbpp",
  "pytest",
  "pytest-benchmark[histogram]",
  "pytest-cov",
  "pytest-mock",
  "pytest-ruff",
  "pytest-runner",
  "pytest-sugar",
  "rope",
  "toml",
  "xdoctest",
]
allowlist_externals = ["poetry"]
commands = [["poetry", "run", "pytest"]]

[tool.pytest.ini_options]
junit_family = "xunit2"
doctest_encoding = "UTF-8"
minversion = "7.0"
addopts = [
  "--benchmark-histogram=plots/benchmark-histogram",
  "--benchmark-compare",
  "--doctest-modules",
  "--ff",
  "-s",
  "--cov=berhoel",
  "--cov-report=term",
  "--cov-report=html",
  "--cov-branch",
  "--ruff",
]
testpaths = ["berhoel"]

[tool.doc8]
ignore-path=["ctitools.egg-info", ".tox"]

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
