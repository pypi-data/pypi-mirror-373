# SPDX-FileCopyrightText: 2025 Helge
#
# SPDX-License-Identifier: MIT

when:
  - event: tag
    branch: main

depends_on: ["publish_pypi"]

steps:
  sleep:
    image: ghcr.io/astral-sh/uv:python3.11-alpine
    commands:
      - sleep 300
  publish_docker_latest:
    image: woodpeckerci/plugin-docker-buildx
    settings:
      platforms: linux/amd64,linux/arm64
      repo: helgekr/pasture
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password
      dockerfile: resources/docker/Dockerfile
      context: resources/docker/
      tags:
        - latest
        - ${CI_COMMIT_TAG}
      build_args:
        tag: ${CI_COMMIT_TAG}
