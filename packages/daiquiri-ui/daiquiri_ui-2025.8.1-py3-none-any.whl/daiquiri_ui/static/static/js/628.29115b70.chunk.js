(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[628],{46982:(t,s,e)=>{"use strict";e.d(s,{Z:()=>a});var i=e(20837),o=e(39092),r=e(69521);o.fabric.Object.prototype.selectable=!1;class a extends i.Component{constructor(t){super(t),this.state={},this.canvasRef=(0,i.createRef)(),this.containerRef=(0,i.createRef)()}componentDidMount(){const t=this.containerRef.current,s={width:1*t.clientWidth,height:1*t.clientHeight,ratio:1,loadingMessage:null};this.setState(s)}componentDidUpdate(){this.state.ratio&&!this.fabric&&this.initFabric()}initFabric(){this.fabric=new o.fabric.Canvas(this.canvasRef.current)}render(){return(0,r.jsxs)("div",{ref:this.containerRef,style:this.props.style,className:this.props.className,children:[this.props.children,this.state.ratio&&(0,r.jsx)("canvas",{ref:this.canvasRef,width:this.state.width,height:this.state.height})]})}}},93056:(t,s,e)=>{"use strict";e.r(s),e.d(s,{default:()=>D});var i=e(52799),o=e(57209),r=e(20837),a=e(96956),n=e(10769),c=e(10612),h=e.n(c),l=e(39092),d=e(99646),m=e(46982);class u extends m.Z{constructor(t){super(t),this.onMouseWheel=t=>{const s=this.clampZoom(this.fabric.getZoom()+-1*t.e.deltaY/200);this.props.onZoomChange(s),this.fabric.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},s),this.clampViewPort(),this.fimg.setCoords(),t.e.preventDefault(),t.e.stopPropagation()},this.onMouseDown=t=>{const{e:s}=t;this.isDragging=!0,this.lastPosX=s.clientX,this.lastPosY=s.clientY},this.onMouseMove=t=>{if(this.isDragging){const{e:s}=t;this.fabric.viewportTransform[4]+=s.clientX-this.lastPosX,this.fabric.viewportTransform[5]+=s.clientY-this.lastPosY,this.clampViewPort(),this.fimg.setCoords(),this.fabric.requestRenderAll(),this.lastPosX=s.clientX,this.lastPosY=s.clientY}},this.onMouseUp=()=>{this.isDragging=!1},this.img=new d.Z,this.img.onload=this.onLoad.bind(this),this.img.onerror=this.onError.bind(this),this.img.onprogress=this.onProgress.bind(this),this.first=!0,this.state.lastZoom=null}onError(t,s,e){let i="";const o=new TextDecoder("utf-8");if(e.response){i=o.decode(e.response);try{const t=JSON.parse(i);i=t.error||t.message}catch(r){console.log("Error response was not json")}}this.props.onError?this.props.onError(t,s,i):console.error("Error while loading image",t,s,i),this.img.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",this.setState({lastError:!0},(()=>{this.onLoad(!0)}))}onLoad(t){this.fimg.setSrc(this.img.src,(()=>{this.fabric.renderAll();const t=this.state.width/this.fimg.width;(null===this.state.lastZoom||this.state.lastError)&&this.fabric.setZoom(t),this.clampViewPort(),this.props.onLoadProgress(100),(null===this.state.lastZoom||this.state.lastError)&&(this.props.onZoomChange(t),this.setState({lastZoom:t}))}),{left:0,top:0,angle:0}),t||this.setState({lastError:!1})}onProgress(t){this.props.onLoadProgress(t)}loadImage(){this.fabric&&this.props.url&&this.img.load(this.props.url)}componentDidMount(){super.componentDidMount(),this.first=!0}componentDidUpdate(t){super.componentDidUpdate(t),(t.url!==this.props.url||this.first)&&(this.loadImage(),this.first=!1)}componentWillUnmount(){this.img.onload=()=>{},this.img.onprogress=()=>{},this.fabric&&this.fabric.dispose()}initFabric(){super.initFabric(),this.fabric.selection=!1,this.fimg=new l.fabric.Image,this.fabric.add(this.fimg),this.fabric.on("mouse:wheel",this.onMouseWheel),this.fabric.on("mouse:down",this.onMouseDown),this.fabric.on("mouse:move",this.onMouseMove),this.fabric.on("mouse:up",this.onMouseUp),this.props.onReady&&this.props.onReady()}clampZoom(t){const s=this.state.width/this.fimg.width;return Math.min(Math.max(t,s),this.props.maxZoom)}clampViewPort(){const t=this.fimg.width*this.fabric.getZoom(),s=this.fimg.height*this.fabric.getZoom(),e=t-this.state.width,i=s-this.state.height,o=Math.max((this.state.width-t)/2,0),r=Math.max((this.state.height-s)/2,0),a=this.fabric.viewportTransform[4];this.fabric.viewportTransform[4]=Math.min(Math.max(a,-e),o);const n=this.fabric.viewportTransform[5];this.fabric.viewportTransform[5]=Math.min(Math.max(n,-i),r)}}u.propTypes={maxZoom:h().number,onError:h().func},u.defaultProps={maxZoom:2,onError:void 0,lastError:!1};var p=e(20729),g=e(38213),f=e(82794),x=e(91328),v=e(70624),b=e(18941),Z=e(40714),w=e(52359),j=e(86912),S=e(6935),N=e(69521);function A(t){const s=`resources/icons/lut/${t.name}.png`,e=t.active?{border:"2px solid black"}:{border:"2px solid transparent"};return(0,N.jsx)(w.Z,{style:e,src:s,roundedCircle:!0})}function P(t){const{as:s,onSelect:e,value:i}=t,o=i.replace(/^\w/,(t=>t.toUpperCase())).replace("_r"," (reversed)");function r(t,s){const e=i===t;return(0,N.jsxs)(j.Z.Item,{eventKey:t,children:[(0,N.jsx)(A,{name:t,active:e}),"\xa0 ",s]})}return(0,N.jsxs)(S.Z,{as:s,title:o,id:"bg-vertical-dropdown-7",onSelect:e,children:[r("gray","Gray"),r("gray_r","Gray (reversed)"),r("viridis","Viridis"),r("cividis","Cividis"),r("magma","Magma"),r("inferno","Inferno"),r("plasma","Plasma")]})}function C(t){const{as:s,onSelect:e,value:i}=t,o=i.replace(/^\w/,(t=>t.toUpperCase()));function r(t,s){const e=i===t?"fa fa-fw fa-dot-circle-o":"fa fa-fw fa-circle-o";return(0,N.jsxs)(j.Z.Item,{eventKey:t,children:[(0,N.jsx)("i",{className:e}),"\xa0 ",s]})}return(0,N.jsxs)(S.Z,{as:s,title:o,id:"bg-vertical-dropdown-4",onSelect:e,children:[r("linear","Linear"),r("log","Log"),r("arcsinh","ArcsinH"),r("sqrt","Sqrt")]})}function M(t){const{as:s,onSelect:e,value:i}=t,o={stddev3:"3\xd7std"}[i]||i.replace(/^\w/,(t=>t.toUpperCase()));function r(t,s){const e=i===t?"fa fa-fw fa-dot-circle-o":"fa fa-fw fa-circle-o";return(0,N.jsxs)(j.Z.Item,{eventKey:t,children:[(0,N.jsx)("i",{className:e}),"\xa0 ",s]})}return(0,N.jsxs)(S.Z,{as:s,title:o,id:"bg-vertical-dropdown-3",onSelect:e,children:[r("none","None"),r("minmax","Minmax"),r("stddev3","3\xd7std")]})}var I=e(91861);class R extends r.Component{constructor(t){super(t),this.max=void 0,this.selectRef=void 0,this.point=void 0,this.loadImage=void 0,this.onChangeNode=()=>{this.loadImage()},this.onChangePoint=t=>{const{value:s}=t.target,e=Number.parseInt(s,10);e<this.max&&this.props.actions.selectPoint(e)},this.onReady=()=>{this.loadImage()},this.onError=(t,s,e)=>{this.setState({error:e})},this.onZoomChange=t=>{this.setState({zoom:t})},this.onLoadProgress=t=>{100===t?this.setState({loadingMessage:""}):this.setState({loadingMessage:`Loading ${t}%`})},this.onSelectLut=t=>{null!==t&&(this.setState({lut:t}),this.loadImage())},this.onSelectAutoscale=t=>{null!==t&&(this.setState({autoscale:t}),this.loadImage())},this.onSelectNorm=t=>{null!==t&&(this.setState({norm:t}),this.loadImage())},this.state={loadingMessage:"",zoom:1,url:void 0,lut:"gray",autoscale:"minmax",norm:"linear",error:void 0},this.loadImage=(0,a.debounce)(this.rawLoadImage.bind(this),1e3),this.max=0,this.selectRef=(0,r.createRef)(),this.point=(0,r.createRef)()}componentDidMount(){this.loadImage()}componentDidUpdate(t){const s=this.data();if(!s||!s.scanid)return;const e=s.npoints_avail;t.currentPoint===this.props.currentPoint&&t.selectedScan===this.props.selectedScan&&this.max===e||this.loadImage(),this.max=e}componentWillUnmount(){this.loadImage.cancel()}getNodeOptions(){const t=this.data();return t?t.axes.ys.images.map((t=>(0,N.jsx)("option",{children:t},t))):null}data(){const t=this.selectedScan();if(null!==t)return this.props.data[t]}selectedScan(){return this.props.selectedScan||(0,I.JD)(this.props.scans)}imageURL(t,s,e,i,o){var r;if(null!==(r=this.selectRef.current)&&void 0!==r&&r.value)return`${n.Z.baseUrl}/scans/image/${t}?node_name=${this.selectRef.current.value}&image_no=${s}&lut=${e}&autoscale=${i}&norm=${o}`}rawLoadImage(){this.setState({error:void 0});const t=this.data(),s=this.props.currentPoint||this.max-1;s<0||null!==t&&void 0!==t&&t.scanid&&(this.point.current&&(this.point.current.value=`${s}`),this.setState((e=>({...e,loadingMessage:`Loading Image ${s}`,url:this.props.url||this.imageURL(t.scanid,s,e.lut,e.autoscale,e.norm)}))))}render(){return(0,N.jsxs)("div",{className:"plot2d-container",style:this.props.style,children:[(0,N.jsxs)("div",{className:"controls mb-1",children:[(0,N.jsx)(g.Z,{children:(0,N.jsxs)(f.Z,{children:[(0,N.jsx)(x.Z,{xs:"auto",className:"gx-1",children:(0,N.jsx)(P,{value:this.state.lut,onSelect:this.onSelectLut})}),(0,N.jsx)(x.Z,{xs:"auto",className:"gx-1",children:(0,N.jsx)(M,{value:this.state.autoscale,onSelect:this.onSelectAutoscale})}),(0,N.jsx)(x.Z,{xs:"auto",className:"gx-1",children:(0,N.jsx)(C,{value:this.state.norm,onSelect:this.onSelectNorm})}),(0,N.jsx)(x.Z,{xs:"auto",className:"gx-1",children:(0,N.jsxs)(v.Z,{children:[(0,N.jsx)(v.Z.Text,{children:"Node"}),(0,N.jsx)(b.Z.Control,{as:"select",onChange:this.onChangeNode,ref:this.selectRef,children:this.getNodeOptions()})]})}),(0,N.jsx)(x.Z,{xs:"auto",className:"gx-1",children:(0,N.jsxs)(v.Z,{children:[(0,N.jsx)(v.Z.Text,{children:"Point"}),(0,N.jsx)(b.Z.Control,{type:"number",ref:this.point,onChange:this.onChangePoint,min:"0",max:this.max})]})})]})}),(0,N.jsx)("div",{className:"message",children:this.state.loadingMessage}),(0,N.jsxs)("div",{className:"zoom",children:["Zoom:",(100*this.state.zoom).toFixed(0),"%"]})]}),(0,N.jsx)(p.Z,{children:(0,N.jsx)(u,{className:"scanimage",url:this.state.url,onZoomChange:this.onZoomChange,onLoadProgress:this.onLoadProgress,onReady:this.onReady,onError:this.onError,maxZoom:4,children:(0,N.jsx)("div",{className:"plot-error",children:this.state.error&&(0,N.jsxs)(Z.Z,{variant:"danger",children:["Error loading image: ",this.state.error]})})})})]})}}var y=e(45425),E=e(12678);const L=(0,y.Qg)({scans:E.Z})((0,o.$j)((function(t,s){return{scans:s.providers.scans.list.selector("results",t),data:s.providers.scans.data.selector("results",t),spectra:s.providers.scans.spectra.selector("results",t),currentPoint:E.Z.selector("currentPoint",t),currentImageNode:E.Z.selector("currentImageNode",t),selectedScan:E.Z.selector("selectedScan",t)}}),(function(t,s){return{actions:{selectPoint:t=>E.Z.dispatch("SCAN_CURRENT_POINT",Number.parseInt(t,10)),fetchScanSpectra:t=>s.providers.scans.spectra.fetch(t)}}}))(R));function D(t){const{providers:s,yamlNode:e,events:o,...r}=t;return i.lD(e,"events",o),i.ol(e,r),(0,N.jsx)(L,{providers:s})}},52359:(t,s,e)=>{"use strict";e.d(s,{Z:()=>d});var i=e(34867),o=e.n(i),r=e(20837),a=e(10612),n=e.n(a),c=e(54515),h=e(69521);n().string,n().bool,n().bool,n().bool,n().bool;const l=r.forwardRef(((t,s)=>{let{bsPrefix:e,className:i,fluid:r=!1,rounded:a=!1,roundedCircle:n=!1,thumbnail:l=!1,...d}=t;return e=(0,c.vE)(e,"img"),(0,h.jsx)("img",{ref:s,...d,className:o()(i,r&&`${e}-fluid`,a&&"rounded",n&&"rounded-circle",l&&`${e}-thumbnail`)})}));l.displayName="Image";const d=l},34982:()=>{},98934:()=>{},66801:()=>{}}]);
//# sourceMappingURL=628.29115b70.chunk.js.map