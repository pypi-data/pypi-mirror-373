"use strict";(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[400],{1810:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(57056),o=n(69521);function i(e){const{name:t,state:n,stateVariant:i="secondary",description:r}=e,s={display:"inline-block",minWidth:""};return e.minWidth&&(s.minWidth=`${e.minWidth}em`),(0,o.jsxs)("div",{className:e.className,style:{textAlign:"center"},children:[(0,o.jsx)("strong",{title:r,style:{display:"block",margin:"0px",whiteSpace:"nowrap"},children:t}),(0,o.jsx)("div",{style:s,children:(0,o.jsx)("div",{style:{position:"relative",top:-5},children:(0,o.jsx)(a.Z,{title:r,bg:i,children:e.state})})})]})}},18680:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(70775),o=n(20837);const i=function(e){const{onClick:t,threshold:n=4}=e,{worldToData:i}=(0,a.ki)(),[r,s]=(0,o.useState)(null),l=(0,o.useCallback)((e=>{const{htmlPt:t}=e;s(t)}),[s]),c=(0,o.useCallback)((e=>{if(!r)return!1;const{htmlPt:t}=e;return Math.max(Math.abs(t.x-r.x),Math.abs(t.y-r.y))<=n}),[r,n]),d=(0,o.useCallback)((e=>{c(e)||s(null)}),[c,s]),u=(0,o.useCallback)((e=>{c(e)&&t(e)}),[c,t,t,i]);return(0,a.iq)("pointerdown",l),(0,a.iq)("pointermove",d),(0,a.iq)("pointerup",u),null}},39310:(e,t,n)=>{n.d(t,{v:()=>p});var a=n(70775),o=n(20837),i=n(26799),r=n(69521);const s=o.forwardRef(((e,t)=>{let{children:n,percentLocation:s}=e;const l=o.useRef(null);o.useImperativeHandle(t,(()=>l.current),[]);const c=(0,a.ki)();return(0,i.C)((e=>{let{camera:t}=e;const n=l.current;if(!n)return;const a=c.getVisibleDomains(t),o=a.xVisibleDomain[0]+(a.xVisibleDomain[1]-a.xVisibleDomain[0])*(s[0]/100),i=a.yVisibleDomain[0]+(a.yVisibleDomain[1]-a.yVisibleDomain[0])*(1-s[1]/100);n.position.x=o,n.position.y=i})),(0,r.jsx)("group",{ref:l,children:(0,r.jsx)("group",{children:n})})}));var l=n(94443),c=n(62958),d=n.n(c),u=n(17e3);function p(e){const{unit:t,percentWidth:n=30,percentLocation:o=75}=e,i=(0,a.ki)(),{width:c}=i.canvasSize,p=(0,a.Jk)((e=>{const a=i.getVisibleDomains(e),{xVisibleDomain:r,yVisibleDomain:s}=a,l=r[1]-r[0],p=c/Math.abs(l),h=function(e){const t=10**Math.ceil(Math.log10(e)),n=e/t;return n>=1?Number(t):n>=.5?.5*t:n>=.25?.25*t:n>=.1?.1*t:e}(Math.abs(l)*n/100),m=h*p,f=r[0]+l*o/100,x=s[1];const v=function(e,t){return"px"===t?`${e} ${t}`:`${(0,u.A)(new(d())(e,"mm")).toPrec(.1)}`}(h,t);return{pixelRange:m,dataRange:h,dataX:f,dataY:x,text:v}}),[t,c,n,o]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.q6,{x:p.dataX,y:p.dataY,style:{color:"black"},children:(0,r.jsx)("div",{style:{top:"50%",left:"50%",position:"relative",transform:"translate(-100%, 0%)",borderRadius:5,paddingLeft:5,paddingRight:5,backgroundColor:"#FFFFFF80",fontWeight:"bold",fontSize:"100%",zIndex:100},children:p.text})}),(0,r.jsx)(s,{percentLocation:[o,0],children:(0,r.jsx)(l.b,{children:(0,r.jsxs)("group",{"position-y":26,children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("ambientLight",{}),(0,r.jsx)("planeGeometry",{attach:"geometry",args:[p.pixelRange,4,1,1]}),(0,r.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"white",opacity:1})]}),(0,r.jsxs)("mesh",{position:[.5*p.pixelRange,0,0],children:[(0,r.jsx)("ambientLight",{}),(0,r.jsx)("planeGeometry",{attach:"geometry",args:[4,12,1,1]}),(0,r.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"white",opacity:1})]}),(0,r.jsxs)("mesh",{position:[.5*-p.pixelRange,0,0],children:[(0,r.jsx)("ambientLight",{}),(0,r.jsx)("planeGeometry",{attach:"geometry",args:[4,12,1,1]}),(0,r.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"white",opacity:1})]}),(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("ambientLight",{}),(0,r.jsx)("planeGeometry",{attach:"geometry",args:[p.pixelRange,2,1,1]}),(0,r.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"black",opacity:1})]}),(0,r.jsxs)("mesh",{position:[.5*p.pixelRange,0,0],children:[(0,r.jsx)("ambientLight",{}),(0,r.jsx)("planeGeometry",{attach:"geometry",args:[2,10,1,1]}),(0,r.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"black",opacity:1})]}),(0,r.jsxs)("mesh",{position:[.5*-p.pixelRange,0,0],children:[(0,r.jsx)("ambientLight",{}),(0,r.jsx)("planeGeometry",{attach:"geometry",args:[2,10,1,1]}),(0,r.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"black",opacity:1})]})]})})})]})}},94443:(e,t,n)=>{n.d(t,{b:()=>s});var a=n(20837),o=n(26799),i=n(42506),r=n(69521);const s=a.forwardRef(((e,t)=>{const{scaleX:n=!0,scaleY:s=!0,screenDirection:l=!0,children:c}=e,d=a.useRef(null);a.useImperativeHandle(t,(()=>d.current),[]);const u=(0,i.P)();return(0,o.C)((e=>{let{camera:t}=e;const a=d.current;if(!a)return;const o=t.scale.x/u.sx,i=t.scale.y/u.sy;n&&(a.scale.x=l?o:Math.abs(o)),s&&(a.scale.y=l?-i:Math.abs(i))})),(0,r.jsx)("group",{ref:d,children:c})}))},43039:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(6447),o=n(58421),i=n(69521);function r(e){const{centerX:t,centerY:n,width:r,height:s}=e,l=.5*r,c=.5*s;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.A,{y:n,x1:t,x2:t-l,color:e.color,gapColor:e.gapColor,dashSize:e.dashSize,gapSize:e.gapSize,lineWidth:e.lineWidth,zIndex:e.zIndex}),(0,i.jsx)(a.A,{y:n,x1:t,x2:t+l,color:e.color,gapColor:e.gapColor,dashSize:e.dashSize,gapSize:e.gapSize,lineWidth:e.lineWidth,zIndex:e.zIndex}),(0,i.jsx)(o.D,{x:t,y1:n,y2:n+c,color:e.color,gapColor:e.gapColor,dashSize:e.dashSize,gapSize:e.gapSize,lineWidth:e.lineWidth,zIndex:e.zIndex}),(0,i.jsx)(o.D,{x:t,y1:n,y2:n-c,color:e.color,gapColor:e.gapColor,dashSize:e.dashSize,gapSize:e.gapSize,lineWidth:e.lineWidth,zIndex:e.zIndex})]})}},45874:(e,t,n)=>{n.d(t,{i:()=>d});var a=n(26799),o=n(20837),i=n(15568),r=n(94117),s=n(94443),l=n(69521);class c extends i.ShaderMaterial{constructor(){super({uniforms:{color:{value:new i.Vector4},lineWidth:{value:0},sizeInScreen:{value:0}},vertexShader:"\nout vec2 pixelCoord;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pixelCoord = vec2(position.x, position.y);\n}\n      ",fragmentShader:"\nuniform vec4 color;\nuniform float lineWidth;\nuniform float sizeInScreen;\nin vec2 pixelCoord;\n\n/**\n * Exact signed distance function to compute an\n * orthogonal rectangle.\n *\n * @param pos: Pixel position\n * @param center: Center of the rectangle\n * @param size: Size of the rectangle\n */\nfloat sdf_rect(vec2 pos, vec2 center, vec2 size) {\n    vec2 d = abs(pos - center) - size * 0.5;\n    return length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);\n}\n\nvoid main() {\n  float d1 = sdf_rect(\n    pixelCoord,\n    vec2(0.0, 0.0),\n    vec2(abs(sizeInScreen), lineWidth)\n  );\n  float d2 = sdf_rect(\n    pixelCoord,\n    vec2(0.0, 0.0),\n    vec2(lineWidth, abs(sizeInScreen))\n  );\n  float d = min(d1, d2);\n\n  if (d > 0.2) {\n    discard;\n  }\n\n  float alpha;\n  if (lineWidth >= 1.0) {\n    alpha = smoothstep(0.2, 0.0, d);\n  } else {\n    // simulate line thiner than 1px with alpha\n    alpha = lineWidth;\n  }\n\n  gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n}\n      "})}}function d(e){const{x:t,y:n,color:i="black",opacity:c,sizeInScreen:d,lineWidth:u=1,zIndex:p=0}=e,h=(0,o.useRef)(null);return(0,o.useEffect)((()=>{const e=(0,r.V)(i,c);if(h.current){const t=h.current.uniforms;t.color.value=e,t.lineWidth.value=u,t.sizeInScreen.value=d,(0,a.l)()}}),[i,c,u,d]),(0,l.jsx)("group",{position:[t,n,p],children:(0,l.jsx)(s.b,{children:(0,l.jsxs)("mesh",{children:[(0,l.jsx)("ambientLight",{}),(0,l.jsx)("planeGeometry",{attach:"geometry",args:[d+u,d+u,1,1]}),(0,l.jsx)("crossMarkerMaterial",{attach:"material",transparent:!0,ref:h})]})})})}(0,a.e)({CrossMarkerMaterial:c})},6447:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(26799),o=n(20837),i=n(15568),r=n(42506),s=n(94117),l=n(69521);class c extends i.ShaderMaterial{constructor(){super({uniforms:{color:{value:new i.Vector4},gapColor:{value:new i.Vector4},dashSize:{value:0},gapSize:{value:0},scaleX:{value:0},scaleY:{value:0},size:{value:0},lineWidth:{value:0}},vertexShader:"\nuniform float scaleX;\nuniform float scaleY;\nuniform float size;\nout vec2 pixelCoord;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vec2 pixelScale = vec2(scaleX, scaleY);\n    pixelCoord = vec2(position.x + size * 0.5, position.y) / pixelScale;\n}\n      ",fragmentShader:"\nuniform vec4 color;\nuniform vec4 gapColor;\nuniform float gapSize;\nuniform float dashSize;\nuniform float lineWidth;\n\nin vec2 pixelCoord;\n\nvoid main() {\n    float alpha;\n    if (lineWidth >= 1.0) {\n        alpha = smoothstep(lineWidth * 0.5 + 0.01, lineWidth * 0.5 - 0.1, abs(pixelCoord.y));\n    } else {\n        // simulate line thiner than 1px with alpha\n        alpha = lineWidth;\n    }\n\n    if (dashSize == 0.0) {\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n        return;\n    }\n\n    float dist = abs(pixelCoord.x);\n    dist = mod(dist, (dashSize + gapSize));\n    if (dist <= dashSize) {\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n    } else {\n        gl_FragColor = vec4(gapColor.r, gapColor.g, gapColor.b, alpha * gapColor.a);\n    }\n}\n      "})}}function d(e){const{y:t,x1:n,x2:i,lineWidth:c=1,color:d="black",gapColor:u,dashSize:p=0,gapSize:h=p,opacity:m=1,zIndex:f=0}=e,x=(0,o.useRef)(null),v=i-n,g=.5*(n+i),y=o.useRef(null),j=(0,r.P)();return(0,o.useEffect)((()=>{const e=(0,s.V)(d,m),t=(0,s.V)(null!==u&&void 0!==u?u:"transparent",m);if(x.current){const n=x.current.uniforms;n.color.value=e,n.gapColor.value=t,n.dashSize.value=p,n.gapSize.value=h,n.size.value=v,n.lineWidth.value=c,(0,a.l)()}}),[d,u,p,h,m,v,c]),(0,a.C)((e=>{let{camera:t}=e;if(null===y.current||null===x.current)return;const n=t.scale.x/j.sx,a=t.scale.y/j.sy;y.current.scale.y=a;const o=x.current.uniforms;o.scaleX.value=n,o.scaleY.value=1})),(0,l.jsx)("group",{ref:y,position:[g,t,f],children:(0,l.jsxs)("mesh",{children:[(0,l.jsx)("ambientLight",{}),(0,l.jsx)("planeGeometry",{attach:"geometry",args:[Math.abs(v),c+1,1,1]}),(0,l.jsx)("hDashMaterial",{attach:"material",transparent:!0,ref:x})]})})}(0,a.e)({HDashMaterial:c})},38084:(e,t,n)=>{n.d(t,{M:()=>i});var a=n(20837),o=n(72154);function i(e){const[t,n]=(0,a.useState)(null),i=(0,a.useMemo)((()=>o.Z.getHandler("Celery")),[]);return(0,a.useEffect)((()=>{function t(t){null!==e&&void 0!==e&&e.includes(t.type)&&n(t)}return i.addListener(t),()=>{i.removeListener(t)}}),[e]),t}},45821:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ke});var a=n(52799),o=n(20837),i=n(38213),r=n(82794),s=n(91328),l=n(18578),c=n(79008),d=n(79371),u=n(94708),p=n(57209),h=n(94937),m=n(45425),f=n(1810),x=n(69521);const v=(0,m.Qg)({metadata:h.Z})((0,p.$j)(((e,t)=>{const{autoprocprograms:n}=t.providers.metadata,a=n.selector("order",e);return{autoprocprogram:a&&a[0]?a[0][0]:null}}),((e,t)=>{const{autoprocprograms:n}=t.providers.metadata;return{actions:{fetch:e=>{n.setParams({...e,order:"desc"},!0)}}}}))((function(e){(0,o.useEffect)((()=>{if(void 0!==e.datacollectionid&&void 0!==e.programs){const t=setInterval((()=>{void 0!==e.datacollectionid&&void 0!==e.programs&&e.actions.fetch({datacollectionid:e.datacollectionid,programs:e.programs})}),500);return()=>{clearInterval(t)}}}),[e.datacollectionid,e.programs]);const[t,n]=(a=e.autoprocprogram)?null===a.status?["PROCESSING","warning"]:0===a.status?["FAILED","danger"]:1===a.status?["DONE","success"]:["UNKNOWN","fatal"]:["NONE","secondary"];var a;return(0,x.jsx)(f.Z,{className:e.className,name:`${e.name}`,state:t,stateVariant:n,description:`${e.description}`,minWidth:5})})));var g=n(35802),y=n(62958),j=n.n(y),b=n(4363),S=n(34718),w=n.n(S),C=n(81079),Z=n(85083),M=n(60687),z=n(25263);class A extends Error{}class _{constructor(e,t){this.isAborted=void 0,this.request=void 0,this.supportsFloat16Array=void 0,this.error=void 0,this.updateCallback=void 0,this.isAborted=!1,this.request=void 0,this.updateCallback=e,this.supportsFloat16Array=t}async fetchGroup(e){const t=await Z.Z.get("/h5grove/meta/",{...this.request,path:e});if(this.isAborted)throw new A;const n=t.data;if("group"!==n.type)throw new Error(`The path '${e}' is not a group`);let a;const o={},i={},r=n.children.map((async t=>{"group"===t.type?i[t.name]=await this.fetchGroup(`${e}/${t.name}`):"|O"===t.dtype?o[t.name]=await this.fetchObjDataset(`${e}/${t.name}`,t):o[t.name]=await this.fetchDataset(`${e}/${t.name}`,t)}));await Promise.all([...r,(async()=>{a=await this.fetchAttributes(e,n.attributes)})()]);for(const s of n.children)if(this.isAborted)throw new A;if(void 0===a)throw new Error(`Attributes from path '${e}' was not fetched`);return{attrs:a,datasets:o,groups:i,name:n.name}}async fetchObjDataset(e,t){const n=await this.fetchAttributes(e,t.attributes),a=await Z.Z.get("/h5grove/data/",{...this.request,path:e,format:"json"}).then((e=>e.data)).catch((e=>{}));return{...t,attrs:n,data:a}}async fetchDataset(e,t){let n,a;const o=this.supportsFloat16Array&&"<f2"===t.dtype;if(await Promise.all([(async()=>{const n=await Z.Z.get("/h5grove/data/",{...this.request,path:e,format:"bin",dtype:o?"origin":"safe"},!0,"arraybuffer").then((e=>e.data)).catch((e=>{console.error(e)}));a=function(e){if(!e)return;const n=0===t.shape.length?[1]:t.shape;if(o){const t=(0,M.Os)(e,"<u2");return new z.S(t,n)}const a=(0,M.hO)(t.dtype);return(0,M.pm)(e,n,a)}(n)})(),(async()=>{n=await this.fetchAttributes(e,t.attributes)})()]),void 0===n)throw new Error(`Attributes from path '${e}' was not fetched`);return{...t,attrs:n,data:a}}async fetchAttributes(e,t){const n=(await Z.Z.get("/h5grove/attr/",{...this.request,path:e,attr_keys:t.map((e=>e.name))})).data,a={};return t.forEach((e=>{a[e.name]={...e,data:n[e.name]}})),a}async fetch(e){const{request:t}=e;if(this.isAborted=!1,this.request=t,void 0!==t.datacollectionid)try{this.updateCallback({loading:!0});const e=await this.fetchGroup(t.path);if(this.isAborted)throw new A;this.updateCallback({loading:!1,group:e,request:t})}catch(n){if(n instanceof A);else{const e=n instanceof Error?n.message:String(n);this.updateCallback({loading:!1,error:e,request:t})}}else this.updateCallback({loading:!1})}abort(){this.isAborted=!0}}function P(e){if(void 0===e)return null;if("|O"!==e.dtype)return null;const t=e.data;return"string"!==typeof t?null:t}function k(e){var t;if(!e)return null;const n=null===(t=e.data)||void 0===t?void 0:t.get(0);return void 0===n?null:n}function F(e){var t;if(!e)return null;const n=null===(t=e.data)||void 0===t?void 0:t.get(0);if(void 0===n)return null;const a=P(e.attrs.units);return null===a?null:new(j())(n,a)}var D=n(35875),I=n(93014);var R=n(42963),W=n(38243),N=n(86912),q=n(10827),E=n(61283);function V(e){const{as:t,className:n}=e;function a(t,n){const a=e.lut===t?"primary":"secondary";return(0,x.jsx)(l.Z,{disabled:e.disabled,variant:a,onClick:()=>{e.onSelectLut(t)},className:"text-nowrap",title:n,size:"sm",children:(0,x.jsx)(E.FR,{name:t})})}return(0,x.jsxs)(q.Z,{as:t,className:n,children:[a("Greys","Gray"),a("Viridis","Viridis"),a("Cividis","Cividis"),a("Magma","Magma"),a("Inferno","Inferno"),a("Plasma","Plasma")]})}function $(e){return(0,x.jsx)(l.Z,{variant:(t=e.var,n=e.value,t===n?"primary":"secondary"),onClick:()=>{e.setter(e.value)},className:"text-nowrap",size:"sm",children:e.children});var t,n}function H(e){const{as:t,variant:n="secondary",config:a}=e;return(0,x.jsxs)(N.Z,{as:t,className:""+("up"===e.dropDirection?"dropup":""),children:[(0,x.jsx)(N.Z.Toggle,{id:"dropdown-basic",variant:n,className:"d-flex align-items-center",children:(0,x.jsx)("i",{className:"fa fa-sliders fa-fw fa-lg"})}),(0,x.jsx)(N.Z.Menu,{className:"dropdown-menu-center",children:(0,x.jsx)("div",{className:"ms-1 me-1",style:{minWidth:"300px"},children:(0,x.jsxs)(i.Z,{children:[(0,x.jsxs)(r.Z,{children:[(0,x.jsx)(s.Z,{className:"my-auto",children:"Colormap"}),(0,x.jsx)(s.Z,{xs:7,children:(0,x.jsx)(V,{lut:a.colorMap,onSelectLut:a.setColorMap})})]}),(0,x.jsxs)(r.Z,{className:"mt-1",children:[(0,x.jsx)(s.Z,{className:"my-auto",children:"Display axes"}),(0,x.jsx)(s.Z,{xs:7,children:(0,x.jsxs)(q.Z,{children:[(0,x.jsx)($,{var:a.displayAxes,value:!0,setter:a.setDisplayAxes,children:"Yes"}),(0,x.jsx)($,{var:a.displayAxes,value:!1,setter:a.setDisplayAxes,children:"No"})]})})]}),(0,x.jsxs)(r.Z,{className:"mt-1",children:[(0,x.jsx)(s.Z,{className:"my-auto",children:"Crosshair"}),(0,x.jsx)(s.Z,{xs:7,children:(0,x.jsxs)(q.Z,{children:[(0,x.jsx)($,{var:a.crossHair,value:!0,setter:a.setCrossHair,children:"Yes"}),(0,x.jsx)($,{var:a.crossHair,value:!1,setter:a.setCrossHair,children:"No"})]})})]})]})})})]})}var B=n(38084),L=n(74773),O=n(37668);class G extends Error{}function X(e){if(!e)return null;const t=function(e){if(void 0===e)return null;if("|O"!==e.dtype)return null;const t=e.data;return"string"===typeof t?[t]:e}(e.attrs.signal);if(!t)throw new G("No signal found in NXdata");if(1!==t.length)throw new G(`Expect one and only one signal, found ${t.length}`);const n=e.datasets[t[0]];if(!n)throw new G(`Dataset from signal ${t[0]} does not exists`);if(2!==n.shape.length)throw new G(`Dataset from signal ${t[0]} must be 2 ndim (found ${n.shape.length})`);const a=n.data;(0,M.WU)(a);const o=F(e.datasets.sample_x_axis),i=F(e.datasets.sample_y_axis),r=F(e.datasets.y_axis),s=F(e.datasets.sample_pixel_size),l=F(e.datasets.used_axis_position)||new(j())(0,"px"),c=F(e.datasets.estimated_axis_position)||new(j())(0,"px"),d=k(e.datasets.delta_beta),u=P(e.datasets.backend),p=P(e.datasets.cor_backend),h=P(e.datasets.source_filename);return{histogram:function(e){try{const t=e.groups.histo,n=t.datasets.counts,a=t.datasets.bin_edges,o=n.data,i=a.data;return(0,M.x7)(o),(0,M.x7)(i),{values:o,bins:i}}catch(t){return void console.error(t)}}(e),imageArray:a,sampxPosition:o,sampyPosition:i,syPosition:r,axisPosition:l,samplePixelSize:s,estimatedAxisPosition:c,deltaBeta:d,backend:u,corBackend:p,stats:function(e){try{const t=e.groups.stats;if(void 0===t)return;return{min:k(t.datasets.min),max:k(t.datasets.max),minPositive:k(t.datasets.min_positive),mean:k(t.datasets.mean),std:k(t.datasets.std)}}catch{return}}(e),sourceFilename:h}}function Y(e){var t,n,a,i,r,s,l,c;const{datacollectionid:d,actions:u}=e,p=null!==(t=null===(n=e.reconstructionInfo)||void 0===n||null===(a=n.estimatedAxisPosition)||void 0===a?void 0:a.scalar)&&void 0!==t?t:void 0,h=null!==(i=null===(r=e.reconstructionInfo)||void 0===r||null===(s=r.axisPosition)||void 0===s?void 0:s.scalar)&&void 0!==i?i:void 0,m=null!==(l=null===(c=e.reconstructionInfo)||void 0===c?void 0:c.sourceFilename)&&void 0!==l?l:void 0;return(0,o.useEffect)((()=>{void 0!==p&&void 0!==d&&(null===u||void 0===u||u.updateDataCollectionMeta(d,{sourceFilename:m}))}),[m]),(0,o.useEffect)((()=>{void 0!==p&&void 0!==d&&(null===u||void 0===u||u.updateDataCollectionMeta(d,{estimatedCor:p}))}),[p]),(0,o.useEffect)((()=>{void 0!==p&&void 0!==d&&(null===u||void 0===u||u.updateDataCollectionMeta(d,{actualCor:h,requestedCor:null}))}),[h]),(0,x.jsx)(x.Fragment,{})}function J(e){return(0,x.jsx)(l.Z,{variant:"secondary",title:"Recompute the slice from the sinogram",disabled:null===e.datacollectionid,onClick:function(){void 0!==e.datacollectionid&&e.actions.requestSliceReconstruction({datacollectionid:e.datacollectionid,filename:e.sourceFilename})},children:(0,x.jsx)("i",{className:"fa fa-rotate-right fa-solid"})})}var T=n(75849),U=n(32249);function Q(e){const{fetchedResult:t,reconstructedInfo:n}=e;return(0,x.jsx)(U.Z,{trigger:["hover","focus"],placement:"bottom",overlay:function(e){var a,o,l,c,d;return null===n?(0,x.jsxs)(T.Z,{id:"reconstructed-slice-info",...e,children:[(0,x.jsx)(T.Z.Header,{as:"h3",children:"Displayed data info"}),(0,x.jsx)(T.Z.Body,{children:"No data"})]}):(0,x.jsxs)(T.Z,{id:"reconstructed-slice-info",...e,children:[(0,x.jsx)(T.Z.Header,{as:"h3",children:"Displayed data info"}),(0,x.jsx)(T.Z.Body,{children:(0,x.jsxs)(i.Z,{style:{width:"17em"},children:[t.request&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(r.Z,{className:"g-0",children:[(0,x.jsx)(s.Z,{children:"Collection ID"}),(0,x.jsx)(s.Z,{children:null===t||void 0===t||null===(a=t.request)||void 0===a?void 0:a.datacollectionid})]}),(0,x.jsxs)(r.Z,{className:"g-0",children:[(0,x.jsx)(s.Z,{children:"Program ID"}),(0,x.jsx)(s.Z,{children:null!==(o=null===t||void 0===t||null===(l=t.request)||void 0===l?void 0:l.autoprocprogramid)&&void 0!==o?o:"last"})]})]}),(0,x.jsxs)(r.Z,{className:"g-0",children:[(0,x.jsx)(s.Z,{children:"Backend"}),(0,x.jsx)(s.Z,{children:null===n||void 0===n?void 0:n.backend})]}),(0,x.jsxs)(r.Z,{className:"g-0",children:[(0,x.jsx)(s.Z,{children:"COR backend"}),(0,x.jsx)(s.Z,{children:null===n||void 0===n?void 0:n.corBackend})]}),(0,x.jsxs)(r.Z,{className:"g-0",children:[(0,x.jsx)(s.Z,{children:"Axis position"}),(0,x.jsxs)(s.Z,{children:[null===(c=n.axisPosition)||void 0===c?void 0:c.scalar.toFixed(2)," px"]})]}),(0,x.jsxs)(r.Z,{className:"g-0",children:[(0,x.jsx)(s.Z,{children:"Delta/beta"}),(0,x.jsx)(s.Z,{children:null===(d=n.deltaBeta)||void 0===d?void 0:d.toFixed(2)})]})]})})]})},children:(0,x.jsx)(l.Z,{variant:"secondary",disabled:null===n,children:(0,x.jsx)("i",{className:"fa-solid fa-info fa-fw fa-lg"})})},"arg")}var K=n(70775),ee=n(2498),te=n(43039),ne=n(68108),ae=n(39310);function oe(e){return(0,x.jsxs)(i.Z,{style:{width:"150px"},children:[(0,x.jsxs)(r.Z,{children:[(0,x.jsx)(s.Z,{xs:3,children:"u"}),(0,x.jsx)(s.Z,{xs:8,children:e.py.toFixed(4)}),(0,x.jsx)(s.Z,{xs:1,children:e.inMotorSpace?"mm":"px"})]}),(0,x.jsxs)(r.Z,{children:[(0,x.jsx)(s.Z,{xs:3,children:"v"}),(0,x.jsx)(s.Z,{xs:8,children:e.px.toFixed(4)}),(0,x.jsx)(s.Z,{xs:1,children:e.inMotorSpace?"mm":"px"})]}),e.pixel&&(0,x.jsxs)(r.Z,{children:[(0,x.jsx)(s.Z,{xs:3,children:"pixel"}),(0,x.jsx)(s.Z,{xs:8,children:(t=e.pixel,n=4,Math.round(t)===t?t.toFixed(0):t.toFixed(n))}),(0,x.jsx)(s.Z,{xs:1})]})]});var t,n}var ie=n(63887),re=n(26799),se=n(15568),le=n(42506),ce=n(94117);class de extends se.ShaderMaterial{constructor(){super({uniforms:{color:{value:new se.Vector4},gapColor:{value:new se.Vector4},radius:{value:0},dashSize:{value:0},gapSize:{value:0},scaleX:{value:0},scaleY:{value:0},lineWidth:{value:0}},vertexShader:"\nuniform float scaleX; // signed scale\nuniform float scaleY; // signed scale\nout vec2 pixelCoord;\n// out vec2 dataCoord;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vec2 pixelScale = abs(vec2(scaleX, scaleY));\n    // dataCoord = vec2(position.x, position.y);\n    pixelCoord = vec2(position.x, position.y) / pixelScale;\n}\n      ",fragmentShader:"\nuniform vec4 color;\nuniform vec4 gapColor;\nuniform float gapSize;\nuniform float dashSize;\nuniform float lineWidth;\nuniform float scaleX; // signed scale\nuniform float scaleY; // signed scale\nuniform float radius;\nin vec2 pixelCoord;\n\nconst float M_PI = 3.1415926535897932384626433832795;\nconst float AA_DASH = 0.5;\n\n/**\n * Antialiasing following the line of dash and gap\n */\nvec4 aa_dash_gap(float dist, float alpha) {\n  dist = mod(dist, (dashSize + gapSize));\n  float sd1 = (dist < dashSize) ? dist : dist - (dashSize + gapSize);\n  float sd2 = -(dist - dashSize);\n  if (abs(sd1) <= AA_DASH || abs(sd2) <= AA_DASH) {\n    if (abs(sd1) < abs(sd2)) {\n      float c = (sd1 + AA_DASH) * (0.5 / AA_DASH);\n      return (\n        vec4(color.r, color.g, color.b, alpha * color.a) * c\n        + vec4(gapColor.r, gapColor.g, gapColor.b, alpha * gapColor.a) * (1.0 - c)\n      );\n    } else {\n      float c = (sd2 + AA_DASH) * (0.5 / AA_DASH);\n      return (\n        vec4(color.r, color.g, color.b, alpha * color.a) * c\n        + vec4(gapColor.r, gapColor.g, gapColor.b, alpha * gapColor.a) * (1.0 - c)\n      );\n    }\n  }\n  if (dist <= dashSize) {\n      return vec4(color.r, color.g, color.b, alpha * color.a);\n  }\n  return vec4(gapColor.r, gapColor.g, gapColor.b, alpha * gapColor.a);\n}\n\nvoid main() {\n    float r = length(pixelCoord);\n    float s = (abs(scaleX) + abs(scaleY)) * 0.5;\n    float d = abs(r - radius / s) - lineWidth * 0.5;\n    if (d > 1.5) {\n      discard;\n    }\n    float alpha;\n    if (lineWidth >= 1.0) {\n        alpha = smoothstep(0.25, 0.0, d);\n    } else {\n        // simulate line thiner than 1px with alpha\n        alpha = lineWidth;\n    }\n\n    if (dashSize == 0.0) {\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n        return;\n    }\n\n    // try to fit a fixed integer number of dashes + gaps\n    // could be computed in the vertex shader\n    float full = 2.0 * M_PI * (radius / s) / (dashSize + gapSize);\n    float coef = ceil(full) / full;\n\n    float dist = 2.0 * atan(pixelCoord.y, pixelCoord.x) * (radius / s) * coef;\n    gl_FragColor = aa_dash_gap(dist, alpha);\n}\n      "})}}function ue(e){const{center:t,radius:n,lineWidth:a=1,color:i="black",gapColor:r,dashSize:s=0,gapSize:l=s,opacity:c=1,zIndex:d=0}=e,u=(0,o.useRef)(null),p=(0,le.P)();return(0,o.useEffect)((()=>{const e=(0,ce.V)(i,c),t=(0,ce.V)(null!==r&&void 0!==r?r:"transparent",c);if(u.current){const o=u.current.uniforms;o.color.value=e,o.radius.value=n,o.gapColor.value=t,o.dashSize.value=s,o.gapSize.value=l,o.lineWidth.value=a,(0,re.l)()}}),[i,n,r,s,l,c,a]),(0,re.C)((e=>{let{camera:t}=e;if(null===u.current)return;const n=t.scale.x/p.sx,a=t.scale.y/p.sy,o=u.current.uniforms;o.scaleX.value=n,o.scaleY.value=a})),(0,x.jsx)("group",{position:[t[0],t[1],d],children:(0,x.jsxs)("mesh",{children:[(0,x.jsx)("ambientLight",{}),(0,x.jsx)("planeGeometry",{attach:"geometry",args:[2*(n+a),2*(n+a),1,1]}),(0,x.jsx)("circleDashMaterial",{attach:"material",transparent:!0,ref:u})]})})}(0,re.e)({CircleDashMaterial:de});var pe=n(17332);function he(e){const{sampleStage:t}=e,n=t.sampu?(0,ie.DJ)(t.sampu):null,a=t.sampv?(0,ie.DJ)(t.sampv):null,{tomoDetector:o,detector:i}=t;if(null===o||null===i||null===n||null===a)return(0,x.jsx)(x.Fragment,{});const r=(0,ie.WZ)(o,i);if(null===r)return(0,x.jsx)(x.Fragment,{});const s=new se.Vector2(a,n),l=.5*r[0],c=r[0];const d=function(){const e=t.sy?(0,ie.DJ)(t.sy):null;return null===e||null===r?null:.5*r[0]+Math.abs(e)}();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(ue,{center:[s.x,s.y],radius:l,color:"#000000",gapColor:"#FF0000",opacity:.5,dashSize:5,gapSize:5,lineWidth:1}),(0,x.jsx)(pe.Z,{datapos:[s.x-.95*l,s.y-.35*l],color:"#FF0000",text:"Full"}),(0,x.jsx)(ue,{center:[s.x,s.y],radius:c,color:"#000000",gapColor:"#FF0000",opacity:.5,dashSize:5,gapSize:5,lineWidth:1}),(0,x.jsx)(pe.Z,{datapos:[s.x-.95*c,s.y-.35*c],color:"#FF0000",text:"Half"}),null!==d&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(ue,{center:[s.x,s.y],radius:d,color:"#000000",gapColor:"#FF0000",dashSize:5,gapSize:5,lineWidth:1}),(0,x.jsx)(pe.Z,{datapos:[s.x-d,s.y-.175*d],color:"#FF0000",text:"Actual region"})]})]})}var me=n(45874);function fe(e){const{sampleStage:t}=e,n=t.sampu?(0,ie.DJ)(t.sampu):null,a=t.sampv?(0,ie.DJ)(t.sampv):null;return null===(t.sy?(0,ie.DJ)(t.sy):null)||null===n||null===a?(0,x.jsx)(x.Fragment,{}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(me.i,{x:a,y:n,color:"red",sizeInScreen:30,lineWidth:2.5}),(0,x.jsx)(pe.Z,{datapos:[a,n],color:"#FF0000",anchor:"top-right",text:"Actual axis position"})]})}var xe=n(94443);class ve extends se.ShaderMaterial{constructor(){super({uniforms:{color:{value:new se.Vector4},lineWidth:{value:0},sizeInScreen:{value:0},angle:{value:0}},vertexShader:"\nout vec2 pixelCoord;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    pixelCoord = vec2(position.x, position.y);\n}\n      ",fragmentShader:"\n// Based on antialiased arrow fields\n// Nicolas P. Rougier (http://www.loria.fr/~rougier)\n// https://www.shadertoy.com/view/ldlSWj\n// Released under BSD license.\n\nuniform vec4 color;\nuniform float lineWidth;\nuniform float sizeInScreen;\nuniform float angle;\nin vec2 pixelCoord;\n\n// Computes the signed distance from a line\nfloat sdf_line(vec2 p, vec2 p1, vec2 p2) {\n    vec2 center = (p1 + p2) * 0.5;\n    float len = length(p2 - p1);\n    vec2 dir = (p2 - p1) / len;\n    vec2 rel_p = p - center;\n    return dot(rel_p, vec2(dir.y, -dir.x));\n}\n\n// Computes the signed distance from a line segment\nfloat sdf_segment(vec2 p, vec2 p1, vec2 p2) {\n    vec2 center = (p1 + p2) * 0.5;\n    float len = length(p2 - p1);\n    vec2 dir = (p2 - p1) / len;\n    vec2 rel_p = p - center;\n    float dist1 = abs(dot(rel_p, vec2(dir.y, -dir.x)));\n    float dist2 = abs(dot(rel_p, dir)) - 0.5*len;\n    return max(dist1, dist2);\n}\n\nfloat sdf_arrow(vec2 texcoord,\n  float body, float head, float height,\n  float linewidth, float antialias\n) {\n  float d;\n  float w = linewidth/2.0 + antialias;\n  vec2 start = -vec2(body / 2.0, 0.0);\n  vec2 end   = +vec2(body / 2.0, 0.0);\n\n  // Arrow tip (beyond segment end)\n  if( texcoord.x > body / 2.0) {\n    // Head : 2 segments\n    float d1 = sdf_line(texcoord, end, end - head*vec2(+1.0, -height));\n    float d2 = sdf_line(texcoord, end - head*vec2(+1.0, +height), end);\n    // Body : 1 segment\n    float d3 = end.x - texcoord.x;\n    d = max(max(d1, d2), d3);\n  } else {\n    // Head : 2 segments\n    float d1 = sdf_segment(texcoord, end - head * vec2(+1.0, -height), end);\n    float d2 = sdf_segment(texcoord, end - head * vec2(+1.0, +height), end);\n    // Body : 1 segment\n    float d3 = sdf_segment(texcoord, start, end - vec2(linewidth, 0.0));\n    d = min(min(d1, d2), d3);\n  }\n  return d;\n}\n\nvec4 filled(float distance, float linewidth, float antialias, vec4 fill)\n{\n    vec4 frag_color;\n    float t = linewidth / 2.0 - antialias;\n    float signed_distance = distance;\n    float border_distance = abs(signed_distance) - t;\n    float alpha = border_distance / antialias;\n    alpha = exp(-alpha * alpha);\n\n    // Within linestroke\n    if (border_distance < 0.0) {\n        return fill;\n    }\n    // Within shape\n    if (signed_distance < 0.0) {\n      return fill;\n    }\n    // Outside shape\n    if (border_distance > (linewidth / 2.0 + antialias)) {\n        discard;\n    }\n    // Line stroke exterior border\n    return vec4(fill.rgb, alpha);\n}\n\nvoid main() {\n    const float M_PI = 3.1415926535897932384626433832795;\n\n    float theta = angle * M_PI / 180.0;\n    float cos_theta = cos(theta);\n    float sin_theta = sin(theta);\n    vec2 pixelCoord2 = vec2(\n      cos_theta * pixelCoord.x - sin_theta * pixelCoord.y,\n      sin_theta * pixelCoord.x + cos_theta * pixelCoord.y\n    );\n\n    const float antialias = 1.0;\n    float body = sizeInScreen;\n    float d = sdf_arrow(pixelCoord2, body, 0.30 * body, 0.8, lineWidth, antialias);\n    gl_FragColor = filled(d, lineWidth, antialias, color);\n}\n    "})}}function ge(e){const{x:t,y:n,color:a="black",opacity:i,sizeInScreen:r,angle:s,lineWidth:l=1,zIndex:c=0}=e,d=(0,o.useRef)(null);return(0,o.useEffect)((()=>{const e=(0,ce.V)(a,i);if(d.current){const t=d.current.uniforms;t.color.value=e,t.lineWidth.value=l,t.sizeInScreen.value=r,t.angle.value=s,(0,re.l)()}}),[a,i,l,r,s]),(0,x.jsx)("group",{position:[t,n,c],children:(0,x.jsx)(xe.b,{screenDirection:!1,children:(0,x.jsxs)("mesh",{children:[(0,x.jsx)("ambientLight",{}),(0,x.jsx)("planeGeometry",{attach:"geometry",args:[r+l,r+l,1,1]}),(0,x.jsx)("arrowMarkerMaterial",{attach:"material",transparent:!0,ref:d})]})})})}function ye(e){const{sampleStage:t}=e,n=t.sampu?(0,ie.DJ)(t.sampu):null,a=t.sampv?(0,ie.DJ)(t.sampv):null,o=t.somega?-(0,ie.D8)(t.somega):null;if(null===o||null===n||null===a)return(0,x.jsx)(x.Fragment,{});const i=o/Math.PI*180,r=.5*(e.viewRange[0][1]-e.viewRange[0][0])+.5*(e.viewRange[1][1]-e.viewRange[1][0]),s=new se.Vector2(0,1).rotateAround(new se.Vector2(0,0),o),l=new se.Vector2(-s.y,s.x).multiplyScalar(.3*r),c=new se.Vector2(a,n).clone().add(s.clone().multiplyScalar(.375*r)),d=c.clone().add(l),u=c,p=c.clone().sub(l);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(ge,{x:d.x,y:d.y,sizeInScreen:80,angle:90-i,color:"red",lineWidth:3}),(0,x.jsx)(ge,{x:u.x,y:u.y,sizeInScreen:80,angle:90-i,color:"red",lineWidth:3}),(0,x.jsx)(ge,{x:p.x,y:p.y,sizeInScreen:80,angle:90-i,color:"red",lineWidth:3}),(0,x.jsx)(pe.Z,{datapos:[u.x,u.y],color:"#FF0000",text:"Beam",anchor:"bottom"})]})}(0,re.e)({ArrowMarkerMaterial:ve});var je=n(18680);const be=w()("daiquiri.components.tomo.reconstructedslice.MoveMotorInteraction");function Se(e){const t=(0,ee.qk)(),{mouseMode:n}=null!==t&&void 0!==t?t:{},{disabled:a,requestMoveSampleAxisAtPosition:i}=e,r=(0,o.useCallback)((e=>{const t=e.dataPt.x,n=e.dataPt.y;i(n,t)}),[i]);return a||"move-sample-to-axis"!==n?(be("MoveMotorInteraction disabled."),(0,x.jsx)(x.Fragment,{})):(be("MoveMotorInteraction enabled."),(0,x.jsx)(je.Z,{onClick:r}))}var we=n(22268);function Ce(e){var t;const{sampleStage:n,mouseMode:a}=e,i=null===(t=e.reconstructedInfo)||void 0===t?void 0:t.imageArray,r=(0,o.useRef)(null),s=(0,c.pC)();if(!e.reconstructedInfo||void 0===i)return(0,x.jsx)(x.Fragment,{});const l=null===n.somega||(0,we.$)(n.somega)?1:-1;const d=function(e){var t,n;const a=null!==(t=null===i||void 0===i?void 0:i.shape[1])&&void 0!==t?t:0,o=null!==(n=null===i||void 0===i?void 0:i.shape[0])&&void 0!==n?n:0;if(null===e.samplePixelSize||null===e.sampxPosition||null===e.sampyPosition||null===e.imageArray)return{inMotorSpace:!1,xRange:[0,o],yRange:[0,a],center:[a/2,o/2,0],scale:[1,1,1],height:o,width:a};const r=e.samplePixelSize.to("mm").scalar,s=e.sampxPosition.to("mm").scalar,c=e.sampyPosition.to("mm").scalar,d=.5*e.imageArray.shape[1],u=.5*e.imageArray.shape[0];return{inMotorSpace:!0,xRange:[c-d*r,c+d*r],yRange:[s-u*r,s+u*r],center:[c,s,0],scale:[-r,-l*r,1],width:d*r*2,height:u*r*2}}(e.reconstructedInfo);function u(e,t){var n;return null!==e&&d.inMotorSpace?`${null!==(n=e.alias)&&void 0!==n?n:e.name} (mm)`:`${t} (px)`}return(0,x.jsx)("div",{style:{flex:"1 1 auto",display:"flex",margin:0,minHeight:0},className:e.className,children:(0,x.jsxs)(ee.HI,{plotRef:e.plotRef,abscissaConfig:{visDomain:d.xRange,label:u(n.sampv,"lateral-axis"),flip:!0},ordinateConfig:{visDomain:d.yRange,label:u(n.sampu,"x-axis")},mouseMode:a,aspect:"equal",showAxes:e.config.displayAxes,children:[(0,x.jsx)(ne.Z,{ref:r,values:i,domain:e.imageDomain,colorMap:e.imageColorMap,invertColorMap:e.imageInvertColorMap,position:d.center,scale:d.scale,scaleType:e.imageScaleType,size:{width:i.shape[1],height:i.shape[0]}}),(0,x.jsx)(K.p9,{guides:e.config.crossHair?"both":void 0,renderTooltip:(e,t)=>{var n;const a=null===(n=r.current)||void 0===n?void 0:n.pick(e,t);return(0,x.jsx)(oe,{px:e,py:t,pixel:a,inMotorSpace:d.inMotorSpace})}}),(0,x.jsx)(te.Z,{centerX:d.center[0],centerY:d.center[1],width:d.width,height:d.height,color:"white",gapColor:"black",dashSize:5,gapSize:5,lineWidth:1}),d.inMotorSpace&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(he,{sampleStage:n}),(0,x.jsx)(fe,{sampleStage:n}),(0,x.jsx)(ye,{sampleStage:n,viewRange:[d.xRange,d.yRange]})]}),(0,x.jsx)(Se,{disabled:!s,requestMoveSampleAxisAtPosition:e.requestMoveSampleAxisAtPosition}),(0,x.jsx)(ae.v,{unit:d.inMotorSpace?"mm":"px"})]})})}var Ze=n(40714);function Me(e){const{fetchedResult:t}=e;return void 0===e.datacollectionid?(0,x.jsx)(Ze.Z,{variant:"secondary",children:"Not yet datacollection"}):void 0===e.autoprocprogramid&&void 0===t.group?(0,x.jsxs)(Ze.Z,{variant:"secondary",children:["Not yet reconstruction for datacollection ",e.datacollectionid]}):t.loading?(0,x.jsx)(Ze.Z,{variant:"warning",children:"Waiting for data"}):t.error?(0,x.jsxs)(Ze.Z,{variant:"danger",children:[(0,x.jsx)("p",{children:"Error during fetching:"}),(0,x.jsx)("p",{children:t.error})]}):e.parsingError?(0,x.jsxs)(Ze.Z,{variant:"danger",children:[(0,x.jsx)("p",{children:"Data format unsupported:"}),(0,x.jsx)("p",{children:e.parsingError})]}):(0,x.jsx)(x.Fragment,{})}var ze=n(17108);const Ae=w()("daiquiri.components.tomo.TomoReconstructedSinogram");function _e(e){var t,n,a,p;const{options:h}=e,m=(0,L.BH)(h.datacollectionid),f=(0,o.useRef)(),y=null!==(t=null===m||void 0===m?void 0:m.datacollectionid)&&void 0!==t?t:void 0,S=(0,ze.og)(),{uri:w,tomoconfig:Z,events:M,...z}=h,A=(0,c.pC)(),P=(0,o.useRef)(null),k=(0,O.y)("zoom"),{mouseMode:F}=k,N=function(){const e=(0,I.y)({name:"tomo/slicecolormap"}),[t,n]=(0,D.Z)("tomo/slicereconstruction/delta-beta",200),[a,o]=(0,D.Z)("tomo/sliceview/axes",!0),[i,r]=(0,D.Z)("tomo/sliceview/crosshair",!1);return{deltaBeta:t,setDeltaBeta:n,...e,displayAxes:a,setDisplayAxes:o,crossHair:i,setCrossHair:r}}(),q=(0,L.kP)(null!==Z&&void 0!==Z?Z:""),E=(0,L.Bp)(q),V=(0,B.M)(e.options.events);const $=function(e){const{event:t}=e,[n,a]=(0,o.useState)({});return(0,o.useEffect)((()=>{if(t&&t.type===e.type){const{datacollectionid:e,autoprocprogramid:n}=t;console.log("event",t),void 0!==e&&void 0!==n&&a((t=>({...t,[`${e}`]:n})))}}),[e.event]),(0,o.useMemo)((()=>{if(void 0===e.datacollectionid)return;const t=n[`${e.datacollectionid}`];return void 0!==t&&n[`group${e.datacollectiongroupid}`]!==t&&a((n=>({...n,[`group${e.datacollectiongroupid}`]:t}))),null!==t&&void 0!==t?t:n[`group${e.datacollectiongroupid}`]}),[n,e.datacollectionid])}({type:"tomo-sinogram-reconstruction",datacollectionid:m.datacollectionid,datacollectiongroupid:m.datacollectiongroupid,event:null!==V&&void 0!==V?V:void 0});(0,o.useEffect)((()=>()=>{f.current&&clearTimeout(f.current)}),[]);const T=function(e){const[t,n]=(0,o.useState)({loading:!1});return(0,o.useEffect)((()=>{var t;const a=new _(n,null!==(t=e.supportsFloat16Array)&&void 0!==t&&t);return a.fetch({request:{datacollectionid:e.datacollectionid,autoprocprogramid:e.autoprocprogramid,autoprocprogramattachmentid:e.autoprocprogramattachmentid,path:e.path,type:e.type}}),()=>{a.abort()}}),[e.datacollectionid,e.autoprocprogramid,e.autoprocprogramattachmentid,e.path,e.type]),t}({datacollectionid:m.datacollectionid,autoprocprogramid:$,type:"processing",path:w,supportsFloat16Array:!0}),[U,K]=(0,o.useMemo)((()=>{try{return[X(T.group),void 0]}catch(e){if(e instanceof G)return[null,e.message];throw e}}),[T]);return(0,W.$n)({statistics:null===U||void 0===U?void 0:U.stats,...N}),(0,x.jsxs)("div",{className:"plot2d-container w-100 h-100",style:{flex:"1 1 0%",display:"flex",flexDirection:"column"},children:[(0,x.jsxs)(u.ZP,{align:"center",children:[(0,x.jsx)(Y,{reconstructionInfo:U,datacollectionid:y,actions:S}),(0,x.jsx)(b.Z,{mouseModeInteraction:k}),(0,x.jsx)(l.Z,{title:"Reset zoom (sample stage overview)",variant:"secondary",onClick:()=>{P.current&&P.current.actions.resetZoom()},children:(0,x.jsx)("i",{className:"fa fa-expand fa-fw fa-lg"})}),(0,x.jsx)(u.Z0,{}),(0,x.jsx)(l.Z,{title:A?"Move the motors to set rotation axis on the sample":"You have to get the control on the session to move motors",disabled:!A,variant:"move-sample-to-axis"===F?"danger":"secondary",onClick:()=>{k.setOrResetMouseMode("move-sample-to-axis")},children:(0,x.jsx)("i",{className:"fa fam-arrow-h-over-rot fa-fw fa-lg"})}),(0,x.jsx)(v,{name:"Worker",description:"Automatic slice reconstruction from sinogram",datacollectionid:m.datacollectionid,programs:"tomo-sinogram-reconstruction",providers:{metadata:{autoprocprograms:{namespace:"tomosinogramreconstruction"}}}}),(0,x.jsx)(J,{datacollectionid:m.datacollectionid,sourceFilename:null!==(n=null===U||void 0===U?void 0:U.sourceFilename)&&void 0!==n?n:void 0,actions:{requestSliceReconstruction:g.P}})]}),(0,x.jsxs)(u.ZP,{align:"center",children:[(0,x.jsx)(R.Z,{disabled:void 0===(null===U||void 0===U?void 0:U.stats),...N}),(0,x.jsx)(C.Z,{disabled:void 0===U,histogram:null===U||void 0===U?void 0:U.histogram,...N}),(0,x.jsx)(Q,{fetchedResult:T,reconstructedInfo:U}),(0,x.jsx)(H,{config:N})]}),(0,x.jsxs)(i.Z,{children:[(0,x.jsxs)(r.Z,{className:"g-0 align-items-center",children:[(0,x.jsx)(s.Z,{xs:"3",title:"Location of the rotation axis from the left side of the sinogram (in pixel)",children:"Axis position:"}),(0,x.jsx)(s.Z,{xs:"9",children:(0,x.jsx)(d.Z,{hardwareValue:null!==(a=null===U||void 0===U||null===(p=U.axisPosition)||void 0===p?void 0:p.scalar)&&void 0!==a?a:0,hardwareIsDisabled:null===U,onMoveRequested:e=>{var t;void 0!==m.datacollectionid&&(0,g.P)({datacollectionid:m.datacollectionid,axisposition:e,deltabeta:N.deltaBeta,filename:null!==(t=null===U||void 0===U?void 0:U.sourceFilename)&&void 0!==t?t:void 0});return null}})})]}),(0,x.jsxs)(r.Z,{className:"g-0 align-items-center",children:[(0,x.jsx)(s.Z,{xs:"3",title:"Delta/beta ratio for the Paganin filter",children:"Delta/beta:"}),(0,x.jsx)(s.Z,{xs:"9",children:(0,x.jsx)(d.Z,{hardwareValue:N.deltaBeta,hardwareIsDisabled:!1,onMoveRequested:e=>{var t,n;(N.setDeltaBeta(e),void 0!==m.datacollectionid)&&(0,g.P)({datacollectionid:m.datacollectionid,axisposition:null===U||void 0===U||null===(t=U.axisPosition)||void 0===t?void 0:t.scalar,deltabeta:e,filename:null!==(n=null===U||void 0===U?void 0:U.sourceFilename)&&void 0!==n?n:void 0});return null}})})]})]}),(0,x.jsx)(Me,{datacollectionid:m.datacollectionid,autoprocprogramid:$,fetchedResult:T,parsingError:K}),(0,x.jsx)(Ce,{config:N,imageColorMap:N.colorMap,imageInvertColorMap:N.invertColorMap,imageDomain:N.scaleDomain,imageScaleType:N.scaleType,reconstructedInfo:U,className:"flex-grow-1",sampleStage:E,mouseMode:F,plotRef:P,requestMoveSampleAxisAtPosition:function(e,t){if(k.resetMouseMode(),null===U)return void Ae("Move cancelled: reconstructedInfo is null");const n=j()(e,"mm"),a=j()(t,"mm");(0,g.Q)({sampu:n,sampv:a})}})]})}function Pe(e){return(0,x.jsx)(_e,{...e})}function ke(e){const{yamlNode:t,datacollectionid:n,uri:o,tomoconfig:i,events:r,...s}=e;a._J(t,"events",r),a.Ee(t,"tomoconfig",i),a.Ee(t,"uri",o),a.R0(t,"datacollectionid",n),a.ol(t,s);const l={datacollectionid:n,uri:o,tomoconfig:i,events:r};return(0,x.jsx)(Pe,{options:l})}},17e3:(e,t,n)=>{n.d(t,{A:()=>i});const a={"<tera>":12,"<giga>":9,"<mega>":6,"<kilo>":3,"<1>":0,"<milli>":-3,"<micro>":-6,"<nano>":-9,"<pico>":-12},o={};function i(e){if(0===e.scalar)return e;function t(e){const t=e.scalar;return t>200?3:t<.3?-3:0}function n(t,n){const i=function(e){return a[e.numerator[0]]||0}(t)+n,r=o[i];if(void 0===r)return t;const s=function(e,t){function n(e){return void 0===e||"<1>"===e?"":e.slice(1,-1)}let o="";for(let r=0;r<e.numerator.length;r+=1){const i=e.numerator[r];if(0===r){const e=void 0===a[i];o+=n(t)+(e?n(i):"")}else o+=n(i)}let i="";for(const a of e.denominator)i+=n(a);return""===i?o:""===o?`1/${i}`:`${o}/${i}`}(e,r);return t.to(s)}let i=e;for(let a=0;a<10;a+=1){const e=t(i);if(0===e)break;i=n(i,e)}const r=i.scalar.toFixed(2);return 4===r.length&&r.startsWith("0.")&&"0"!==r.slice(3,4)?n(i,-3):i}Object.keys(a).forEach((e=>{o[a[e]]=e}))},35802:(e,t,n)=>{n.d(t,{P:()=>r,Q:()=>i});var a=n(96931),o=n(99646);function i(e){const{sz:t=null,sy:n=null,sampx:i=null,sampy:r=null,sampu:s=null,sampv:l=null}=e,c=new URL(`${(0,a.Z)()}/tomo/move`);n&&c.searchParams.append("sy",n.toString()),t&&c.searchParams.append("sz",t.toString()),i&&c.searchParams.append("sampx",i.toString()),r&&c.searchParams.append("sampy",r.toString()),s&&c.searchParams.append("sampu",s.toString()),l&&c.searchParams.append("sampv",l.toString()),c.searchParams.append("relative","false");const d=new XMLHttpRequest;d.open("GET",c.href,!0),o.Z.token&&d.setRequestHeader("Authorization",`Bearer ${o.Z.token}`),d.send()}function r(e){const{datacollectionid:t,axisposition:n,deltabeta:i,filename:r}=e;if(void 0===t)return;const s=new URL(`${(0,a.Z)()}/tomo/slice_reconstruction`);void 0!==t&&s.searchParams.append("datacollectionid",t.toString()),void 0!==n&&s.searchParams.append("axisposition",n.toString()),void 0!==i&&s.searchParams.append("deltabeta",i.toString()),void 0!==r&&s.searchParams.append("filename",r);const l=new XMLHttpRequest;l.open("GET",s.href,!0),o.Z.token&&l.setRequestHeader("Authorization",`Bearer ${o.Z.token}`),l.send()}},43046:(e,t,n)=>{n.d(t,{C:()=>s});var a=n(20837),o=n(21681),i=n(7894);function r(e,t){return"function"===typeof e?e(t):e}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;const[s,l]=function(e,t){const[n,s]=(0,o.F)((()=>t?t(r(e)):e)),l=(0,i.x)(t);return[n,(0,a.useCallback)((e=>{l.current?s((t=>l.current?.(r(e,t)))):s(e)}),[])]}(e,(e=>(void 0!==t&&(e=Math.min(t,e)),void 0!==n&&(e=Math.max(n,e)),e))),c=(0,i.x)(s);return[s,(0,a.useMemo)((()=>({get:()=>c.current,set:l,dec:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;l((t=>t-r(e,t)))},inc:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;l((t=>t+r(e,t)))},reset:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;l((e=>r(t,e)))}})),[e,l,c])]}},21681:(e,t,n)=>{n.d(t,{F:()=>o});var a=n(20837);function o(e){const[t,n]=(0,a.useState)(e),o=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(0,a.useRef)(e),n=(0,a.useCallback)((()=>t.current),[]);return(0,a.useEffect)((()=>(t.current=!0,()=>{t.current=!1})),[]),n}(!0);return[t,(0,a.useCallback)((e=>{o()&&n(e)}),[])]}},43285:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(20837);function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}var i=function(e){return new Error("NoPayloadError: "+e+" requires a payload.")},r=function(e,t){var n=e.past,a=e.present,r=e.future,s=t.payload,l=t.behavior,c=t.historyLimit,d=t.ignoreIdenticalMutations,u=t.cloneState,p=t.ignoreAction;if(!s||void 0===s)throw i("mutate");if(p)return{past:n,present:s,future:r};var h=[].concat(n);"infinium"!==c&&"infinity"!==c&&(h=function(e,t){if(!e)return t;var n=[].concat(t);if(n.length<=e)return t;var a=n.length-e;return 1===a?n.shift():n.splice(0,a),n}(c,n));var m=JSON.stringify(s)===JSON.stringify(a);if(d&&m)return u?o({},e):e;var f=[].concat(r),x={mergePastReversed:{past:[].concat(h,f.reverse(),[a]),present:s,future:[]},mergePast:{past:[].concat(h,r,[a]),present:s,future:[]},destroyFuture:{past:[].concat(h,[a]),present:s,future:[]},keepFuture:{past:[].concat(h,[a]),present:s,future:r}};if("undefined"===typeof l)return x.mergePastReversed;if(!x.hasOwnProperty(l))throw function(e){return new Error("Mutation behavior must be one of: mergePastReversed, mergePast, keepFuture, or destroyFuture. Not: "+e)}(l);return x[l]},s=function(e,t){var n=e.past,a=e.present,o=e.future,s={undo:function(){if(0===n.length)return e;var t=n[n.length-1];return{past:n.slice(0,n.length-1),present:t,future:[a].concat(o)}},redo:function(){if(0===o.length)return e;var t=o[0],i=o.slice(1);return{past:[].concat(n,[a]),present:t,future:i}},update:function(){return r(e,function(e){return e.payload="function"===typeof e.payload?e.payload(a):e.payload,e}(t))},reset:function(){return{past:[],present:t.payload||e.present,future:[]}},resetInitialState:function(){var e=t.payload;if(!e)throw i("resetInitialState");var r=[].concat(n);return r[0]=e,{past:[].concat(r),present:a,future:[].concat(o)}}};return s[t.type]()},l={past:[],present:null,future:[]},c={behavior:"mergePastReversed",historyLimit:100,ignoreIdenticalMutations:!0,cloneState:!1};const d=function(e,t){void 0===t&&(t=c);var n=(0,a.useReducer)(s,o({},l,{present:e})),i=n[0],r=n[1],d=0!==i.past.length,u=0!==i.future.length,p=(0,a.useCallback)((function(){d&&r({type:"undo"})}),[d]),h=(0,a.useCallback)((function(){u&&r({type:"redo"})}),[u]),m=(0,a.useCallback)((function(t){return void 0===t&&(t=e),r({type:"reset",payload:t})}),[]),f=(0,a.useCallback)((function(e){return r({type:"resetInitialState",payload:e})}),[]),x=(0,a.useCallback)((function(e,n,a){return r(o({type:"update",payload:e,behavior:n,ignoreAction:a},function(e){return o({},c,e)}(t)))}),[]),v=(0,a.useCallback)((function(e,n,a){return void 0===n&&(n=t.behavior),void 0===a&&(a=!1),x(e,n,a)}),[i]);return[i.present,v,{past:i.past,future:i.future,undo:p,canUndo:d,redo:h,canRedo:u,reset:m,resetInitialState:f,static_setState:function(e,n,a){void 0===n&&(n=t.behavior),void 0===a&&(a=!1),x(e,n,a)}}]}}}]);
//# sourceMappingURL=400.2d4ea371.chunk.js.map