"use strict";(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[939],{38243:(e,a,n)=>{n.d(a,{$n:()=>o,F3:()=>d,me:()=>l});var t=n(96956),i=n(20837),r=n(34718);const s=n.n(r)()("daiquiri.components.h5web.colormap");let l=function(e){return e.Minmax="minmax",e.StdDev3="stddev3",e.None="none",e}({});function o(e){(0,i.useEffect)((()=>{const a=e.statistics;if(void 0!==a&&e.autoscale)try{const n=function(e,a){const n=a;var t,i;if(e===l.Minmax)return[null!==(t=n.min)&&void 0!==t?t:0,null!==(i=n.max)&&void 0!==i?i:1];if(e===l.StdDev3){var r,s,o,d,c,u;if(null===n.mean||null===n.std)return[null!==(c=n.min)&&void 0!==c?c:0,null!==(u=n.max)&&void 0!==u?u:1];const e=null!==(r=n.mean)&&void 0!==r?r:0,a=null!==(s=n.std)&&void 0!==s?s:0,t=null!==(o=n.min)&&void 0!==o?o:e-10*a,i=null!==(d=n.max)&&void 0!==d?d:e+10*a;return[Math.max(e-3*a,t),Math.min(e+3*a,i)]}throw new Error(`Unsupported autoscale ${e}`)}(e.autoscaleMode,a);e.setScaleDomain(n)}catch(n){const e=n instanceof Error?n.message:String(n);s(`Error while computing colormap level: ${e}`)}}),[e.autoscale,e.autoscaleMode,e.setScaleDomain,e.statistics])}function d(e){return(0,i.useMemo)((()=>{if(!e)return;const[a,n]=function(e){const{values:a,bins:n}=e,i=n.data.map(((e,a,n)=>0===a?0:.5*(e+n[a-1]))).subarray(1),r=a.data,s=(0,t.sum)(r);let l=0;for(let t=0;t<i.length;t++)l+=r[t]*i[t];l/=s;let o=0;for(let t=0;t<i.length;t++)o+=r[t]*(i[t]-l)**2;return o/=s,[l,Math.sqrt(o)]}(e);return{min:e.bins.get(0),max:e.bins.get(e.bins.size-1),std:n,mean:a,minPositive:null}}),[e])}},30:(e,a,n)=>{n.d(a,{z:()=>d});var t=n(20837),i=n(40714),r=n(70775),s=n(37185),l=n(21681);var o=n(69521);function d(e){const[a,n]=function(e,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const[t,i]=(0,l.F)(e);return[t,(0,s.y)(i,[],a,n)]}({loading:e.loading,info:e.info,warning:e.warning,danger:e.danger},500);return(0,t.useEffect)((()=>{n({loading:e.loading,warning:e.warning,danger:e.danger,info:e.info})}),[e.loading,e.info,e.warning,e.danger]),a.loading||a.danger||a.warning||a.info?(0,o.jsx)(r.aV,{style:{zIndex:200},children:(0,o.jsxs)("div",{style:{textAlign:"center"},children:[a.loading&&(0,o.jsxs)(i.Z,{variant:"warning",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:[(0,o.jsx)("i",{className:"fa fa-spinner fa-solid fa-pulse"})," Loading"]}),!a.loading&&a.danger&&(0,o.jsx)(i.Z,{variant:"danger",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:a.danger}),!a.loading&&!a.danger&&a.warning&&(0,o.jsx)(i.Z,{variant:"warning",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:a.warning}),a.info&&(0,o.jsx)(i.Z,{variant:"info",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:a.info})]})}):(0,o.jsx)(o.Fragment,{})}},39310:(e,a,n)=>{n.d(a,{v:()=>m});var t=n(70775),i=n(20837),r=n(26799),s=n(69521);const l=i.forwardRef(((e,a)=>{let{children:n,percentLocation:l}=e;const o=i.useRef(null);i.useImperativeHandle(a,(()=>o.current),[]);const d=(0,t.ki)();return(0,r.C)((e=>{let{camera:a}=e;const n=o.current;if(!n)return;const t=d.getVisibleDomains(a),i=t.xVisibleDomain[0]+(t.xVisibleDomain[1]-t.xVisibleDomain[0])*(l[0]/100),r=t.yVisibleDomain[0]+(t.yVisibleDomain[1]-t.yVisibleDomain[0])*(1-l[1]/100);n.position.x=i,n.position.y=r})),(0,s.jsx)("group",{ref:o,children:(0,s.jsx)("group",{children:n})})}));var o=n(94443),d=n(62958),c=n.n(d),u=n(17e3);function m(e){const{unit:a,percentWidth:n=30,percentLocation:i=75}=e,r=(0,t.ki)(),{width:d}=r.canvasSize,m=(0,t.Jk)((e=>{const t=r.getVisibleDomains(e),{xVisibleDomain:s,yVisibleDomain:l}=t,o=s[1]-s[0],m=d/Math.abs(o),h=function(e){const a=10**Math.ceil(Math.log10(e)),n=e/a;return n>=1?Number(a):n>=.5?.5*a:n>=.25?.25*a:n>=.1?.1*a:e}(Math.abs(o)*n/100),x=h*m,v=s[0]+o*i/100,f=l[1];const p=function(e,a){return"px"===a?`${e} ${a}`:`${(0,u.A)(new(c())(e,"mm")).toPrec(.1)}`}(h,a);return{pixelRange:x,dataRange:h,dataX:v,dataY:f,text:p}}),[a,d,n,i]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.q6,{x:m.dataX,y:m.dataY,style:{color:"black"},children:(0,s.jsx)("div",{style:{top:"50%",left:"50%",position:"relative",transform:"translate(-100%, 0%)",borderRadius:5,paddingLeft:5,paddingRight:5,backgroundColor:"#FFFFFF80",fontWeight:"bold",fontSize:"100%",zIndex:100},children:m.text})}),(0,s.jsx)(l,{percentLocation:[i,0],children:(0,s.jsx)(o.b,{children:(0,s.jsxs)("group",{"position-y":26,children:[(0,s.jsxs)("mesh",{position:[0,0,0],children:[(0,s.jsx)("ambientLight",{}),(0,s.jsx)("planeGeometry",{attach:"geometry",args:[m.pixelRange,4,1,1]}),(0,s.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"white",opacity:1})]}),(0,s.jsxs)("mesh",{position:[.5*m.pixelRange,0,0],children:[(0,s.jsx)("ambientLight",{}),(0,s.jsx)("planeGeometry",{attach:"geometry",args:[4,12,1,1]}),(0,s.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"white",opacity:1})]}),(0,s.jsxs)("mesh",{position:[.5*-m.pixelRange,0,0],children:[(0,s.jsx)("ambientLight",{}),(0,s.jsx)("planeGeometry",{attach:"geometry",args:[4,12,1,1]}),(0,s.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"white",opacity:1})]}),(0,s.jsxs)("mesh",{position:[0,0,0],children:[(0,s.jsx)("ambientLight",{}),(0,s.jsx)("planeGeometry",{attach:"geometry",args:[m.pixelRange,2,1,1]}),(0,s.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"black",opacity:1})]}),(0,s.jsxs)("mesh",{position:[.5*m.pixelRange,0,0],children:[(0,s.jsx)("ambientLight",{}),(0,s.jsx)("planeGeometry",{attach:"geometry",args:[2,10,1,1]}),(0,s.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"black",opacity:1})]}),(0,s.jsxs)("mesh",{position:[.5*-m.pixelRange,0,0],children:[(0,s.jsx)("ambientLight",{}),(0,s.jsx)("planeGeometry",{attach:"geometry",args:[2,10,1,1]}),(0,s.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:"black",opacity:1})]})]})})})]})}},6510:(e,a,n)=>{n.d(a,{R:()=>o});var t=n(20837),i=n(94443),r=n(98476),s=n(35540),l=n(69521);function o(e){const{geometry:a,lineWidth:n=2,color:o="blue",opacity:d=1,zIndex:c=1,visible:u=!0,readOnly:m=void 0===e.onGeometryChanged}=e,[h,x]=(0,t.useState)(!1);return u?(0,l.jsxs)("group",{position:[a.x,0,c],children:[(0,l.jsx)(i.b,{children:(0,l.jsx)(s._,{pos:[a.x,0],size:[r.FE,999999],pointer:"ew-resize",zIndex:c+r.BG,enabled:!m,onPositionChanged:(a,n)=>{var t;null===(t=e.onGeometryChanged)||void 0===t||t.call(e,{x:a[0]},n)},onEnter:()=>{x(!0)},onLeave:()=>{x(!1)}})}),(0,l.jsx)("group",{children:(0,l.jsx)(i.b,{children:(0,l.jsxs)("mesh",{children:[(0,l.jsx)("ambientLight",{}),(0,l.jsx)("planeGeometry",{attach:"geometry",args:[h?r.pU:n,999999,1,1]}),(0,l.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:o,opacity:d})]})})})]}):(0,l.jsx)(l.Fragment,{})}},36939:(e,a,n)=>{n.r(a),n.d(a,{default:()=>be});var t=n(52799),i=n(34718),r=n.n(i),s=n(24063),l=n(60687),o=n(62958),d=n.n(o),c=n(20837),u=n(62199),m=n(10827),h=n(18578),x=n(66809),v=n(94708),f=n(18941);let p=function(e){return e[e.NONE=0]="NONE",e[e.LAPLACIAN_3x3=1]="LAPLACIAN_3x3",e[e.LAPLACIAN_9x9=2]="LAPLACIAN_9x9",e[e.SHARPENING_3x3=3]="SHARPENING_3x3",e[e.UNSHARPENING_3x3=4]="UNSHARPENING_3x3",e[e.UNSHARPENING_5x5=5]="UNSHARPENING_5x5",e[e.SMOOTH_3x3=6]="SMOOTH_3x3",e[e.SMOOTH_5x5=7]="SMOOTH_5x5",e[e.SMOOTH_7x7=8]="SMOOTH_7x7",e}({});const g={[p.NONE]:{name:"No filter",size:0,coefs:Float32Array.from([0,0,0,0,0,0,0,0,0])},[p.LAPLACIAN_3x3]:{name:"Laplacian 3\xd73",size:3,coefs:Float32Array.from([0,-1,0,-1,4,-1,0,-1,0])},[p.LAPLACIAN_9x9]:{name:"Laplacian 9\xd79",size:9,coefs:Float32Array.from([0,1,1,2,2,2,1,1,0,1,2,4,5,5,5,4,2,1,1,4,5,3,0,3,5,4,1,2,5,3,-12,-24,-12,3,5,2,2,5,0,-24,-40,-24,0,5,2,2,5,3,-12,-24,-12,3,5,2,1,4,5,3,0,3,5,4,1,1,2,4,5,5,5,4,2,1,0,1,1,2,2,2,1,1,0])},[p.SHARPENING_3x3]:{name:"Sharpening 3\xd73",size:3,coefs:Float32Array.from([-1,-1,-1,-1,9,-1,-1,-1,-1])},[p.UNSHARPENING_3x3]:{name:"Unsharpening 3\xd73",size:3,coefs:Float32Array.from([0,-1,0,-1,5,-1,0,-1,0])},[p.UNSHARPENING_5x5]:{name:"Unsharpening 5\xd75",size:5,coefs:Float32Array.from([1/256,4/256,6/256,4/256,1/256,4/256,.0625,24/256,.0625,4/256,6/256,24/256,-476/256,24/256,6/256,4/256,.0625,24/256,.0625,4/256,1/256,4/256,6/256,4/256,1/256])},[p.SMOOTH_3x3]:{name:"Gaussian 3\xd73",size:3,coefs:Float32Array.from([1/16,2/16,1/16,2/16,.25,2/16,1/16,2/16,1/16])},[p.SMOOTH_5x5]:{name:"Gaussian 5\xd75",size:5,coefs:Float32Array.from([1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273])},[p.SMOOTH_7x7]:{name:"Gaussian 7\xd77",size:7,coefs:Float32Array.from([1/4096,6/4096,15/4096,20/4096,15/4096,6/4096,1/4096,6/4096,36/4096,90/4096,120/4096,90/4096,36/4096,6/4096,15/4096,90/4096,225/4096,300/4096,225/4096,90/4096,15/4096,20/4096,120/4096,300/4096,400/4096,300/4096,120/4096,20/4096,15/4096,90/4096,225/4096,300/4096,225/4096,90/4096,15/4096,6/4096,36/4096,90/4096,120/4096,90/4096,36/4096,6/4096,1/4096,6/4096,15/4096,20/4096,15/4096,6/4096,1/4096])}};var j=n(15568),y=n(51208),C=n.n(y);const b={float32:j.FloatType,float16:j.HalfFloatType,uint8:j.UnsignedByteType,uint16:j.UnsignedShortType,uint32:j.UnsignedIntType,uint8_clamped:j.UnsignedByteType};function M(e,a){return(0,c.useMemo)((()=>function(e,a){if(void 0===e)return;const[n,t]=e.shape,i=null!==a&&void 0!==a&&a.magNearest?j.NearestFilter:j.LinearFilter,r=new j.DataTexture(e.data,t,n,j.RedFormat,b[e.dtype],j.UVMapping,j.ClampToEdgeWrapping,j.ClampToEdgeWrapping,i);return r.needsUpdate=!0,r}(e,a)),[e,a])}function N(e,a){const n=`resources/shaders/${e}`,[t,i]=(0,c.useState)();return(0,c.useEffect)((()=>{C().get(n).then((n=>i({name:e,data:n.data,id:a})))}),[n]),t}var S=n(70775),_=n(26799),A=n(43674),R=n(38243),I=n(69521);const Z=r()("daiquiri.components.tomo.TomoAlign");let L=function(e){return e[e.IMAGE_A=0]="IMAGE_A",e[e.IMAGE_B=1]="IMAGE_B",e[e.DIFF=100]="DIFF",e[e.ERROR=101]="ERROR",e[e.MAX=102]="MAX",e[e.MIN=103]="MIN",e[e.MUL=104]="MUL",e[e.HSPLITTER=105]="HSPLITTER",e[e.DIFF_COLOR=200]="DIFF_COLOR",e[e.ERROR_COLOR=201]="ERROR_COLOR",e[e.MAX_COLOR=202]="MAX_COLOR",e[e.MIN_COLOR=203]="MIN_COLOR",e[e.MUL_COLOR=204]="MUL_COLOR",e[e.HSPLITTER_COLOR=205]="HSPLITTER_COLOR",e[e.CUSTOM=300]="CUSTOM",e}({});class O extends j.ShaderMaterial{constructor(){super({uniforms:{textureA:{value:null},normA:{value:{min:0,max:0,mode:0}},textureB:{value:null},normB:{value:{min:0,max:0,mode:0}},mode:{value:0},sizeCoef:{value:1},lateral:{value:0},tilt:{value:0},domain:{value:{min:0,max:1}},verticalSeparator:{value:0},kernelCoefs:{value:Float32Array.from([0,0,0,0,0,0,0,0,0])},kernelSize:{value:0}}})}}function E(e){const{lateral:a,threshold:n=4,displayMode:t,verticalSeparator:i,disabled:r}=e,s=(0,c.useRef)(void 0),l=(0,c.useCallback)((e=>{const n=function(e,a,n){return a===L.IMAGE_A||(a===L.HSPLITTER||a===L.HSPLITTER_COLOR)&&e.y<n?-1:1}(e.dataPt,t,i);s.current={lateral:a,startData:e.dataPt,startScreen:e.htmlPt,gestureStarted:!1,coef:n}}),[a,t,i]),o=(0,c.useCallback)((e=>{const a=s.current;if(void 0===a)return!1;const{htmlPt:t}=e;return Math.max(Math.abs(t.x-a.startScreen.x),Math.abs(t.y-a.startScreen.y))<=n}),[n]),d=(0,c.useCallback)((a=>{const n=s.current;if(void 0===n)return;if(!n.gestureStarted){if(o(a))return;s.current={...n,gestureStarted:!0}}const t=a.dataPt.x-n.startData.x;e.onLateralIntermediateChanged(n.lateral+2*t*n.coef)}),[o,e.onLateralIntermediateChanged]),u=(0,c.useCallback)((a=>{const n=s.current;if(n){const t=a.dataPt.x-n.startData.x;e.onLateralChanged(n.lateral+2*t*n.coef)}s.current=void 0}),[o,e.onLateralChanged]);function m(){return(0,S.iq)("pointerdown",l),(0,S.iq)("pointermove",d),(0,S.iq)("pointerup",u),(0,I.jsx)(I.Fragment,{})}return(0,I.jsx)(I.Fragment,{children:!r&&(0,I.jsx)(m,{})})}function w(e){var a,n,t,i;const r=(0,c.useRef)(null),{displayMode:s=1,lateral:l=0,tilt:o=0,autoScale:d=R.me.None,stateA:u,stateB:m,verticalSeparator:h=0,customFunc:x,filterMode:v=p.NONE,lateralInteration:f=!1}=e,j=null===(a=N("compare.vert.glsl"))||void 0===a?void 0:a.data,y=null===(n=N("compare.frag.glsl"))||void 0===n?void 0:n.data,[C,b]=(0,c.useState)(0),S=(0,c.useMemo)((()=>void 0===e.pixelSize?1:e.pixelSize.to("mm").scalar),[e.pixelSize]),L=(0,c.useMemo)((()=>void 0===x?y:void 0!==y?y.replace("// CUSTOM FUNC INJECTION //",x):void 0),[y,x]),O=M(e.imageA,{magNearest:!0}),w=M(e.imageB,{magNearest:!0}),[z,k]=(0,c.useMemo)((()=>{if(v in g){const{size:e,coefs:a}=g[v];return[e,a]}console.log(`Unsupported ${v}`);const{size:e,coefs:a}=g[p.NONE];return[e,a]}),[v]);(0,c.useEffect)((()=>{b((e=>e+1))}),[L,j]);const F=(0,c.useMemo)((()=>{var e,a,n,t;if(void 0===u||void 0===m)return{min:0,max:1};switch(d){case R.me.None:return{min:0,max:1};case R.me.Minmax:return{min:Math.min(null!==(e=u.min)&&void 0!==e?e:0,null!==(a=m.min)&&void 0!==a?a:0),max:Math.max(null!==(n=u.max)&&void 0!==n?n:1,null!==(t=m.max)&&void 0!==t?t:1)};case R.me.StdDev3:{var i,r,s,l,o,c,h,x;const e=Math.min(null!==(i=u.min)&&void 0!==i?i:0,null!==(r=m.min)&&void 0!==r?r:0),a=Math.max(null!==(s=u.max)&&void 0!==s?s:1,null!==(l=m.max)&&void 0!==l?l:1),n=.5*((null!==(o=u.mean)&&void 0!==o?o:.5)+(null!==(c=m.mean)&&void 0!==c?c:.5)),t=.5*((null!==(h=u.std)&&void 0!==h?h:.5)+(null!==(x=m.std)&&void 0!==x?x:.5));return{min:Math.max(e,n-3*t),max:Math.min(a,n+3*t)}}default:console.warn(`Unsupported norm ${d}`)}return{min:0,max:1}}),[u,m,d]);function U(e){return e instanceof A.G?{min:e.transfer.min,max:e.transfer.max,mode:1}:{min:0,max:0,mode:0}}(0,c.useEffect)((()=>{if(r.current){const e=r.current.uniforms;e.mode.value=s,e.sizeCoef.value=S,e.tilt.value=o,e.lateral.value=l,e.domain.value=F,e.verticalSeparator.value=h,e.kernelCoefs.value=k,e.kernelSize.value=z,(0,_.l)()}}),[r.current,s,S,l,o,u,m,F,h,k,z,C]),(0,c.useEffect)((()=>{if(r.current){const a=r.current.uniforms;a.textureA.value=O,a.normA.value=U(e.imageA),(0,_.l)()}}),[C,O,r.current]),(0,c.useEffect)((()=>{if(r.current){const a=r.current.uniforms;a.textureB.value=w,a.normB.value=U(e.imageB),(0,_.l)()}}),[C,w,r.current]);const[T,D]=null!==(t=null===(i=e.imageA)||void 0===i?void 0:i.shape)&&void 0!==t?t:[1024,1024];return(0,c.useEffect)((()=>{Z(`Debug vertexShader?:${void 0!==j} fragmentShader?:${void 0!==L} textureA?:${void 0!==O} textureB?:${void 0!==w}`)}),[j,L,O,w]),void 0===j||void 0===L||void 0===O||void 0===w?(0,I.jsx)(I.Fragment,{}):(0,I.jsxs)("mesh",{children:[(0,I.jsx)("planeGeometry",{attach:"geometry",args:[D*S*2,T*S*2,1,1]}),(0,I.jsx)(E,{lateral:l*S,onLateralChanged:a=>{var n;null===(n=e.onLateralChanged)||void 0===n||n.call(e,.5*a/S)},onLateralIntermediateChanged:a=>{var n;null===(n=e.onLateralIntermediateChanged)||void 0===n||n.call(e,.5*a/S)},threshold:0,displayMode:s,verticalSeparator:h,disabled:!f}),(0,I.jsx)("compareMaterial",{attach:"material",ref:r,vertexShader:j,fragmentShader:L},C)]})}(0,_.e)({CompareMaterial:O});var z=n(70624);function k(e,a,n,t){if(a===n)return e;if("rad"===a&&"deg"===n)return 180*e/Math.PI;if("deg"===a&&"rad"===n)return Math.PI*e/180;if("px"===a){if(void 0!==t){return k(e*t.to("mm").scalar,"mm",n,void 0)}return Number.NaN}if("px"===n){if(void 0!==t){return k(e,a,"mm",void 0)/t.to("mm").scalar}return Number.NaN}try{return d()(e,a).to(n).scalar}catch{return console.error(`Convertion ${a}->${n} is not provided`),Number.NaN}}function F(e){const{style:a,className:n,decimals:t=2}=e,i=(0,c.useRef)(null),r=(0,c.useRef)(void 0),[s,l]=(0,c.useState)(!1),o=(0,c.useMemo)((()=>{var a;return void 0===e.preferedDisplayUnit||void 0!==e.pixelSize&&"px"!==e.unit&&"px"!==e.preferedDisplayUnit?null!==(a=e.displayUnit)&&void 0!==a?a:e.unit:e.preferedDisplayUnit}),[e.displayUnit,e.unit,e.preferedDisplayUnit,e.pixelSize]),d=(0,c.useCallback)((a=>{if(void 0!==a&&void 0!==o)return k(a,o,e.unit,e.pixelSize)}),[e.unit,o,e.pixelSize]),u=(0,c.useCallback)((a=>{if(void 0!==a&&void 0!==o)return k(a,e.unit,o,e.pixelSize)}),[e.unit,o,e.pixelSize]);return(0,c.useEffect)((()=>{var a,n;r.current||i.current&&(i.current.value=null!==(a=null===(n=u(e.value))||void 0===n?void 0:n.toFixed(t))&&void 0!==a?a:"")}),[e.value]),(0,I.jsxs)(z.Z,{className:n,style:a,children:[(0,I.jsx)(f.Z.Control,{ref:i,step:e.step,type:"number",style:{backgroundColor:s?"#FFFF80":"transparent"},onChange:e=>{l(!0),r.current=Number.parseFloat(e.target.value)},onBlur:()=>{!function(){if(void 0!==r.current){var a,n;r.current=void 0,i.current&&(i.current.value=null!==(a=null===(n=u(e.value))||void 0===n?void 0:n.toFixed(t))&&void 0!==a?a:""),l(!1)}}()},onKeyDown:a=>/^[ a-z]$/i.test(a.key)?(a.preventDefault(),!1):(a.stopPropagation(),"Enter"===a.key&&function(){if(void 0===r.current)return;const a=r.current,n=d(a);var s;r.current=void 0,i.current&&(i.current.value=a.toFixed(t)),void 0!==n&&(null===(s=e.onChange)||void 0===s||s.call(e,n)),l(!1)}(),!0)}),(0,I.jsx)(z.Z.Text,{children:(m=o,"um"===m?"\u03bcm":m)})]});var m}function U(e){const{style:a,className:n}=e,t=(0,c.useRef)({value:0,dragging:!1});return(0,I.jsx)(f.Z.Range,{className:n,style:a,min:e.min,max:e.max,value:e.value,step:e.step,onChange:a=>{const n=Number.parseFloat(a.target.value);var i,r;(t.current.value=n,t.current.dragging)?null===(i=e.onIntermediateChange)||void 0===i||i.call(e,n):null===(r=e.onChange)||void 0===r||r.call(e,n)},onMouseDown:e=>{t.current.dragging=!0},onMouseUp:a=>{var n;t.current.dragging=!1,null===(n=e.onChange)||void 0===n||n.call(e,t.current.value)}})}var T=n(6510),D=n(94443),P=n(98476),G=n(35540);function H(e){const{geometry:a,lineWidth:n=2,color:t="blue",opacity:i=1,zIndex:r=1,visible:s=!0,readOnly:l=void 0===e.onGeometryChanged}=e,[o,d]=(0,c.useState)(!1);return s?(0,I.jsxs)("group",{position:[0,a.y,r],children:[(0,I.jsx)(D.b,{children:(0,I.jsx)(G._,{pos:[0,a.y],size:[999999,P.FE],pointer:"ns-resize",zIndex:r+P.BG,enabled:!l,onPositionChanged:(a,n)=>{var t;null===(t=e.onGeometryChanged)||void 0===t||t.call(e,{y:a[1]},n)},onEnter:()=>{d(!0)},onLeave:()=>{d(!1)}})}),(0,I.jsx)("group",{children:(0,I.jsx)(D.b,{children:(0,I.jsxs)("mesh",{children:[(0,I.jsx)("ambientLight",{}),(0,I.jsx)("planeGeometry",{attach:"geometry",args:[999999,o?P.pU:n,1,1]}),(0,I.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:t,opacity:i})]})})})]}):(0,I.jsx)(I.Fragment,{})}var B=n(2498),$=n(86912),q=n(6935);function V(e){const{as:a,onSelect:n,value:t}=e;function i(e){const{name:a}=g[e],i=e===p.NONE?"fa fa-fw fa-xmark":t===e?"fa fa-fw fa-circle-dot":"fa fa-fw fa-circle";return(0,I.jsxs)($.Z.Item,{eventKey:e,onClick:()=>{n(e)},children:[(0,I.jsx)("i",{className:i}),"\xa0 ",a]})}const{name:r}=g[t],s=t===p.NONE?"Apply a convolution filter":`Filter ${r} enabled`;return(0,I.jsxs)(q.Z,{variant:t!==p.NONE?"primary":"secondary",as:a,title:(0,I.jsx)("i",{title:s,className:"fa fa-filter fa-fw fa-lg"}),id:"bg-vertical-dropdown-6",children:[i(p.NONE),i(p.LAPLACIAN_3x3),i(p.LAPLACIAN_9x9),i(p.SHARPENING_3x3),i(p.UNSHARPENING_3x3),i(p.UNSHARPENING_5x5),i(p.SMOOTH_3x3),i(p.SMOOTH_5x5),i(p.SMOOTH_7x7)]})}var W=n(39310),X=n(43285);var K=n(43162);function J(e){const{config:a}=e;return(0,I.jsxs)(q.Z,{title:(0,I.jsx)("i",{title:"Extra options",className:"fa fa-sliders fa-fw fa-lg"}),children:[(0,I.jsxs)($.Z.Header,{children:[(0,I.jsx)("h5",{style:{width:"8em"},children:"Auto contrast"}),(0,I.jsxs)(m.Z,{children:[(0,I.jsx)(h.Z,{variant:a.autoscaleMode===R.me.None?"primary":"secondary",onClick:()=>{a.setAutoscaleMode(R.me.None)},children:"None"}),(0,I.jsx)(h.Z,{variant:a.autoscaleMode===R.me.Minmax?"primary":"secondary",onClick:()=>{a.setAutoscaleMode(R.me.Minmax)},children:"Min/max"}),(0,I.jsx)(h.Z,{variant:a.autoscaleMode===R.me.StdDev3?"primary":"secondary",onClick:()=>{a.setAutoscaleMode(R.me.StdDev3)},children:"3\xd7std"})]})]}),(0,I.jsx)($.Z.Header,{children:(0,I.jsxs)(u.Z,{direction:"horizontal",children:[(0,I.jsx)("h5",{style:{width:"8em"},children:"Vertical line"}),(0,I.jsx)(h.Z,{title:"Show/hide a vertical line",variant:a.displayVLine?"primary":"secondary",onClick:()=>{a.setDisplayVLine((e=>!e))},children:(0,I.jsx)("i",{className:`fa ${a.displayVLine?"fa-eye":"fa-eye-slash"} fa-fw fa-lg`})})]})}),(0,I.jsx)($.Z.Header,{children:(0,I.jsxs)(u.Z,{direction:"horizontal",children:[(0,I.jsx)("h5",{style:{width:"8em"},children:"Horizontal line"}),(0,I.jsx)(h.Z,{title:"Show/hide an horizontal line",variant:a.displayHLine?"primary":"secondary",onClick:()=>{a.setDisplayHLine((e=>!e))},children:(0,I.jsx)("i",{className:`fa ${a.displayHLine?"fa-eye":"fa-eye-slash"} fa-fw fa-lg`})})]})}),(0,I.jsx)($.Z.Header,{children:(0,I.jsxs)(u.Z,{direction:"horizontal",children:[(0,I.jsx)("h5",{style:{width:"8em"},children:"Show axes"}),(0,I.jsx)(h.Z,{title:"Show/hide the axes",variant:a.displayAxes?"primary":"secondary",onClick:()=>{a.setDisplayAxes(!a.displayAxes)},children:(0,I.jsx)("i",{className:`fa ${a.displayAxes?"fa-eye":"fa-eye-slash"} fa-fw fa-lg`})})]})}),(0,I.jsx)($.Z.Header,{children:(0,I.jsxs)(u.Z,{direction:"horizontal",children:[(0,I.jsx)("h5",{style:{width:"8em"},children:"Axis unit"}),(0,I.jsxs)(m.Z,{children:[(0,I.jsx)(h.Z,{title:"Display axis as pixel",variant:"px"===a.preferedUnit?"primary":"secondary",onClick:()=>{a.setPreferedUnit("px")},children:"px"}),(0,I.jsx)(h.Z,{title:"Display axis as milimeter if possible",variant:"mm"===a.preferedUnit?"primary":"secondary",onClick:()=>{a.setPreferedUnit("mm")},children:"mm"})]})]})})]})}var Y=n(48542),Q=n(4363);function ee(e){const{value:a,onChanged:n}=e;return(0,I.jsxs)(m.Z,{children:[(0,I.jsx)(h.Z,{variant:a===L.IMAGE_A?"primary":"secondary",title:"Only display the image A",onClick:()=>{n(L.IMAGE_A)},children:(0,I.jsx)("i",{className:"fa fa-a fa-fw fa-lg"})}),(0,I.jsx)(h.Z,{variant:a===L.IMAGE_B?"primary":"secondary",title:"Only display the image B",onClick:()=>{n(L.IMAGE_B)},children:(0,I.jsx)("i",{className:"fa fa-b fa-fw fa-lg"})})]})}var ae=n(29387);function ne(e){const{value:a,onChanged:n,mixedMode:t,onMixedModeChanged:i}=e;function r(e){return(0,I.jsx)(h.Z,{variant:a===e.value?"primary":"secondary",onClick:()=>{n(e.value),i(e.value)},children:e.children})}return(0,I.jsxs)(ae.Z,{title:(0,I.jsx)("i",{title:"Blend the two images",className:"fa fam-compare-mode fa-lg"}),variant:(s=a,s>=100&&s<300?"primary":"secondary"),align:{lg:"start"},autoClose:!1,onClick:()=>{n(t)},children:[(0,I.jsxs)($.Z.Header,{children:[(0,I.jsxs)("h5",{children:[(0,I.jsx)("i",{className:"fa fam-compare-mode"})," Grey scale"]}),(0,I.jsxs)(m.Z,{children:[(0,I.jsx)(r,{value:L.MIN,children:"Min"}),(0,I.jsx)(r,{value:L.MAX,children:"Max"}),(0,I.jsx)(r,{value:L.DIFF,children:"Diff"}),(0,I.jsx)(r,{value:L.ERROR,children:"Error"}),(0,I.jsx)(r,{value:L.MUL,children:"A\xd7B"}),(0,I.jsx)(r,{value:L.HSPLITTER,children:"Split"})]})]}),(0,I.jsxs)($.Z.Header,{children:[(0,I.jsxs)("h5",{children:[(0,I.jsxs)("span",{className:"fa-stack",children:[(0,I.jsx)("i",{className:"fa fam-compare-mode-left fa-stack-1x",style:{color:"cyan"}}),(0,I.jsx)("i",{className:"fa fam-compare-mode-center fa-stack-1x"}),(0,I.jsx)("i",{className:"fa fam-compare-mode-right fa-stack-1x",style:{color:"lime"}})]})," ","Green & Cyan"]}),(0,I.jsxs)(m.Z,{children:[(0,I.jsx)(r,{value:L.MIN_COLOR,children:"Min"}),(0,I.jsx)(r,{value:L.MAX_COLOR,children:"Max"}),(0,I.jsx)(r,{value:L.DIFF_COLOR,children:"Diff"}),(0,I.jsx)(r,{value:L.ERROR_COLOR,children:"Error"}),(0,I.jsx)(r,{value:L.MUL_COLOR,children:"A\xd7B"}),(0,I.jsx)(r,{value:L.HSPLITTER_COLOR,children:"Split"})]})]})]});var s}function te(e){var a;const n=(0,c.useRef)(null!==(a=e.defaultValue)&&void 0!==a?a:""),[t,i]=(0,c.useState)(!1);function r(){var a;null===(a=e.onChange)||void 0===a||a.call(e,n.current),i(!1)}const s=e=>{"Enter"===e.key&&e.ctrlKey&&r()};return c.useEffect((()=>(document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)})),[]),(0,I.jsxs)(u.Z,{direction:"vertical",gap:1,className:"mx-auto",children:[(0,I.jsx)("textarea",{rows:5,cols:40,defaultValue:n.current,onChange:e=>{var a;a=e.target.value,n.current=a,i(!0)}}),(0,I.jsx)(h.Z,{variant:t?"primary":"secondary",onClick:()=>{r()},children:"Apply (Ctrl+Return)"})]})}function ie(e){const{value:a,onChanged:n,customFunc:t,onCustomFuncChanged:i}=e;return(0,I.jsx)(ae.Z,{title:(0,I.jsx)("i",{title:"Advanced blending based on custom webgl code",className:"fa fa-square-root-variable fa-fw fa-lg"}),variant:a===L.CUSTOM?"primary":"secondary",align:{lg:"start"},autoClose:!1,onClick:()=>{n(L.CUSTOM)},children:(0,I.jsx)($.Z.Header,{children:(0,I.jsx)(te,{defaultValue:t,onChange:e=>{i(e)}})})})}var re=n(95100),se=n(37668);var le=n(79008),oe=n(38213),de=n(82794),ce=n(91328);function ue(e){const{value:a=null,unit:n,displayUnit:t,style:i,className:r,decimals:s=2}=e,[l,o]=function(e,a,n,t){return(0,c.useMemo)((()=>{function i(e){return"um"===e?"\u03bcm":e}function r(e){return e.toFixed(t).replace(/\.?0+$/,"")}return null===e?["\u2205",""]:a===n?[r(e),i(n)]:[r(d()(e,a).to(n).scalar),i(n)]}),[e,a,n])}(a,n,null!==t&&void 0!==t?t:n,s);return(0,I.jsxs)("span",{style:i,className:r,title:`${a} ${n}`,children:[l," ",(u=o,"um"===u?"\u03bcm":u)]});var u}function me(e){var a,n,t;const{nabuCorrection:i,decimals:r=2,lateralUnit:s="mm"}=e;if(null===i)return(0,I.jsx)(I.Fragment,{});const l=null===(a=i.exception)||void 0===a?void 0:a.message;return(0,I.jsxs)(oe.Z,{children:[(0,I.jsxs)(de.Z,{children:[(0,I.jsx)(ce.Z,{xs:4,children:"Estimator"}),(0,I.jsx)(ce.Z,{xs:8,children:i.method?"nabu":"none"})]}),(0,I.jsxs)(de.Z,{children:[(0,I.jsx)(ce.Z,{xs:4,children:"Method"}),(0,I.jsx)(ce.Z,{xs:8,children:i.method})]}),(0,I.jsxs)(de.Z,{children:[(0,I.jsx)(ce.Z,{xs:4,children:"Lateral"}),(0,I.jsx)(ce.Z,{xs:8,children:(0,I.jsx)(ue,{value:null!==(n=null===i||void 0===i?void 0:i.lateral_corr)&&void 0!==n?n:0,unit:"mm",displayUnit:s,decimals:r})})]}),(0,I.jsxs)(de.Z,{children:[(0,I.jsx)(ce.Z,{xs:4,children:"Tilt"}),(0,I.jsx)(ce.Z,{xs:8,children:(0,I.jsx)(ue,{value:null!==(t=null===i||void 0===i?void 0:i.camera_tilt)&&void 0!==t?t:0,unit:"deg",decimals:r})})]}),l&&(0,I.jsxs)(de.Z,{children:[(0,I.jsx)(ce.Z,{xs:4,children:"Failure?"}),(0,I.jsx)(ce.Z,{xs:8,children:l})]})]})}function he(e){var a,n;const{description:t}=e;return null===t?(0,I.jsx)(I.Fragment,{}):(0,I.jsxs)(oe.Z,{children:[(0,I.jsxs)(de.Z,{children:[(0,I.jsx)(ce.Z,{xs:4,children:"Lateral axis"}),(0,I.jsx)(ce.Z,{xs:8,children:null===(a=t.lateral_motor)||void 0===a?void 0:a.name})]}),(0,I.jsxs)(de.Z,{children:[(0,I.jsx)(ce.Z,{xs:4,children:"Tilt axis"}),(0,I.jsx)(ce.Z,{xs:8,children:null===(n=t.camera_tilt_motor)||void 0===n?void 0:n.name})]})]})}var xe=n(30);function ve(e){var a,n,t,i,r,s,l,o,d,g,j,y;const{imageA:C,imageB:b,pixelSize:M,config:N,parameters:S,procedure:_,ignoreTilt:A=!1,decimals:R=2,lateralUnit:Z="um"}=e,[O,E]=(0,c.useState)(L.MIN_COLOR),[z,k]=(0,c.useState)(L.MIN_COLOR),D=(0,c.useRef)(null),[P,G]=(0,c.useState)(0),[$,q]=(0,c.useState)(0),ae=(0,se.y)("zoom"),{mouseMode:te}=ae,[oe,de]=(0,c.useState)(void 0),[ce,ue]=(0,c.useState)(p.NONE),[ve,fe]=(0,c.useState)(0),[pe,ge]=(0,c.useState)("// a: Intensity from image A, [0..1], -1 = out\n// b: Intensity from image B, [0..1], -1 = out\n// return: R, G, B, alpha values, [0..1]\nreturn vec4(a, b, 0.0, 1.0);"),je=(0,Y.rB)(),ye=(0,le.wi)(_.id),[Ce,be,Me]=function(e){const[a,n,t]=(0,X.Z)(e,{behavior:"destroyFuture"}),[i,r]=(0,c.useState)(void 0);return[(0,c.useMemo)((()=>({...a,...i})),[a,i]),function(e,a){a?r((a=>({...a,...e}))):(n((a=>({...a,...e}))),r((()=>{})))},t]}({lateral:0,tilt:0});(0,c.useEffect)((()=>{var e,a;Me.reset({lateral:null!==(e=S.nabu_lateral_corr)&&void 0!==e?e:0,tilt:(A?0:null!==(a=S.nabu_camera_tilt)&&void 0!==a?a:0)*(Math.PI/180)})}),[null!==(a=S.nabu_lateral_corr)&&void 0!==a?a:0,null!==(n=S.nabu_camera_tilt)&&void 0!==n?n:0]);const{tilt:Ne,lateral:Se}=Ce,_e=(0,c.useMemo)((()=>{if(void 0!==M&&"px"!==N.preferedUnit)return M.to("mm").scalar}),[N.preferedUnit,M]);function Ae(e){be({tilt:e},!0)}function Re(e){be({lateral:e},!0)}function Ie(e){be({tilt:e},!1)}function Ze(e){be({lateral:e},!1)}(0,c.useEffect)((()=>{var e;null===(e=D.current)||void 0===e||e.actions.clearLater()}),[C,b]);const[Le,Oe]=null!==(t=null===C||void 0===C||null===(i=C[0])||void 0===i?void 0:i.shape)&&void 0!==t?t:[1024,1024],{abscissaConfig:Ee,ordinateConfig:we}=(0,c.useMemo)((()=>{const e=_e?"mm":"px",a=null!==_e&&void 0!==_e?_e:1;return{abscissaConfig:{visDomain:[-Oe*a*.8,Oe*a*.8],label:`x (${e})`},ordinateConfig:{visDomain:[-Le*a*.6,Le*a*.6],label:`y (${e})`}}}),[Oe,Le,_e]),ze="AWAITING_USER_INPUT"===(null===(r=_.properties)||void 0===r?void 0:r.state),ke="ABORTING"===(null===(s=_.properties)||void 0===s?void 0:s.state),Fe="RUNNING"===_.properties.state||ze||ke,Ue=function(e){const{nabu_method:a,nabu_lateral_corr:n,nabu_camera_tilt:t,nabu_exception:i}=e;return a||n||t||i?{method:a,lateral_corr:n,camera_tilt:t,exception:i}:null}(S),Te=function(e){const{lateral_motor:a,camera_tilt_motor:n}=e;return a||n?{lateral_motor:a,camera_tilt_motor:n}:null}(S);(0,c.useEffect)((()=>{ze||"move-lateral"!==ae.mouseMode||ae.resetMouseMode()}),[ze]);const De=(0,c.useMemo)((()=>({"move-lateral":"ew-resize"})),[]);return(0,I.jsxs)(u.Z,{direction:"horizontal",gap:2,onKeyDown:a=>{var n,t,i,r;(" "===a.key&&(k((e=>e===L.IMAGE_A?L.IMAGE_B:L.IMAGE_A)),a.preventDefault()),"ArrowLeft"===a.key)&&(Ze(Se-.5*Number(null!==(n=null===(t=e.pixelSize)||void 0===t?void 0:t.scalar)&&void 0!==n?n:0)),a.preventDefault());"ArrowRight"===a.key&&(Ze(Se+.5*Number(null!==(i=null===(r=e.pixelSize)||void 0===r?void 0:r.scalar)&&void 0!==i?i:0)),a.preventDefault())},tabIndex:-1,style:e.style,children:[(0,I.jsxs)(u.Z,{direction:"vertical",style:{alignSelf:"stretch",flexGrow:4,minWidth:0},children:[(0,I.jsxs)(v.ZP,{align:"center",style:{zIndex:1},children:[(0,I.jsx)(Q.Z,{mouseModeInteraction:ae}),(0,I.jsxs)(m.Z,{children:[(0,I.jsx)(h.Z,{title:"Reset zoom",variant:"secondary",onClick:()=>{var e;null===D||void 0===D||null===(e=D.current)||void 0===e||e.actions.resetZoom()},children:(0,I.jsx)("i",{className:"fa fa-expand fa-fw fa-lg"})}),(0,I.jsx)(h.Z,{disabled:!je[2].canUndo,title:"Undo the last changes applied to the corrections",onClick:()=>{je[2].undo()},children:(0,I.jsx)("i",{className:"fa fa-reply fa-fw fa-lg"})}),(0,I.jsx)(h.Z,{disabled:!je[2].canRedo,title:"Redo the last reverted changes applied to the corrections",onClick:()=>{je[2].redo()},children:(0,I.jsx)("i",{className:"fa fa-share fa-fw fa-lg"})})]}),(0,I.jsx)(v.Z0,{}),(0,I.jsx)(re.t,{mouseModeInteraction:ae}),(0,I.jsx)(ee,{value:z,onChanged:e=>{k(e)}}),(0,I.jsx)(ne,{value:z,onChanged:e=>{k(e)},mixedMode:O,onMixedModeChanged:E}),(0,I.jsx)(ie,{value:z,onChanged:e=>{k(e)},customFunc:pe,onCustomFuncChanged:e=>{ge(e)}}),(0,I.jsx)(V,{value:ce,onSelect:e=>{ue(e)}}),(0,I.jsx)(v.Z0,{}),(0,I.jsx)(J,{config:N})]}),(0,I.jsx)(c.Suspense,{fallback:null,children:(0,I.jsxs)(B.HI,{undoableViewpoint:je,plotRef:D,abscissaConfig:Ee,ordinateConfig:we,aspect:"equal",showAxes:N.displayAxes,onMouseInteractionOverlayChanged:de,cursors:De,mouseMode:te,children:[(0,I.jsx)(W.v,{unit:void 0===_e?"px":"mm"}),(0,I.jsx)(xe.z,{loading:e.loading,warning:void 0===C||void 0===b?"No data":void 0}),C&&b&&(0,I.jsx)(w,{imageA:C[0],imageB:b[0],stateA:C[1],stateB:b[1],displayMode:z,lateral:2*-Se/(null!==(l=null===(o=e.pixelSize)||void 0===o?void 0:o.scalar)&&void 0!==l?l:0),pixelSize:"px"!==N.preferedUnit?e.pixelSize:void 0,onLateralChanged:a=>{var n,t;Ze(-a*(null!==(n=null===(t=e.pixelSize)||void 0===t?void 0:t.scalar)&&void 0!==n?n:0))},onLateralIntermediateChanged:a=>{var n,t;Re(-a*(null!==(n=null===(t=e.pixelSize)||void 0===t?void 0:t.scalar)&&void 0!==n?n:0))},tilt:Ne,autoScale:N.autoscaleMode,verticalSeparator:ve,customFunc:pe,filterMode:ce,lateralInteration:void 0===oe&&"move-lateral"===te}),(0,I.jsx)(T.R,{geometry:{x:P},onGeometryChanged:e=>{G(e.x)},visible:N.displayVLine}),(0,I.jsx)(H,{geometry:{y:$},onGeometryChanged:e=>{q(e.y)},visible:N.displayHLine}),(0,I.jsx)(H,{geometry:{y:ve},color:"red",onGeometryChanged:e=>{fe(e.y)},visible:z===L.HSPLITTER||z===L.HSPLITTER_COLOR}),(0,I.jsx)(K.Z,{mouseMode:te,disabled:void 0!==oe,plotUnit:void 0===_e?"px":"mm"})]})})]}),(0,I.jsx)(u.Z,{direction:"vertical",gap:2,className:"m-1",style:{width:"20em"},children:(0,I.jsxs)(u.Z,{style:{minWidth:"20em"},className:"mt-4",direction:"vertical",gap:2,children:[(0,I.jsx)(x.Z,{in:!!Te,dimension:"height",children:(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Description"}),(0,I.jsx)(he,{description:Te})]})}),(0,I.jsx)(x.Z,{in:!!Ue,dimension:"height",children:(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Estimation"}),(0,I.jsx)(me,{nabuCorrection:Ue,lateralUnit:Z,decimals:R})]})}),(0,I.jsx)(x.Z,{in:ze,dimension:"height",children:(0,I.jsxs)("div",{children:[(0,I.jsx)("h4",{children:"Correction"}),(0,I.jsxs)(u.Z,{className:"mb-2",direction:"horizontal",children:[(0,I.jsx)(h.Z,{className:"me-1",variant:"move-lateral"===te?"primary":"secondary",title:"Shift the two images to compare and edit the ROIs",onClick:()=>{ae.setOrResetMouseMode("move-lateral")},children:(0,I.jsx)("i",{className:"fa fa-arrow-right-arrow-left fa-fw fa-lg"})}),(0,I.jsxs)(m.Z,{children:[(0,I.jsx)(h.Z,{disabled:!Me.canUndo,title:"Undo the last changes applied to the corrections",onClick:()=>{Me.undo()},children:(0,I.jsx)("i",{className:"fa fa-reply fa-fw fa-lg"})}),(0,I.jsx)(h.Z,{disabled:!Me.canRedo,title:"Redo the last reverted changes applied to the corrections",onClick:()=>{Me.redo()},children:(0,I.jsx)("i",{className:"fa fa-share fa-fw fa-lg"})})]})]}),(0,I.jsxs)(u.Z,{direction:"horizontal",gap:2,children:[(0,I.jsx)(f.Z.Label,{style:{width:"5em"},children:"Lateral"}),(0,I.jsxs)(u.Z,{direction:"vertical",gap:2,children:[(0,I.jsx)(F,{value:Se,unit:"mm",preferedDisplayUnit:Z,step:.01,decimals:R,onChange:e=>{Ze(e)},onIntermediateChange:e=>{Re(e)}}),(0,I.jsx)(F,{value:Se,unit:"mm",decimals:R,preferedDisplayUnit:"px",pixelSize:e.pixelSize,step:.01,onChange:e=>{Ze(e)},onIntermediateChange:e=>{Re(e)}}),(0,I.jsx)(U,{min:-200*(null!==(d=null===(g=e.pixelSize)||void 0===g?void 0:g.scalar)&&void 0!==d?d:0),max:200*(null!==(j=null===(y=e.pixelSize)||void 0===y?void 0:y.scalar)&&void 0!==j?j:0),value:Se,step:.01,onChange:e=>{Ze(e)},onIntermediateChange:e=>{Re(e)}})]})]}),!A&&(0,I.jsxs)(u.Z,{direction:"horizontal",gap:2,children:[(0,I.jsx)(f.Z.Label,{style:{width:"5em"},children:"Tilt"}),(0,I.jsxs)(u.Z,{direction:"vertical",gap:2,children:[(0,I.jsx)(F,{step:.01,value:Ne,unit:"rad",decimals:R,displayUnit:"deg",onChange:e=>{Ie(e)},onIntermediateChange:e=>{Ae(e)}}),(0,I.jsx)(U,{min:-1,max:1,step:.01,value:Ne,onChange:e=>{Ie(e)},onIntermediateChange:e=>{Ae(e)}})]})]}),(0,I.jsxs)(u.Z,{className:"mx-auto mt-4 justify-content-center",direction:"horizontal",gap:2,children:[(0,I.jsx)(h.Z,{variant:"danger",size:"lg",disabled:!ze,onClick:()=>{ye.call("validate",{lateral_corr:Se,camera_tilt:A?null:180*Ne/Math.PI})},title:"This will apply the correction to the axes of the beamline",children:"Apply corrections"}),(0,I.jsx)(h.Z,{size:"lg",onClick:()=>{ye.call("abort")},disabled:!Fe,children:"Abort"})]})]})})]})})]})}var fe=n(84009),pe=n(35875);var ge=n(40714),je=n(69579);r()("daiquiri.components.tomo.TomoAlign");function ye(e){var a,n,t;const{options:i}=e,r=function(){const[e,a]=(0,pe.Z)("tomo/align/colormap/autoscalemode",R.me.StdDev3),[n,t]=(0,pe.Z)("tomo/align/axes",!0),[i,r]=(0,pe.Z)("tomo/align/vline",!1),[s,l]=(0,pe.Z)("tomo/align/hline",!1),[o,d]=(0,pe.Z)("tomo/align/crosshair",!1),[c,u]=(0,pe.Z)("tomo/align/preferedunit","mm");return{autoscaleMode:e,setAutoscaleMode:a,displayAxes:n,setDisplayAxes:t,displayVLine:i,setDisplayVLine:r,displayHLine:s,setDisplayHLine:l,crossHair:o,setCrossHair:d,preferedUnit:c,setPreferedUnit:u}}(),{procedure:o,ignoretilt:u=!1,decimals:m,lateralunit:h}=i,x=(0,je.zy)(null!==o&&void 0!==o?o:""),v=null!==(a=null===x||void 0===x?void 0:x.properties)&&void 0!==a?a:{},f=null!==(n=null===v||void 0===v?void 0:v.parameters)&&void 0!==n?n:{},p=null===(t=f.data_scan)||void 0===t?void 0:t.key,g=(0,c.useMemo)((()=>{if(void 0!==f.pixel_size_mm)return new(d())(f.pixel_size_mm,"mm")}),[f.pixel_size_mm]),j=(0,s.R)({scanId:p,channelNames:["proj0","proj0_min","proj0_max","proj0_min_positive","proj0_mean","proj0_std","proj180","proj180_min","proj180_max","proj180_min_positive","proj180_mean","proj180_std"],start:0,stop:1});function y(e){var a,n;if((null===j||void 0===j||null===(a=j.request)||void 0===a?void 0:a.scanId)!==p)return;const t=null===(n=j.data[e])||void 0===n?void 0:n.pick(0,null,null);return t&&(0,l.AA)(t)}function C(e){var a;const n=null===(a=j.data[e])||void 0===a?void 0:a.pick(0,null,null);if(void 0===n)return;return(0,l.AA)(n).data[0]}function b(e){const a=C(`${e}_min`),n=C(`${e}_max`),t=C(`${e}_min_positive`),i=C(`${e}_mean`),r=C(`${e}_std`);if(void 0!==a&&void 0!==n&&void 0!==t&&void 0!==i&&void 0!==r)return{min:a,max:n,mean:i,std:r,minPositive:t}}const M=y("proj0"),N=y("proj180"),S=b("proj0"),_=b("proj180");function A(e,a){return(0,c.useMemo)((()=>{if(void 0!==e&&void 0!==a)return[e,a]}),[e,a])}const Z=A(M,S),L=A(N,_);try{(0,fe.pi)(M),(0,fe.pi)(N)}catch{return(0,I.jsx)(I.Fragment,{children:"Image data unsupported"})}return null===x?(0,I.jsxs)(ge.Z,{variant:"danger",children:["Procedure ",o," is not available"]}):(0,I.jsx)(ve,{procedureId:null===p||void 0===p?void 0:p.toString(),config:r,procedure:x,parameters:f,pixelSize:g,imageA:Z,imageB:L,loading:j.loading,ignoreTilt:u,decimals:m,lateralUnit:h,style:{flexGrow:1,flexShrink:1,minWidth:0,minHeight:0,alignSelf:"stretch",width:"100%",height:"100%"}})}function Ce(e){return(0,I.jsx)(ye,{...e})}function be(e){const{yamlNode:a,procedure:n,ignoretilt:i,decimals:r,lateralunit:s,...l}=e;t.Ee(a,"procedure",n),t.kC(a,"ignoretilt",i),t.GP(a,"decimals",r),t.Xl(a,"lateralunit",s),t.ol(a,l);const o={procedure:n,ignoretilt:i,decimals:r,lateralunit:s};return(0,I.jsx)(Ce,{options:o})}},24063:(e,a,n)=>{n.d(a,{R:()=>c});var t=n(85083),i=n(20837),r=n(60687),s=n(97133),l=n.n(s);function o(e,a,n){return 0===a&&e.length===n?e:e.subarray(a,n)}class d{constructor(e,a){this.isAborted=void 0,this.isFetching=void 0,this.cache=void 0,this.updateCallback=void 0,this.scanId=void 0,this.description=void 0,this.pendingRequest=void 0,this.isAborted=!1,this.isFetching=!1,this.pendingRequest=void 0,this.description=void 0,this.updateCallback=e,this.scanId=a;const n=t.Z.get(`/scans/data/${a}`);this.cache={},n.then((e=>{this.setupScan(e.data)})).catch((e=>{console.error(e)}))}setupScan(e){this.description=e,this.pendingRequest&&this.fetchPendingRequest()}async fetchData(e,a){if(this.isAborted)return;const n={...e,scanId:this.scanId,errors:a},i=[];this.updateCallback({loading:!0,data:Object.fromEntries(e.channelNames.map((e=>{var a;return[e,null===(a=this.cache[e])||void 0===a?void 0:a.ndarray]}))),request:n}),e.channelNames.forEach((e=>{if(!(e in this.cache)){var a;const n=null===(a=this.description)||void 0===a?void 0:a.data[e];if(void 0!==n){const a=n.dtype,t=n.shape;(0,r.cy)(t);const i=t.reduce(((e,a)=>e*a),1);void 0!==a&&(this.cache[e]={dtype:(0,r.UZ)(a),safeDtype:(0,r.UZ)((0,r.hO)(a)),shape:t,elementSize:i,raw:void 0,ndarray:void 0,nbItems:0})}}}));const s=e.channelNames.map((async a=>{var n;const s=this.cache[a];if(!s||!s.safeDtype)return void i.push(`channel name '${a}' in not part of the scan`);if(e.stop<=e.start)return void(s.ndarray=void 0);const d=null!==(n=s.nbItems)&&void 0!==n?n:0;if(e.stop<=d){const a=o(s.raw,e.start,e.stop);return void(s.ndarray=l()(a,[e.stop-e.start,...s.shape]))}const c=await t.Z.get(`/scans/data/binary/${this.scanId}`,{channel:a,selection:`${d}:${e.stop}`,dtype:"safe"},!0,"arraybuffer").then((e=>e.data)).catch((e=>{const n=e instanceof Error?e.message:String(e);i.push(`Error while fetching '${a}': ${n}`)}));if(void 0===c)return;const u=(0,r.Os)(c,s.safeDtype.numpy),m=function(e,a){if(void 0===e)return a;const n=new a.constructor(e.length+a.length);return n.set(e),n.set(a,e.length),n}(s.raw,u);if(s.raw=m,s.nbItems=m.length/s.elementSize,s.nbItems<=e.start)return void(s.ndarray=void 0);const h=o(m,e.start*s.elementSize,s.nbItems*s.elementSize);s.ndarray=l()(h,[s.nbItems-e.start,...s.shape])}));await Promise.all(s);const d=0===i.length?void 0:i;void 0===this.pendingRequest?(this.updateCallback({loading:!1,data:Object.fromEntries(e.channelNames.map((e=>{var a;return[e,null===(a=this.cache[e])||void 0===a?void 0:a.ndarray]}))),request:n,errors:d}),this.isFetching=!1):this.fetchPendingRequest(d)}fetchPendingRequest(e){if(this.pendingRequest){const a=this.pendingRequest;this.pendingRequest=void 0,this.fetchData(a,e)}}fetch(e){this.isAborted||(void 0===this.description||this.isFetching?this.pendingRequest=e:(this.isFetching=!0,this.fetchData(e)))}abort(){this.isAborted=!0}}function c(e){const[a,n]=(0,i.useState)({loading:void 0!==e.scanId,data:{}}),{scanId:t,channelNames:r,start:s,stop:l}=e,o=(0,i.useMemo)((()=>{if(void 0!==t)return new d(n,t)}),[t]);return(0,i.useEffect)((()=>()=>{o&&o.abort()}),[o]),(0,i.useEffect)((()=>{o&&r&&void 0!==s&&void 0!==l&&o.fetch({channelNames:r,start:s,stop:l})}),[o,JSON.stringify(r),s,l]),a}},6935:(e,a,n)=>{n.d(a,{Z:()=>h});var t=n(20837),i=n(10612),r=n.n(i),s=n(86912),l=n(88237),o=n(30601),d=n(57459),c=n(69521);const u={id:r().string,href:r().string,onClick:r().func,title:r().node.isRequired,disabled:r().bool,align:d.r,menuRole:r().string,renderMenuOnMount:r().bool,rootCloseEvent:r().string,menuVariant:r().oneOf(["dark"]),flip:r().bool,bsPrefix:r().string,variant:r().string,size:r().string},m=t.forwardRef(((e,a)=>{let{title:n,children:t,bsPrefix:i,rootCloseEvent:r,variant:d,size:u,menuRole:m,renderMenuOnMount:h,disabled:x,href:v,id:f,menuVariant:p,flip:g,...j}=e;return(0,c.jsxs)(s.Z,{ref:a,...j,children:[(0,c.jsx)(l.Z,{id:f,href:v,size:u,variant:d,disabled:x,childBsPrefix:i,children:n}),(0,c.jsx)(o.Z,{role:m,renderOnMount:h,rootCloseEvent:r,variant:p,flip:g,children:t})]})}));m.displayName="DropdownButton",m.propTypes=u;const h=m}}]);
//# sourceMappingURL=939.5d69cf31.chunk.js.map