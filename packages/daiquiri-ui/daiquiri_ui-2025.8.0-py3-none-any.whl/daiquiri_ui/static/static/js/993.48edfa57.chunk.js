"use strict";(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[993],{79842:(e,s,t)=>{t.d(s,{Z:()=>f});var a=t(70775),n=t(20837),i=t(69521);const r=function(e){const{curve:s,onClick:t,onDoubleClick:a}=e;return(0,i.jsxs)("button",{className:"btn-clean entry",type:"button","data-not-visible":s.visible?void 0:"",onClick:()=>t(),onDoubleClick:()=>a(),children:[(0,i.jsx)("div",{className:"handle",style:{backgroundColor:s.color}}),s.name]},s.name)};const c=function(e){const{curves:s,onEntryClick:t,onEntryDoubleClick:a}=e;return(0,i.jsx)("div",{children:s.map(((e,s)=>(0,i.jsx)(r,{curve:e,onClick:()=>t(s),onDoubleClick:()=>a(s)},e.name)))})};const o=function(e){const{curves:s}=e,t=s[0].x,n=(0,a.ne)(t,!0),{abscissaConfig:r}=(0,a.ki)();return(0,i.jsx)(a.p9,{guides:"both",renderTooltip:e=>{const a=n(e);return(0,i.jsxs)("div",{className:"h5web-tooltip",children:[r.label||"x","=",t[a],s.filter((e=>e.visible)).map((e=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("strong",{children:[e.name,":"]})," ",e.y[a]]},e.name)))]})}})};const l=function(e){const{onDataPointClick:s,...t}=e,{abscissas:r,ordinates:c,color:o}=t,[l,d]=(0,n.useState)(),h=(0,a.ne)(r,!0),{worldToData:x}=(0,a.ki)(),p=s?(e,t)=>{const{unprojectedPoint:a}=t,n=x(a),i=h(n.x);s(i,t)}:void 0,u=s?(e,s)=>{const{unprojectedPoint:t}=s,a=x(t);d(h(a.x))}:void 0,m=s?()=>d(void 0):void 0;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.b0,{onDataPointClick:p,onDataPointEnter:u,onDataPointLeave:m,...t}),l&&(0,i.jsx)(a.q6,{x:r[l],y:c[l],center:!0,children:(0,i.jsx)("svg",{className:"line-hover-svg",style:{fill:o},children:(0,i.jsx)("circle",{r:4})})})]})};var d=t(22205),h=t(26799),x=t(15568);const p=function(e){const{shapes:s=[],annotations:t=[]}=e,{width:n,height:r}=(0,h.A)((e=>e.size)),{dataToHtml:c}=(0,a.ki)(),o=function(){const{abscissaScale:e,ordinateScale:s}=(0,a.ki)(),[t,n]=e.domain(),[i,r]=s.domain();return(e,s,a,c)=>{const o="paper"===a?t+e*(n-t):e,l="paper"===c?i+s*(r-i):s;return new x.Vector3(o,l)}}(),l=(0,a.Jk)((e=>s.map((s=>({v0:c(e,o(s.x0,s.y0,s.xref,s.yref)),v1:c(e,o(s.x1,s.y1,s.xref,s.yref)),...s})))),[s]),d=(0,a.Jk)((e=>t.map(((s,t)=>({v:c(e,o(s.x,s.y,s.xref,s.yref)),...s})))),[t]);return(0,i.jsx)(a.aV,{children:(0,i.jsxs)("svg",{width:n,height:r,children:[l.map(((e,s)=>{const{v0:t,v1:a,fillcolor:n,line:r,opacity:c}=e;return(0,i.jsx)("rect",{x:Math.min(t.x,a.x),y:Math.min(t.y,a.y),width:Math.abs(a.x-t.x),height:Math.abs(a.y-t.y),fill:n,strokeWidth:null===r||void 0===r?void 0:r.width,fillOpacity:c},s)})),d.map(((e,s)=>{const{text:t,v:a}=e;return(0,i.jsx)("text",{x:a.x,y:a.y,textAnchor:"middle",children:t},s)}))]})})};const u=function(e){const{onValidSelection:s}=e,t=(0,h.A)((e=>e.camera)),{ordinateConfig:n,dataToHtml:r,dataToWorld:c}=(0,a.ki)(),[o,l]=n.visDomain;return(0,i.jsx)(a.Br,{axis:"x",onValidSelection:e=>{const{data:a}=e,n=new x.Vector3(a[0].x,o),i=new x.Vector3(a[1].x,l);s({data:[n,i],html:[r(t,n),r(t,i)],world:[c(n),c(i)]})},children:e=>{let{html:s}=e;return(0,i.jsx)(a.y8,{children:(0,i.jsx)(a.Ev,{coords:s,fill:"gray",fillOpacity:.25})})}})},m=["#1f77b4","#ff7f0e","#2ca02c","#d62728"],g=[.1,1];const f=function(e){var s,t;const{data:r,insetLegend:h,onClick:x,curveType:f,layout:j,onRoiSelection:v}=e,[y,S]=(0,n.useState)(r.map((()=>!0))),C=r.filter(d.$K).flatMap(((e,s)=>{const{x:t,y:n,name:i}=e;if(!(0,d.cj)(n))return[];const r=(0,a.Bl)(t,n.length);return[{color:m[s%m.length],visible:y[s],name:i,x:Array.isArray(r)?r:[...r],y:n}]})),A=(0,a.k9)((0,a.J9)(C.map((e=>e.x))))||g,k=(0,a.k9)((0,a.J9)(C.map((e=>e.y))))||g;if(0===C.length)return(0,i.jsx)("div",{children:"No curve data. Please select a series."});const b=e=>{S(y.map(((s,t)=>t===e?!s:s)))},Z=e=>{S(y.map(((s,t)=>t===e)))};return(0,i.jsxs)("div",{className:"h5web-plot",children:[(0,i.jsxs)(a.Ic,{abscissaConfig:{visDomain:A,showGrid:!0,label:null===j||void 0===j||null===(s=j.xaxis)||void 0===s?void 0:s.title},ordinateConfig:{visDomain:k,showGrid:!0,label:null===j||void 0===j||null===(t=j.yaxis)||void 0===t?void 0:t.title},raycasterThreshold:6,children:[C.map((e=>(0,i.jsx)(l,{abscissas:e.x,ordinates:e.y,color:e.color,visible:e.visible,onDataPointClick:x,glyphSize:6,glyphType:a.j$.Circle,curveType:f},e.name))),(0,i.jsx)(a.Ce,{}),(0,i.jsx)(a.LG,{}),(0,i.jsx)(a.XZ,{modifierKey:"Control"}),(0,i.jsx)(o,{curves:C}),(0,i.jsx)(a.DG,{}),h&&(0,i.jsx)(a.Vt,{children:C.length>1&&(0,i.jsx)("div",{className:"h5web-legend","data-inset":"",children:(0,i.jsx)(c,{curves:C,onEntryClick:b,onEntryDoubleClick:Z})})}),j&&(0,i.jsx)(p,{shapes:j.shapes,annotations:j.annotations}),v&&(0,i.jsx)(u,{onValidSelection:v})]}),!h&&C.length>1&&(0,i.jsx)("div",{className:"h5web-legend",children:(0,i.jsx)(c,{curves:C,onEntryClick:b,onEntryDoubleClick:Z})})]})}},22205:(e,s,t)=>{function a(e){const[s]=e;return!!s&&Object.getOwnPropertyNames(s).includes("marker")}function n(e){return void 0!==e&&null!==e}function i(e){return n(e)&&e.length>0}t.d(s,{$K:()=>n,cj:()=>i,sM:()=>a})},24993:(e,s,t)=>{t.r(s),t.d(s,{default:()=>O});var a=t(52799),n=t(79153),i=t(60979),r=t(20729),c=t(96956),o=t(42473),l=t.n(o),d=t(20837),h=t(18578),x=t(38213),p=t(82794),u=t(91328),m=t(70624),g=t(18941),f=t(70775),j=t(22205),v=t(79842),y=t(97133),S=t.n(y),C=t(69521);const A=[0,1];const k=function(e){const{x:s,y:t,dataValues:a,size:n,colorMap:i,title:r,onClick:c}=e,o=(0,f.ay)(a)||A,l=a.length,h=(0,f.y)(s,l),x=(0,f.y)(t,l),p=(0,d.useMemo)((()=>S()(a)),[a]);return(0,C.jsx)(f.$T,{abscissaParams:{value:h},ordinateParams:{value:x},dataArray:p,domain:o,colorMap:i,size:n,onPointClick:c,title:r})};const b=function(e){const{data:s,onClick:t}=e,[a]=s;if(void 0===a)return(0,C.jsx)("div",{children:"No data. Please select a scan."});const{marker:n,x:i,y:r}=a,{color:c,colorscale:o,size:l}=n;return(0,j.cj)(c)?(0,C.jsx)(k,{x:i,y:r,dataValues:c,colorMap:o,size:l,onClick:t,title:a.name}):(0,C.jsx)("div",{children:"Values are undefined. Please select a series."})};const Z=function(e){const{data:s,onClick:t}=e;return 0===s.length?(0,C.jsx)("div",{children:"No data to display"}):(0,j.sM)(s)?(0,C.jsx)(b,{data:s,onClick:t}):(0,C.jsx)(v.Z,{data:s,insetLegend:!0,onClick:t,curveType:f.v7.LineAndGlyphs})};var N=t(6935);const P=function(e){const s=s=>{e.onChange({type:s.target.name,axis:s.target.value})};return(0,C.jsx)(N.Z,{title:"Axes",children:(0,C.jsxs)(x.Z,{className:"series-select",children:[(0,C.jsxs)(p.Z,{children:[(0,C.jsx)(u.Z,{xs:1,children:(0,C.jsx)(h.Z,{size:"sm",onClick:()=>e.unselectAxes("x"),className:"mx-auto",children:"x"})}),(0,C.jsx)(u.Z,{xs:1,children:(0,C.jsx)(h.Z,{size:"sm",onClick:()=>e.unselectAxes("y"),className:"mx-auto",children:"y"})}),(0,C.jsx)(u.Z,{className:"text-end",children:(0,C.jsx)(h.Z,{size:"sm",onClick:()=>e.resetAxes(),children:"Reset"})})]}),e.series.map((t=>(0,C.jsxs)(p.Z,{children:[(0,C.jsx)(u.Z,{xs:1,children:(0,C.jsx)(g.Z.Check,{checked:t===e.selected.x,name:"x",type:"radio",onChange:s,value:t,className:"my-auto"})}),(0,C.jsx)(u.Z,{xs:1,children:(0,C.jsx)(g.Z.Check,{checked:t===e.selected.y,name:"y",type:"radio",onChange:s,value:t,className:"my-auto"})}),(0,C.jsx)(g.Z.Label,{column:!0,className:"justify-content-start col-10",children:t})]},t)))]})})};const E=function(e){const s=s=>{e.onChange(s.target.name,s.target.checked)};return(0,C.jsx)(N.Z,{title:"Series",children:(0,C.jsxs)(x.Z,{className:"series-select",children:[(0,C.jsx)("div",{className:"text-end",children:(0,C.jsx)(h.Z,{size:"sm",onClick:()=>e.resetSeries(),children:"Reset"})}),e.series.map((t=>(0,C.jsx)(g.Z.Check,{className:"justify-content-start",checked:t in e.selected,type:"checkbox",id:`${t}-check`,label:t,onChange:s,name:t},t)))]})})};var D=t(91861);class T extends d.Component{constructor(e){super(e),this.doSetPageSize=void 0,this.doSetPage=void 0,this.pageRef=void 0,this.onClick=e=>{void 0!==e&&this.props.actions.selectPoint(e)},this.setPageSize=e=>{this.doSetPage(1),this.doSetPageSize(Number.parseInt(e.target.value,10))},this.setPage=e=>{this.doSetPage(Number.parseInt(e.target.value,10),!0)},this.selectSeries=(e,s)=>{s?this.props.actions.selectSeries(e):this.props.actions.unselectSeries(e)},this.doSetPageSize=(0,c.debounce)(this.props.actions.setPageSize,500),this.doSetPage=(0,c.debounce)(this.props.actions.setPage,500),this.pageRef=(0,d.createRef)()}componentDidMount(){const{options:e={},actions:s}=this.props,{preSelectedXAxis:t,preSelectedSeries:a}=e;s.setFollow(),t&&s.selectAxes({type:"x",axis:t}),a&&(Array.isArray(a)?a.forEach((e=>s.selectSeries(e))):s.selectSeries(a))}componentDidUpdate(e){const s=this.props.data[this.props.selectedScan]||{},t=e.data[e.selectedScan]||{};s.page!==t.page&&this.pageRef.current&&(this.pageRef.current.value=`${s.page||1}`),e.selectedSeries!==this.props.selectedSeries&&this.props.actions.setParams({scalars:[...this.props.selectedAxes.x?[this.props.selectedAxes.x]:[],...this.props.selectedAxes.y?[this.props.selectedAxes.y]:[],...Object.keys(this.props.selectedSeries)]},!0),e.selectedAxes!==this.props.selectedAxes&&this.props.actions.setParams({scalars:[...this.props.selectedAxes.x?[this.props.selectedAxes.x]:[],...this.props.selectedAxes.y?[this.props.selectedAxes.y]:[],...Object.keys(this.props.selectedSeries)]},!0)}render(){const e=(0,D.JD)(this.props.scans);if(null===e)return(0,C.jsx)("span",{children:"No scan loaded."});const s=this.props.selectedScan||e,t=this.props.data[s]||{};if(!t.data)return(0,C.jsx)("span",{children:"Waiting for scan data"});const a=Object.keys(this.props.selectedSeries).length>0?Object.keys(this.props.selectedSeries):t.axes.ys.scalars.filter((e=>!e.startsWith("timer"))).slice(0,2),o=[];if(2===t.axes.xs.length&&!this.props.selectedAxes.x||this.props.selectedAxes.x&&this.props.selectedAxes.y){let e=[],s=[];if(this.props.selectedAxes.x&&this.props.selectedAxes.y){const a=t.data[this.props.selectedAxes.x],n=t.data[this.props.selectedAxes.y];if(!a||!n)return(0,C.jsxs)("span",{children:["The selected axes are not valid for the current scan"," ",(0,C.jsx)(h.Z,{size:"sm",onClick:()=>this.props.actions.resetAxes(),children:"Reset"})]});e=a.data,s=n.data}else{const a=t.data[t.axes.xs[0]],n=t.data[t.axes.xs[1]];e=a?a.data:[],s=n?n.data:[]}(0,c.each)(a,(a=>{if(!t.axes.ys.scalars.includes(a))return;const n=t.data[a];if(n){var i;const t={x:e,y:s,type:"scattergl",name:n.name,mode:"markers",text:null===(i=n.data)||void 0===i?void 0:i.map((e=>e.toPrecision(4))),marker:{size:10,color:n.data&&[...n.data],colorscale:"Viridis"}};o.push(t)}}))}else{const e=this.props.selectedScans?[...Object.values(this.props.selectedScans).map((e=>this.props.data[e]))]:[t];try{(0,c.each)(e,(e=>{let t;if(0!==e.axes.xs.length||this.props.selectedAxes.x){const s=this.props.selectedAxes.x||e.axes.xs[0];t=e.data[s]}else t={data:[0],name:"index",shape:[1]};const n=this.props.scans[e.scanid];if(!t)throw new Error("The selected axes are not valid for the current scan(s)");if(0===t.data.length)throw new Error("Waiting for data for the selected axes");(0,c.each)(a,(a=>{if(!e.axes.ys.scalars.includes(a))return;const i=e.data[a];if(!i)return;if(!i.data)return void console.log(`Data for ${e.scanid} series ${i.name} not loaded yet`);"index"===t.name&&(t.data=(0,c.range)(i.data.length));const{xData:r,yData:d}=function(e,s){return e.length===s.length?{xData:e,yData:s}:e.length>s.length?{xData:e.slice(0,s.length),yData:s}:{xData:e,yData:s.slice(0,e.length)}}(t.data,i.data),h={x:[...r],y:d,type:"scattergl",name:e.scanid===s&&n?i.name:`${l().unix(n.start_timestamp).format("DD-MM-YYYY HH:mm:ss")}: ${i.name}`};o.push(h)}))}))}catch(y){if(y instanceof Error)return(0,C.jsxs)("span",{children:[y.message,(0,C.jsx)(h.Z,{style:{marginLeft:"1rem"},size:"sm",onClick:()=>this.props.actions.resetAxes(),children:"Reset"})]})}}const{options:d}=this.props,{preSelectedXAxis:f,preSelectedSeries:j}=d,{backend:v="h5web"}=d;return(0,C.jsxs)("div",{className:"plot1d-container",children:[(0,C.jsx)(x.Z,{children:(0,C.jsxs)(p.Z,{children:[(0,C.jsx)(u.Z,{xs:"auto",className:"gx-1",children:(0,C.jsx)(P,{onChange:e=>this.props.actions.selectAxes(e),series:[...t.axes.xs,...t.axes.ys.scalars],selected:this.props.selectedAxes,resetAxes:this.props.actions.resetAxes,unselectAxes:this.props.actions.unselectAxes})}),(0,C.jsx)(u.Z,{xs:"auto",className:"gx-1",children:(0,C.jsx)(E,{onChange:this.selectSeries,series:t.axes.ys.scalars,selected:this.props.selectedSeries,resetSeries:this.props.actions.resetSeries})}),(0,C.jsx)(u.Z,{xs:"auto",className:"gx-1",children:(0,C.jsxs)(m.Z,{children:[(0,C.jsx)(m.Z.Text,{children:"Points"}),(0,C.jsxs)(g.Z.Control,{as:"select",onChange:this.setPageSize,value:this.props.pageSize,children:[[5,10,25,100,1e3].map((e=>null===t.npoints||e<t.npoints?(0,C.jsx)("option",{value:e,children:e},e):null)),null!==t.npoints&&(0,C.jsx)("option",{value:t.npoints,children:`All (${t.npoints})`})]})]})}),(0,C.jsx)(u.Z,{xs:"auto",className:"gx-1",children:(0,C.jsxs)(m.Z,{children:[(0,C.jsx)(m.Z.Text,{children:"Page"}),(0,C.jsx)(h.Z,{size:"sm",onClick:()=>this.doSetPage(t.page-1,!0),disabled:1===t.page,children:(0,C.jsx)("i",{className:"fa fa-caret-left"})}),(0,C.jsx)(g.Z.Control,{ref:this.pageRef,type:"number",onChange:this.setPage,defaultValue:t.page,max:t.pages,min:1}),(0,C.jsx)(h.Z,{size:"sm",onClick:()=>this.doSetPage(t.page+1,!0),disabled:t.page===t.pages,children:(0,C.jsx)("i",{className:"fa fa-caret-right"})})]})}),this.props.fetching&&(0,C.jsx)(u.Z,{xs:"auto",children:(0,C.jsx)("i",{className:"fa fa-spin fa-spinner"})})]})}),(0,C.jsx)(r.Z,{children:"h5web"===v?(0,C.jsx)(n.ZP,{children:(0,C.jsx)(Z,{data:o,onClick:this.onClick})}):(0,C.jsx)(i.Z,{data:o,layout:{},onClick:e=>{var s;return this.onClick(null===(s=e.points[0])||void 0===s?void 0:s.pointNumber)}})}),(f||j)&&(0,C.jsxs)("span",{children:[j," vs. ",f]})]})}}var w=t(45425),z=t(12678),_=t(57209),R=t(69048);const M=(0,w.Qg)({scans:z.Z})((0,_.$j)((0,R.Z)((function(e,s,t){const{data:a,list:n}=s.providers.scans;return{data:a.selector("results",e),scans:n.selector("results",e),pageSize:a.selector("per_page",e)||25,fetching:a.selector("fetching",e),selectedSeries:z.Z.selector("selectedDataSeries",e),selectedAxes:z.Z.selector("selectedDataAxes",e),selectedScan:z.Z.selector("selectedScan",e),selectedScans:z.Z.selector("selectedScans",e)}})),(function(e,s){return{actions:{selectPoint:e=>z.Z.dispatch("SCAN_CURRENT_POINT",Number.parseInt(e.toString(),10)),setPageSize:e=>s.providers.scans.data.setPageSize(e,!0),setPage:(e,t)=>s.providers.scans.data.setPage(e,t),setParams:(e,t)=>s.providers.scans.data.setParams(e,t),fetchScanSpectra:e=>s.providers.scans.spectra.fetch(e),selectSeries:e=>z.Z.dispatch("SCAN_DATA_SELECT_SERIES",e),unselectSeries:e=>z.Z.dispatch("SCAN_DATA_UNSELECT_SERIES",e),resetSeries:e=>z.Z.dispatch("SCAN_DATA_RESET_SERIES",e),selectAxes:e=>z.Z.dispatch("SCAN_DATA_SELECT_AXES",e),unselectAxes:e=>z.Z.dispatch("SCAN_DATA_UNSELECT_AXES",e),resetAxes:e=>z.Z.dispatch("SCAN_DATA_RESET_AXES",e),setFollow:()=>{void 0===s.selectedScan&&z.Z.dispatch("RESET_SCAN_SELECTION")}}}}))(T));function O(e){const{providers:s,yamlNode:t,backend:n,preSelectedXAxis:i,preSelectedSeries:r,...c}=e;return a.Xc(t,"backend",n),a.Xl(t,"preSelectedXAxis",i),a.m7(t,"preSelectedSeries",r),a.ol(t,c),(0,C.jsx)(M,{providers:s,options:{backend:n,preSelectedXAxis:i,preSelectedSeries:r}})}},69048:(e,s,t)=>{t.d(s,{Z:()=>r});var a=t(96956),n=t.n(a);class i{constructor(){this.cache=void 0,this.cache={}}debounce(e,s){const t=this.cache[e];return n().isEqual(t,s)?t:(this.cache[e]=s,s)}memo(e,s,t){const a=[void 0,void 0],[i,r]=this.cache[e]||a;if(n().isEqual(r,t))return i;const c=s();return this.cache[e]=[c,t],c}}function r(e){const s=new i;return(t,a)=>e(t,a,s)}},6935:(e,s,t)=>{t.d(s,{Z:()=>p});var a=t(20837),n=t(10612),i=t.n(n),r=t(86912),c=t(88237),o=t(30601),l=t(57459),d=t(69521);const h={id:i().string,href:i().string,onClick:i().func,title:i().node.isRequired,disabled:i().bool,align:l.r,menuRole:i().string,renderMenuOnMount:i().bool,rootCloseEvent:i().string,menuVariant:i().oneOf(["dark"]),flip:i().bool,bsPrefix:i().string,variant:i().string,size:i().string},x=a.forwardRef(((e,s)=>{let{title:t,children:a,bsPrefix:n,rootCloseEvent:i,variant:l,size:h,menuRole:x,renderMenuOnMount:p,disabled:u,href:m,id:g,menuVariant:f,flip:j,...v}=e;return(0,d.jsxs)(r.Z,{ref:s,...v,children:[(0,d.jsx)(c.Z,{id:g,href:m,size:h,variant:l,disabled:u,childBsPrefix:n,children:t}),(0,d.jsx)(o.Z,{role:x,renderOnMount:p,rootCloseEvent:i,variant:f,flip:j,children:a})]})}));x.displayName="DropdownButton",x.propTypes=h;const p=x},57459:(e,s,t)=>{t.d(s,{r:()=>r});var a=t(10612),n=t.n(a);const i=n().oneOf(["start","end"]),r=n().oneOfType([i,n().shape({sm:i}),n().shape({md:i}),n().shape({lg:i}),n().shape({xl:i}),n().shape({xxl:i}),n().object])}}]);
//# sourceMappingURL=993.48edfa57.chunk.js.map