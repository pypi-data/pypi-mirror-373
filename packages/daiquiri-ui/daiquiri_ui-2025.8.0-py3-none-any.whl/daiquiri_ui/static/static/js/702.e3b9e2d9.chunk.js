"use strict";(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[702],{25263:(t,r,e)=>{function n(t){const r=(31744&t)>>10,e=1023&t;return(t>>15?-1:1)*(r?31===r?e?Number.NaN:1/0:2**(r-15)*(1+e/1024):e/1024*6103515625e-14)}e.d(r,{S:()=>o,m:()=>n});class o{constructor(t,r){if(this.shape=void 0,this.dimension=void 0,this.data=void 0,this.dtype=void 0,2!==r.length)throw new Error(`Unsupported dimension ${r.length} with NdFloat16Array`);this.data=t,this.shape=r,this.dimension=r.length,this.dtype="float16"}index(){if(arguments.length!==this.dimension)throw new Error(`Expected ${this.dimension} for indexing`);return(arguments.length<=1?void 0:arguments[1])+(arguments.length<=0?void 0:arguments[0])*this.shape[1]}getRaw(){const t=this.index(...arguments);return this.data[t]}get(){return n(this.getRaw(...arguments))}}},38084:(t,r,e)=>{e.d(r,{M:()=>a});var n=e(20837),o=e(72154);function a(t){const[r,e]=(0,n.useState)(null),a=(0,n.useMemo)((()=>o.Z.getHandler("Celery")),[]);return(0,n.useEffect)((()=>{function r(r){null!==t&&void 0!==t&&t.includes(r.type)&&e(r)}return a.addListener(r),()=>{a.removeListener(r)}}),[t]),r}},96702:(t,r,e)=>{e.r(r),e.d(r,{default:()=>j});var n=e(52799),o=e(57209),a=e(20837),i=e(96956),s=e(18941),c=e(40714),u=e(60979),l=e(20729);e(60687);function d(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Expected H5Dataset";if(!function(t){return t instanceof Object&&"data"in t}(t))throw new Error(r)}function f(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Expected H5Group";if(!function(t){return t instanceof Object&&"children"in t}(t))throw new Error(r)}var h=e(38084),p=e(69521);function y(t){return t.group?1===(0,i.values)(t.group.children).length?null:(0,p.jsx)(s.Z.Control,{as:"select",size:"sm",onChange:r=>t.onChange(r.target.value),children:(0,i.map)(t.group.children,(t=>(0,p.jsx)("option",{value:t.name,children:t.name},t.name)))}):null}function g(t){return void 0===t?null:"string"===typeof t?[t]:t}class m extends Error{constructor(t){super(t),Object.setPrototypeOf(this,m.prototype)}}function v(t){let r="";try{return function(t){const r=g(t.attrs.signal);if(!r)throw new m("No signal found in NXdata");if(1!==r.length)throw new m(`Expect one and only one signal, found ${r.length}`);const e=t.children[r[0]];if(d(e),!e)throw new m(`Dataset from signal ${r[0]} does not exists`);if(2!==e.ndim)throw new m(`Dataset from signal ${r[0]} must be 2 ndim (found ${e.ndim})`);return[[{z:e.data,type:"heatmapgl"}],{}]}(t)}catch(e){if(!(e instanceof m))throw e;r+=`Image plot: ${e.message}`}try{return function(t){const r={xaxis:{title:{text:""}},yaxis:{title:{text:""},type:"linear",showexponent:"all",exponentformat:"e"}},e=g(t.attrs.axes);if(!e)throw new m("No axes found in NXdata");const n=[];if(1!==e.length)throw new m(`Expect 1 and only 1 axis, found ${e.length}`);const o=t.children[t.attrs.axes[0]];d(o);const a=o.data;r.xaxis.title.text=t.children[t.attrs.axes[0]].attrs.units;const s=t.children[t.attrs.signal];d(s);const c=s.data;r.yaxis.title.text=t.children[t.attrs.signal].attrs.units,t.attrs.SILX_style&&"log"===JSON.parse(t.attrs.SILX_style).signal_scale_type&&(r.yaxis.type="log");const u={x:a,y:c,type:"scattergl",name:t.attrs.signal};n.push(u);const l=g(t.attrs.auxiliary_signals);if(l&&(0,i.each)(l,(r=>{const e=t.children[r];d(e);const o=e.data,i={x:a,y:o,yaxis:"y2",type:"scattergl",name:r};n.push(i)})),0===n.length)throw new m("No data was found");return[n,r]}(t)}catch(e){if(!(e instanceof m))throw e;r+=`Curve plot: ${e.message}`}throw new m(r)}var w=e(45425),x=e(24878),A=e(94937),E=e(69048);const b=(0,w.Qg)({hdf5:x.Z})((0,o.$j)((0,E.Z)(((t,r,e)=>{const{providers:n,options:o}=r,{groups:a}=n.hdf5;return{group:a.selector("results",t)[o.uri],error:a.selector("error",t),params:n.hdf5.groups.selector("params",t),datacollectionid:A.Z.selector("selectedDataCollection",t)}})),(function(t,r){return{actions:{setParams:(t,e)=>r.providers.hdf5.groups.setParams(t,e)}}}))((function(t){var r,e,n,o,i;const s=(0,a.useRef)(),[d,g]=(0,a.useState)(null===(r=t.group)||void 0===r||null===(e=r.attrs)||void 0===e?void 0:e.default),{autoprocprogramid:w=null,datacollectionid:x=null,params:A={},poll:E=0,options:b}=t,j=(0,h.M)(t.options.events),N=(0,a.useCallback)((r=>{var e,n;console.log("refresh"),null===(e=t.actions)||void 0===e||null===(n=e.setParams)||void 0===n||n.call(e,{type:"processing",uri:b.uri},!0).then((()=>{r&&(s.current=setTimeout((()=>N(r)),1e3*r))})).catch((t=>{console.log("Could not fetch group data")}))}),[b.uri,t.actions]);if((0,a.useEffect)((()=>{var r;null!==j&&(null===x&&null!==(r=t.actions)&&void 0!==r&&r.setParams&&(t.actions.setParams({datacollectionid:null===j||void 0===j?void 0:j.datacollectionid}),N()))}),[w,x,j,t.actions,b.uri,N]),(0,a.useEffect)((()=>{const r={};var e;(x&&(r.datacollectionid=x),w&&(r.autoprocprogramid=w),A.datacollectionid!==r.datacollectionid||A.autoprocprogramid!==r.autoprocprogramid)&&(null!==(e=t.actions)&&void 0!==e&&e.setParams&&(t.actions.setParams(r),N(E)))}),[w,x,E,t.actions,A,N]),(0,a.useEffect)((()=>()=>{s.current&&clearTimeout(s.current)}),[]),(0,a.useEffect)((()=>{!d&&t.group&&t.group.attrs.default&&g(t.group.attrs.default)}),[t.group,d]),null===w&&null===x)return(0,p.jsx)("p",{children:"Select a processing program output"});if(t.error){const t=x||w;return(0,p.jsxs)(c.Z,{variant:"warning",children:['Could not load data for processing program id "',t,'" with uri "',b.uri,'"']})}if(!t.group)return(0,p.jsx)(c.Z,{variant:"info",children:(0,p.jsx)("p",{children:"Waiting for data"})});const U=d?null===(n=t.group)||void 0===n?void 0:n.children[d]:(null===(o=t.group)||void 0===o?void 0:o.children[null===(i=t.group)||void 0===i?void 0:i.attrs.default])||t.group||null;if(!U)return(0,p.jsx)(c.Z,{variant:"info",children:(0,p.jsx)("p",{children:"No data to display"})});f(U);try{const[r,e]=function(t){if("NXdata"===(null===t||void 0===t?void 0:t.attrs.NX_class))return v(t);throw new m("Only NXdata group is supported")}(U);return(0,p.jsxs)("div",{className:"plot1d-container",children:[d&&(0,p.jsx)(y,{group:t.group,onChange:g}),(0,p.jsx)(l.Z,{children:(0,p.jsx)(u.Z,{data:r,layout:e})})]})}catch(k){if(k instanceof m)return(0,p.jsxs)(c.Z,{variant:"error",children:[(0,p.jsx)("p",{children:"Data format unsupported:"}),(0,p.jsx)("p",{children:k.message})]});throw k}})));function j(t){const{providers:r,yamlNode:e,events:o,url:a,...i}=t;return n.lD(e,"events",o),n.Ee(e,"url",a),n.ol(e,i),(0,p.jsx)(b,{providers:r,options:{url:a,events:o}})}},69048:(t,r,e)=>{e.d(r,{Z:()=>i});var n=e(96956),o=e.n(n);class a{constructor(){this.cache=void 0,this.cache={}}debounce(t,r){const e=this.cache[t];return o().isEqual(e,r)?e:(this.cache[t]=r,r)}memo(t,r,e){const n=[void 0,void 0],[a,i]=this.cache[t]||n;if(o().isEqual(i,e))return a;const s=r();return this.cache[t]=[s,e],s}}function i(t){const r=new a;return(e,n)=>t(e,n,r)}},60687:(t,r,e)=>{e.d(r,{AA:()=>l,Os:()=>c,UZ:()=>p,WU:()=>h,Yk:()=>y,cy:()=>g,hO:()=>s,pm:()=>u,x7:()=>f});var n=e(97133),o=e.n(n),a=e(20837),i=e(25263);function s(t){var r;const e=`<${t.slice(1)}`;return null!==(r={"<f1":"<f4","<f2":"<f4","<i8":"<i4","<u8":"<u4"}[e])&&void 0!==r?r:e}function c(t,r){const e={"<f4":Float32Array,"<f8":Float64Array,"<i1":Int8Array,"|i1":Int8Array,i1:Int8Array,"<i2":Int16Array,"<i4":Int32Array,"<u1":Uint8Array,"|u1":Uint8Array,u1:Uint8Array,"<u2":Uint16Array,"<u4":Uint32Array}[r];if(!e)throw new Error(`Unsupported dtype: ${r}`);if(t instanceof Uint8Array){const r=e.BYTES_PER_ELEMENT;try{return new e(t.buffer,t.byteOffset,t.byteLength/r)}catch{return console.warn(`toTypedArray is using a memory copy for a '${e}'. Probably because the buffer is not properly aligned.`),new e(t)}}return new e(t)}function u(t,r,e){const n=r.reduce(((t,r)=>t*r));let a;switch(e){case"<f2":a=2*n===t.byteLength?Uint16Array:Float32Array;break;case"<f4":a=Float32Array;break;case"<f8":a=Float64Array;break;case"<i1":case"|i1":case"i1":a=Int8Array;break;case"<i2":a=Int16Array;break;case"<i4":case"<i8":a=Int32Array;break;case"<u1":case"|u1":case"u1":a=Uint8Array;break;case"<u2":a=Uint16Array;break;case"<u4":case"<u8":a=Uint32Array;break;default:throw new Error(`Unsupported dtype: ${e}`)}return o()(new a(t),r)}function l(t){return"float32"===t.dtype?t:o()(Float32Array.from(t.data),t.shape)}function d(t){return t instanceof Object&&"data"in t&&"stride"in t&&"shape"in t}function f(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Expected NdArray<TypedArray>";if(!d(t))throw new Error(r)}function h(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Expected NdArray<TypedArray> or NdFloat16Array";if(!d(t)&&!(t instanceof i.S))throw new Error(r)}function p(t){if(3!==t.length)throw new Error(`Unsupported dtype format ${t}`);return{byteorder:t[0],type:t[1],itemsize:Number.parseInt(t[2]),numpy:t}}function y(t,r,e){return(0,a.useMemo)((()=>function(t,r,e){if(1!==t.dimension)throw new Error("Slicing only supported for 1dim array");const n=t.data.subarray(r,e);return o()(n,[e-r])}(t,r,e)),[t,r,e])}function g(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Expected number[]";if(!function(t){if(!Array.isArray(t))return!1;for(const r of t)if("number"!==typeof r)return!1;return!0}(t))throw new Error(r)}}}]);
//# sourceMappingURL=702.e3b9e2d9.chunk.js.map