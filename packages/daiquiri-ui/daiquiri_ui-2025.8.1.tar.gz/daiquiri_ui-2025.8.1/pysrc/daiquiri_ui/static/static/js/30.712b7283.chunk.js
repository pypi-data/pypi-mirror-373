"use strict";(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[30],{18680:(e,a,n)=>{n.d(a,{Z:()=>o});var t=n(70775),r=n(20837);const o=function(e){const{onClick:a,threshold:n=4}=e,{worldToData:o}=(0,t.ki)(),[i,s]=(0,r.useState)(null),l=(0,r.useCallback)((e=>{const{htmlPt:a}=e;s(a)}),[s]),c=(0,r.useCallback)((e=>{if(!i)return!1;const{htmlPt:a}=e;return Math.max(Math.abs(a.x-i.x),Math.abs(a.y-i.y))<=n}),[i,n]),d=(0,r.useCallback)((e=>{c(e)||s(null)}),[c,s]),u=(0,r.useCallback)((e=>{c(e)&&a(e)}),[c,a,a,o]);return(0,t.iq)("pointerdown",l),(0,t.iq)("pointermove",d),(0,t.iq)("pointerup",u),null}},17332:(e,a,n)=>{n.d(a,{Z:()=>l});var t=n(70775),r=n(84009),o=n(20837),i=n(69521);function s(e){const a=function(e){const a=/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})$/gis.exec(e);return null===a?null:[Number.parseInt(a[1],16),Number.parseInt(a[2],16),Number.parseInt(a[3],16)]}(e);if(null===a)return;return.299*a[0]+.587*a[1]+.114*a[2]>128?"#00000080":"#FFFFFF80"}function l(e){const{vmargin:a=5,hmargin:n=5,anchor:l="text-right",color:c="black"}=e,d=(0,o.useMemo)((()=>{var a;return null!==(a=e.outline)&&void 0!==a?a:s(c)}),[e.outline]),u=(0,r.d4)(e.datapos);const h=function(){switch(l){case"bottom":return{top:"50%",left:"50%",position:"relative",transform:"translate(-100%, -100%)"};case"top":return{top:"50%",left:"50%",position:"relative",transform:"translate(-100%, 0%)"};case"top-right":return{marginLeft:n,marginTop:a};case"text-right":return{top:"50%",position:"relative",transform:"translate(0%, -100%)",marginLeft:n,marginTop:a};case"center":return{top:"50%",left:"50%",position:"relative",transform:"translate(-100%, -50%)"}}return{}}();return(0,i.jsx)(t.q6,{x:u.x,y:u.y,style:{color:c},children:(0,i.jsx)("div",{style:{...h,borderRadius:5,paddingLeft:5,paddingRight:5,backgroundColor:d,fontWeight:"bold",fontSize:"100%",zIndex:100},children:e.text})})}},30:(e,a,n)=>{n.d(a,{z:()=>c});var t=n(20837),r=n(40714),o=n(70775),i=n(37185),s=n(21681);var l=n(69521);function c(e){const[a,n]=function(e,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const[t,r]=(0,s.F)(e);return[t,(0,i.y)(r,[],a,n)]}({loading:e.loading,info:e.info,warning:e.warning,danger:e.danger},500);return(0,t.useEffect)((()=>{n({loading:e.loading,warning:e.warning,danger:e.danger,info:e.info})}),[e.loading,e.info,e.warning,e.danger]),a.loading||a.danger||a.warning||a.info?(0,l.jsx)(o.aV,{style:{zIndex:200},children:(0,l.jsxs)("div",{style:{textAlign:"center"},children:[a.loading&&(0,l.jsxs)(r.Z,{variant:"warning",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:[(0,l.jsx)("i",{className:"fa fa-spinner fa-solid fa-pulse"})," Loading"]}),!a.loading&&a.danger&&(0,l.jsx)(r.Z,{variant:"danger",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:a.danger}),!a.loading&&!a.danger&&a.warning&&(0,l.jsx)(r.Z,{variant:"warning",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:a.warning}),a.info&&(0,l.jsx)(r.Z,{variant:"info",style:{marginLeft:"auto",marginRight:"auto",marginTop:"2em",display:"inline-block"},children:a.info})]})}):(0,l.jsx)(l.Fragment,{})}},94443:(e,a,n)=>{n.d(a,{b:()=>s});var t=n(20837),r=n(26799),o=n(42506),i=n(69521);const s=t.forwardRef(((e,a)=>{const{scaleX:n=!0,scaleY:s=!0,screenDirection:l=!0,children:c}=e,d=t.useRef(null);t.useImperativeHandle(a,(()=>d.current),[]);const u=(0,o.P)();return(0,r.C)((e=>{let{camera:a}=e;const t=d.current;if(!t)return;const r=a.scale.x/u.sx,o=a.scale.y/u.sy;n&&(t.scale.x=l?r:Math.abs(r)),s&&(t.scale.y=l?-o:Math.abs(o))})),(0,i.jsx)("group",{ref:d,children:c})}))},65308:(e,a,n)=>{n.d(a,{L:()=>s});var t=n(20837),r=n(26799),o=n(42506),i=n(69521);const s=t.forwardRef(((e,a)=>{const{children:n}=e,s=t.useRef(null);t.useImperativeHandle(a,(()=>s.current),[]);const l=(0,o.P)();return(0,r.C)((e=>{let{camera:a}=e;const n=s.current;n&&(n.position.x=l.centerX,n.position.y=l.centerY,n.scale.x=1/l.sx,n.scale.y=1/l.sy)})),(0,i.jsx)("group",{ref:s,children:n})}))},35540:(e,a,n)=>{n.d(a,{_:()=>u});var t=n(20837),r=n(15568),o=n(30158),i=n(2498),s=n(70775),l=n(26799),c=n(98476),d=n(69521);function u(e){const{pos:a,size:n,zIndex:u,pointer:h="pointer",enabled:p=!0,displayPos:v=[0,0]}=e,m=(0,i.qk)(),g=(0,t.useRef)(void 0),{htmlToData:f}=(0,s.ki)(),{camera:x}=(0,l.A)(),y=(0,o.useGesture)({onHover:a=>{let{hovering:n}=a;if(m)if(n){var t;if(null!==(t=g.current)&&void 0!==t&&t.uid)return;g.current={uid:m.mouseInteractionOverlay.register(u,h,e.onEnter,e.onLeave),dataOffset:[0,0]}}else if(g.current){const e=g.current.uid;m.mouseInteractionOverlay.isCurrent(e)||(g.current=void 0,m.mouseInteractionOverlay.unregister(e))}},onDragStart:e=>{let{cancel:n,xy:t}=e;if(!m)return;if(!g.current)return void n();const o=g.current.uid;if(!m.mouseInteractionOverlay.capture(o))return void n();const i=f(x,new r.Vector3(t[0],t[1],0));g.current.dataOffset=[a[0]-i.x,a[1]-i.y]},onDrag:a=>{var n;let{cancel:t,xy:o,offset:[i,s],intentional:l}=a;if(!m)return;if(!g.current)return void t();const c=g.current.uid;if(!m.mouseInteractionOverlay.isCurrent(c))return void t();const d=f(x,new r.Vector3(o[0],o[1],0));null===(n=e.onPositionChanged)||void 0===n||n.call(e,[d.x+g.current.dataOffset[0],d.y+g.current.dataOffset[1]],!0)},onDragEnd:a=>{var n;let{cancel:t,xy:o}=a;if(!m)return;const i=g.current;if(!i)return void t();if(!m.mouseInteractionOverlay.isCurrent(i.uid))return void t();m.mouseInteractionOverlay.release(i.uid);const s=f(x,new r.Vector3(o[0],o[1],0));null===(n=e.onPositionChanged)||void 0===n||n.call(e,[s.x+i.dataOffset[0],s.y+i.dataOffset[1]],!1)}},{drag:{pointer:{capture:!0,buttons:[1]}}});return(0,d.jsxs)("mesh",{position:[v[0],v[1],u],...p?y():{},children:[(0,d.jsx)("ambientLight",{}),(0,d.jsx)("planeGeometry",{attach:"geometry",args:[n[0],n[1],1,1]}),(0,d.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:c.eM?"red":void 0,opacity:c.eM?.25:0})]})}},6510:(e,a,n)=>{n.d(a,{R:()=>l});var t=n(20837),r=n(94443),o=n(98476),i=n(35540),s=n(69521);function l(e){const{geometry:a,lineWidth:n=2,color:l="blue",opacity:c=1,zIndex:d=1,visible:u=!0,readOnly:h=void 0===e.onGeometryChanged}=e,[p,v]=(0,t.useState)(!1);return u?(0,s.jsxs)("group",{position:[a.x,0,d],children:[(0,s.jsx)(r.b,{children:(0,s.jsx)(i._,{pos:[a.x,0],size:[o.FE,999999],pointer:"ew-resize",zIndex:d+o.BG,enabled:!h,onPositionChanged:(a,n)=>{var t;null===(t=e.onGeometryChanged)||void 0===t||t.call(e,{x:a[0]},n)},onEnter:()=>{v(!0)},onLeave:()=>{v(!1)}})}),(0,s.jsx)("group",{children:(0,s.jsx)(r.b,{children:(0,s.jsxs)("mesh",{children:[(0,s.jsx)("ambientLight",{}),(0,s.jsx)("planeGeometry",{attach:"geometry",args:[p?o.pU:n,999999,1,1]}),(0,s.jsx)("meshBasicMaterial",{attach:"material",transparent:!0,color:l,opacity:c})]})})})]}):(0,s.jsx)(s.Fragment,{})}},98476:(e,a,n)=>{n.d(a,{BG:()=>c,FE:()=>t,Il:()=>s,e4:()=>i,eM:()=>r,pU:()=>o,rc:()=>l});const t=10,r=!1,o=3.5,i=10,s=.03,l=.02,c=.01},6447:(e,a,n)=>{n.d(a,{A:()=>d});var t=n(26799),r=n(20837),o=n(15568),i=n(42506),s=n(94117),l=n(69521);class c extends o.ShaderMaterial{constructor(){super({uniforms:{color:{value:new o.Vector4},gapColor:{value:new o.Vector4},dashSize:{value:0},gapSize:{value:0},scaleX:{value:0},scaleY:{value:0},size:{value:0},lineWidth:{value:0}},vertexShader:"\nuniform float scaleX;\nuniform float scaleY;\nuniform float size;\nout vec2 pixelCoord;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vec2 pixelScale = vec2(scaleX, scaleY);\n    pixelCoord = vec2(position.x + size * 0.5, position.y) / pixelScale;\n}\n      ",fragmentShader:"\nuniform vec4 color;\nuniform vec4 gapColor;\nuniform float gapSize;\nuniform float dashSize;\nuniform float lineWidth;\n\nin vec2 pixelCoord;\n\nvoid main() {\n    float alpha;\n    if (lineWidth >= 1.0) {\n        alpha = smoothstep(lineWidth * 0.5 + 0.01, lineWidth * 0.5 - 0.1, abs(pixelCoord.y));\n    } else {\n        // simulate line thiner than 1px with alpha\n        alpha = lineWidth;\n    }\n\n    if (dashSize == 0.0) {\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n        return;\n    }\n\n    float dist = abs(pixelCoord.x);\n    dist = mod(dist, (dashSize + gapSize));\n    if (dist <= dashSize) {\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n    } else {\n        gl_FragColor = vec4(gapColor.r, gapColor.g, gapColor.b, alpha * gapColor.a);\n    }\n}\n      "})}}function d(e){const{y:a,x1:n,x2:o,lineWidth:c=1,color:d="black",gapColor:u,dashSize:h=0,gapSize:p=h,opacity:v=1,zIndex:m=0}=e,g=(0,r.useRef)(null),f=o-n,x=.5*(n+o),y=r.useRef(null),C=(0,i.P)();return(0,r.useEffect)((()=>{const e=(0,s.V)(d,v),a=(0,s.V)(null!==u&&void 0!==u?u:"transparent",v);if(g.current){const n=g.current.uniforms;n.color.value=e,n.gapColor.value=a,n.dashSize.value=h,n.gapSize.value=p,n.size.value=f,n.lineWidth.value=c,(0,t.l)()}}),[d,u,h,p,v,f,c]),(0,t.C)((e=>{let{camera:a}=e;if(null===y.current||null===g.current)return;const n=a.scale.x/C.sx,t=a.scale.y/C.sy;y.current.scale.y=t;const r=g.current.uniforms;r.scaleX.value=n,r.scaleY.value=1})),(0,l.jsx)("group",{ref:y,position:[x,a,m],children:(0,l.jsxs)("mesh",{children:[(0,l.jsx)("ambientLight",{}),(0,l.jsx)("planeGeometry",{attach:"geometry",args:[Math.abs(f),c+1,1,1]}),(0,l.jsx)("hDashMaterial",{attach:"material",transparent:!0,ref:g})]})})}(0,t.e)({HDashMaterial:c})},58421:(e,a,n)=>{n.d(a,{D:()=>d});var t=n(26799),r=n(20837),o=n(15568),i=n(42506),s=n(94117),l=n(69521);class c extends o.ShaderMaterial{constructor(){super({uniforms:{color:{value:new o.Vector4},gapColor:{value:new o.Vector4},dashSize:{value:0},gapSize:{value:0},scaleX:{value:0},scaleY:{value:0},size:{value:0},lineWidth:{value:0}},vertexShader:"\nuniform float scaleX;\nuniform float scaleY;\nuniform float size;\nout vec2 pixelCoord;\n\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vec2 pixelScale = vec2(scaleX, scaleY);\n    pixelCoord = vec2(position.x, position.y + size * 0.5) / pixelScale;\n}\n      ",fragmentShader:"\nuniform vec4 color;\nuniform vec4 gapColor;\nuniform float gapSize;\nuniform float dashSize;\nuniform float lineWidth;\n\nin vec2 pixelCoord;\n\nvoid main() {\n    float alpha;\n    if (lineWidth >= 1.0) {\n        alpha = smoothstep(lineWidth * 0.5 + 0.01, lineWidth * 0.5 - 0.1, abs(pixelCoord.x));\n    } else {\n        // simulate line thiner than 1px with alpha\n        alpha = lineWidth;\n    }\n\n    if (dashSize == 0.0) {\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n        return;\n    }\n\n    float dist = abs(pixelCoord.y);\n    dist = mod(dist, (dashSize + gapSize));\n    if (dist <= dashSize) {\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha * color.a);\n    } else {\n        gl_FragColor = vec4(gapColor.r, gapColor.g, gapColor.b, alpha * gapColor.a);\n    }\n}\n      "})}}function d(e){const{x:a,y1:n,y2:o,lineWidth:c=1,color:d="black",gapColor:u,dashSize:h=0,gapSize:p=h,opacity:v=1,zIndex:m=0}=e,g=(0,r.useRef)(null),f=o-n,x=.5*(n+o),y=r.useRef(null),C=(0,i.P)();return(0,r.useEffect)((()=>{const e=(0,s.V)(d,v),a=(0,s.V)(null!==u&&void 0!==u?u:"transparent",v);if(g.current){const n=g.current.uniforms;n.color.value=e,n.gapColor.value=a,n.dashSize.value=h,n.gapSize.value=p,n.size.value=f,n.lineWidth.value=c,(0,t.l)()}}),[d,u,h,p,v,f,c]),(0,t.C)((e=>{let{camera:a}=e;if(null===y.current||null===g.current)return;const n=a.scale.x/C.sx,t=a.scale.y/C.sy;y.current.scale.x=n;const r=g.current.uniforms;r.scaleX.value=1,r.scaleY.value=t})),(0,l.jsx)("group",{ref:y,position:[a,x,m],children:(0,l.jsxs)("mesh",{children:[(0,l.jsx)("ambientLight",{}),(0,l.jsx)("planeGeometry",{attach:"geometry",args:[c+1,Math.abs(f),1,1]}),(0,l.jsx)("vDashMaterial",{attach:"material",transparent:!0,ref:g})]})})}(0,t.e)({VDashMaterial:c})},64030:(e,a,n)=>{n.r(a),n.d(a,{default:()=>K});var t=n(52799),r=n(57209),o=n(20837),i=n(18578),s=n(40714),l=n(70775);const c=.1;var d=n(2498),u=n(58421),h=n(17332),p=n(34718),v=n.n(p),m=n(60687),g=n(30),f=n(97133),x=n.n(f),y=n(65308),C=n(69521);function j(e){const{vData:a,xRange:n,xAxisSize:t,yRange:r,yAxisSize:i,colorMap:s,scaleType:c,invertColorMap:d,domain:u}=e,h=(0,o.useMemo)((()=>{var e;const n=null!==(e=null===a||void 0===a?void 0:a.shape[0])&&void 0!==e?e:0;return(n-n%t)/t}),[a,t]),p=(0,o.useMemo)((()=>{if(void 0===a)return;if(0===h)return;const e=a.data.subarray(0,h*t);return x()(e,[h,t])}),[h,t]),v=(m=p,(0,o.useMemo)((()=>{if(void 0===m)return;const e=m instanceof Float32Array?m:Float32Array.from(m.data);return x()(e,m.shape)}),[m]));var m;if(void 0===v)return(0,C.jsx)(C.Fragment,{});const g=Math.abs(r[1]-r[0]),f=Math.abs(n[1]-n[0])/t,y=g/i;return(0,C.jsx)(l.DV,{position:[.5*(n[0]+n[1]),r[0]+g*(v.shape[0]/i)*.5,0],size:{width:v.shape[1],height:v.shape[0]},scale:[f,y,1],values:v,domain:u,colorMap:s,scaleType:c,invertColorMap:d})}function b(e){const{xData:a,yData:n,vData:t,domain:r,colorMap:o="Viridis",invertColorMap:i=!1,scaleType:s=l.N3.Linear,markerSize:c=8,renderMode:d,...u}=e;return void 0===a||void 0===n||void 0===t?(0,C.jsx)(C.Fragment,{}):"marker"===d?(0,C.jsx)(y.L,{children:(0,C.jsx)(l.cG,{abscissas:a.data,ordinates:n.data,data:t.data,size:c,domain:r,scaleType:s,invertColorMap:!1,colorMap:o})}):(0,C.jsx)(j,{xData:a,yData:n,vData:t,domain:r,scaleType:s,invertColorMap:!1,colorMap:o,...u})}var S=n(6510);v()("daiquiri.components.tomo.SinogramPlot");function M(e){var a,n;const{datacollectionMeta:t}=e,r=null!==t.requestedCor&&t.requestedCor!==t.actualCor;return(0,C.jsxs)(C.Fragment,{children:[null!==t.estimatedCor&&t.estimatedCor!==t.actualCor&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(u.D,{x:t.estimatedCor,y1:0,y2:360,color:"#505050",gapColor:"#909090",dashSize:10,gapSize:10}),(0,C.jsx)(h.Z,{datapos:[t.estimatedCor,10],color:"#A0A0A0",text:"Estimated CoR"})]}),null!==t.actualCor&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(S.R,{geometry:{x:null!==(a=t.requestedCor)&&void 0!==a?a:t.actualCor},onGeometryChanged:(a,n)=>{e.setRequestedCor(a.x,n)}}),(0,C.jsx)(h.Z,{datapos:[null!==(n=t.requestedCor)&&void 0!==n?n:t.actualCor,r?40:25],color:"#FFFFFF",text:r?"Requested CoR":"Actual CoR"})]}),r&&null!==t.actualCor&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(u.D,{x:t.actualCor,y1:0,y2:360,color:"#000000",gapColor:"#FFFFFF",dashSize:10,gapSize:10}),(0,C.jsx)(h.Z,{datapos:[t.actualCor,25],color:"#FFFFFF",text:"Actual CoR"})]})]})}const w=function(e){var a,n,t,r;const{xdata:o,ydata:i,vdata:s,sinogram:u,renderMode:h,datacollectionMeta:p,mouseMode:v}=e,{translationrange:f,rotationrange:x}=function(e,a){if(!e)return{translationrange:(0,l.IU)([0,1024],c),rotationrange:(0,l.IU)([0,360],c)};const{rotationrange:n,translationrange:t}=e;if("marker"===a)return{translationrange:(0,l.IU)(t,c),rotationrange:(0,l.IU)(n,c)};if("solid"===a){const{rotationaxispoints:a}=e,r=Math.abs(n[1]-n[0])/a;return{translationrange:t,rotationrange:[n[0]-r/2,n[1]-r/2]}}throw new Error(`Expected "marker" or "solid" render mode. Got ${a}`)}(u,h),y=(0,l.ay)(s),j=Math.min(o.size,i.size,s.size),S=(0,m.Yk)(o,0,j),w=(0,m.Yk)(i,0,j),z=(0,m.Yk)(s,0,j);return(0,C.jsxs)("div",{style:{flex:"1 1 auto",display:"flex",margin:0,minHeight:0},children:[(0,C.jsxs)(d.HI,{plotRef:e.plotRef,showAxes:null===(a=null===(n=e.viewConfig)||void 0===n?void 0:n.displayAxes)||void 0===a||a,title:"Sinogram",abscissaConfig:{visDomain:f,showGrid:!0,label:"Profile"},ordinateConfig:{visDomain:x,showGrid:!0,label:"Rotation",flip:!0},mouseMode:v,children:[u&&y&&(0,C.jsx)(b,{xData:S,yData:w,vData:z,domain:y,colorMap:"Viridis",xAxisSize:u.translationaxispoints,yAxisSize:u.rotationaxispoints,xRange:u.translationrange,yRange:u.rotationrange,renderMode:h}),void 0!==p&&(0,C.jsx)(M,{setRequestedCor:e.setRequestedCor,datacollectionMeta:p}),(0,C.jsx)(g.z,{...e.message}),e.children]}),(null===(t=null===(r=e.viewConfig)||void 0===r?void 0:r.colorbarVisible)||void 0===t||t)&&(0,C.jsx)(l.UB,{domain:null!==y&&void 0!==y?y:[0,0],withBounds:!0,colorMap:"Viridis",invertColorMap:!1,scaleType:l.N3.Linear})]})};var z=n(6935),R=n(86912);const F=function(e){const{onSelect:a,value:n}=e,t={marker:"Marker",solid:"Solid"},r=t[n];return(0,C.jsxs)(z.Z,{title:r,id:"bg-vertical-dropdown-4",variant:"secondary",onSelect:e=>{null!==e&&a(e)},children:[(0,C.jsx)(R.Z.Item,{eventKey:"marker",children:t.marker}),(0,C.jsx)(R.Z.Item,{eventKey:"solid",children:t.solid})]})};var Z=n(18680);const k=v()("daiquiri.components.tomo.sinogram.AxisRotationPositionInteraction");function D(e){const{operator:a,resetMouseMode:n}=e,t=(0,d.qk)(),{mouseMode:r,actions:i}=null!==t&&void 0!==t?t:{},s=(0,o.useCallback)((a=>{const t=a.dataPt.x;n(),e.setRequestedCor(t)}),[e.setRequestedCor,i]);return a?"set-axis-rotation"!==r?(k("disabled: mouseMode dont match"),(0,C.jsx)(C.Fragment,{})):(k("enabled"),(0,C.jsx)(Z.Z,{onClick:s})):(k("disabled: not operator"),(0,C.jsx)(C.Fragment,{}))}var q=n(6447);function I(e){var a;const{rotationHardware:n,detectorWidth:t}=e,r=null===n||void 0===n||null===(a=n.properties)||void 0===a?void 0:a.position;if(void 0===r||null===r||void 0===t)return(0,C.jsx)(C.Fragment,{});const o=null===n||void 0===n?void 0:n.name;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(q.A,{y:r,x1:0,x2:t,color:"red",gapColor:"write",dashSize:10,gapSize:10,lineWidth:3}),(0,C.jsx)(h.Z,{datapos:[10,r],color:"#FF0000",anchor:"top",vmargin:10,text:null!==o&&void 0!==o?o:"srot"})]})}var P=n(4363),A=n(94708),N=n(24063),V=n(35802),W=n(35875);var E=n(38213),O=n(82794),L=n(91328),T=n(10827);function H(e){return(0,C.jsx)(i.Z,{variant:(a=e.var,n=e.value,t=e.variantWhenSelected,a!==n?"secondary":t||"primary"),onClick:()=>{e.setter(e.value)},className:"text-nowrap",size:"sm",children:e.children});var a,n,t}function G(e){const{as:a,variant:n="secondary",config:t}=e;return(0,C.jsxs)(R.Z,{as:a,children:[(0,C.jsx)(R.Z.Toggle,{id:"dropdown-basic",variant:n,className:"d-flex align-items-center",children:(0,C.jsx)("i",{className:"fa fa-sliders fa-fw fa-lg"})}),(0,C.jsx)(R.Z.Menu,{className:"dropdown-menu-center",children:(0,C.jsx)("div",{className:"ms-1 me-1",style:{minWidth:"300px"},children:(0,C.jsxs)(E.Z,{children:[(0,C.jsxs)(O.Z,{children:[(0,C.jsx)(L.Z,{className:"my-auto",children:"Sinogram"}),(0,C.jsx)(L.Z,{xs:7,children:(0,C.jsxs)(T.Z,{children:[(0,C.jsx)(H,{var:t.displayedSinogram,value:!0,setter:t.setDisplayedSinogram,children:"Displayed"}),(0,C.jsx)(H,{var:t.displayedSinogram,value:!1,setter:t.setDisplayedSinogram,variantWhenSelected:"warning",children:"Hide"})]})})]}),(0,C.jsxs)(O.Z,{className:"mt-1",children:[(0,C.jsx)(L.Z,{className:"my-auto",children:"Display axes"}),(0,C.jsx)(L.Z,{xs:7,children:(0,C.jsxs)(T.Z,{children:[(0,C.jsx)(H,{var:t.displayAxes,value:!0,setter:t.setDisplayAxes,children:"Yes"}),(0,C.jsx)(H,{var:t.displayAxes,value:!1,setter:t.setDisplayAxes,children:"No"})]})})]}),(0,C.jsxs)(O.Z,{className:"mt-1",children:[(0,C.jsx)(L.Z,{className:"my-auto",children:"Color bar"}),(0,C.jsx)(L.Z,{xs:7,children:(0,C.jsxs)(T.Z,{children:[(0,C.jsx)(H,{var:t.colorbarVisible,value:!0,setter:t.setColorbarVisible,children:"Displayed"}),(0,C.jsx)(H,{var:t.colorbarVisible,value:!1,setter:t.setColorbarVisible,children:"Hide"})]})})]})]})})})]})}var Y=n(79008),$=n(74773),_=n(37668),B=n(17108);v()("daiquiri.components.tomo.TomoSinogram");function U(e){var a,n,t;const{sinogram:r,selectedScan:l,options:c}=e,{tomoconfig:d}=c,{datacollectionid:u,datacollectionMeta:h}=(0,$.BH)(c.datacollectionid),p=(0,B.og)(),v=function(){const[e,a]=(0,W.Z)("tomo/sinogramview/axes",!0),[n,t]=(0,W.Z)("tomo/sinogramview/colorbar-visible",!1),[r,o]=(0,W.Z)("tomo/sinogramview/crosshair",!1),[i,s]=(0,W.Z)("tomo/sinogramview/displayed",!0);return{colorbarVisible:n,setColorbarVisible:t,displayAxes:e,setDisplayAxes:a,crossHair:r,setCrossHair:o,displayedSinogram:i,setDisplayedSinogram:s}}(),m=v.displayedSinogram&&null!==(a=null===r||void 0===r?void 0:r.actualnbpoints)&&void 0!==a?a:0,[g,f]=(0,o.useState)("solid"),y=(0,Y.pC)(),j=(0,$.kP)(null!==d&&void 0!==d?d:""),b=(0,$.Bp)(j);(0,o.useEffect)((()=>{void 0!==u&&p.updateDataCollectionMeta(u,{estimatedCor:null,requestedCor:null,actualCor:null})}),[u]);const S=(0,N.R)({scanId:void 0!==r&&null!==l&&void 0!==l?l:void 0,channelNames:["sinogram","rotation","translation"],start:0,stop:m}),M=(0,o.useRef)(null),z=(0,_.y)("zoom"),{mouseMode:R}=z,Z=x()(new Float32Array([]),[0]),k=S.data.translation,q=S.data.rotation,E=S.data.sinogram;const O=function(){if(null===l)return{info:"No scan"};if(!r)return{info:"No sinogram defined"};if(!k||!q||!E){if(S.loading)return{warning:"Waiting for data..."};if(!k)return{danger:"Data for x-axis are missing"};if(!q)return{danger:"Data for y-axis are missing"};if(!E)return{danger:"Data for intensity are missing"}}return 0===Math.min(k.size,q.size,E.size)?{warning:"Waiting for data..."}:{}}(),L=null===(n=e.sinogram)||void 0===n||null===(t=n.translationrange)||void 0===t?void 0:t[1],T=(0,o.useCallback)(((e,a)=>{if(void 0!==u){var n;if(!a)(0,V.P)({datacollectionid:u,axisposition:e,filename:null!==(n=null===h||void 0===h?void 0:h.sourceFilename)&&void 0!==n?n:void 0});p.updateDataCollectionMeta(u,{requestedCor:e})}}),[u,null===h||void 0===h?void 0:h.sourceFilename]);return(0,C.jsxs)("div",{className:"plot2d-container w-100 h-100",style:{flex:"1 1 0%",display:"flex",flexDirection:"column"},children:[(0,C.jsxs)(A.ZP,{align:"center",children:[(0,C.jsx)(P.Z,{mouseModeInteraction:z}),(0,C.jsx)(i.Z,{title:"Reset zoom (sample stage overview)",variant:"secondary",onClick:()=>{var e;null===M||void 0===M||null===(e=M.current)||void 0===e||e.actions.resetZoom()},children:(0,C.jsx)("i",{className:"fa fa-expand fa-fw fa-lg"})}),(0,C.jsx)(A.Z0,{}),(0,C.jsx)(i.Z,{title:y?"Select another center of rotation for the slice reconstruction":"You have to get the control on the session to set the center of rotation",disabled:!y,variant:"set-axis-rotation"===R?"warning":"secondary",onClick:()=>{z.setOrResetMouseMode("set-axis-rotation")},children:(0,C.jsx)("i",{className:"fad fam-tomo-cor fa-fw fa-lg"})}),(0,C.jsx)(A.Z0,{}),(0,C.jsx)(F,{value:g,onSelect:f}),(0,C.jsx)(G,{config:v})]}),!v.displayedSinogram&&(0,C.jsx)(s.Z,{variant:"warning",children:"Sinogram was disabled by user"}),v.displayedSinogram&&(0,C.jsxs)(w,{viewConfig:v,message:O,mouseMode:R,xdata:null!==k&&void 0!==k?k:Z,ydata:null!==q&&void 0!==q?q:Z,vdata:null!==E&&void 0!==E?E:Z,sinogram:r,renderMode:g,plotRef:M,datacollectionMeta:h,setRequestedCor:T,children:[(0,C.jsx)(D,{operator:y,resetMouseMode:z.resetMouseMode,setRequestedCor:T}),(0,C.jsx)(I,{rotationHardware:b.somega,detectorWidth:L})]})]})}function X(e){const a=(0,B.i)((e=>{var a;const n=e.scaninfo.lastgroup;return null!==(a=null===n||void 0===n?void 0:n.sinogram)&&void 0!==a?a:void 0}),r.wU),n=(0,B.i)((e=>{var a;const n=e.scaninfo.lastgroup;return null!==(a=null===n||void 0===n?void 0:n.scanid)&&void 0!==a?a:null}));return(0,C.jsx)(U,{...e,sinogram:a,selectedScan:n})}function K(e){const{yamlNode:a,tomoconfig:n,datacollectionid:r,...o}=e;t.ol(a,o),t.Ee(a,"tomoconfig",n),t.R0(a,"datacollectionid",r),t.ol(a,o);const i={datacollectionid:r,tomoconfig:n};return(0,C.jsx)(X,{options:i})}},24063:(e,a,n)=>{n.d(a,{R:()=>d});var t=n(85083),r=n(20837),o=n(60687),i=n(97133),s=n.n(i);function l(e,a,n){return 0===a&&e.length===n?e:e.subarray(a,n)}class c{constructor(e,a){this.isAborted=void 0,this.isFetching=void 0,this.cache=void 0,this.updateCallback=void 0,this.scanId=void 0,this.description=void 0,this.pendingRequest=void 0,this.isAborted=!1,this.isFetching=!1,this.pendingRequest=void 0,this.description=void 0,this.updateCallback=e,this.scanId=a;const n=t.Z.get(`/scans/data/${a}`);this.cache={},n.then((e=>{this.setupScan(e.data)})).catch((e=>{console.error(e)}))}setupScan(e){this.description=e,this.pendingRequest&&this.fetchPendingRequest()}async fetchData(e,a){if(this.isAborted)return;const n={...e,scanId:this.scanId,errors:a},r=[];this.updateCallback({loading:!0,data:Object.fromEntries(e.channelNames.map((e=>{var a;return[e,null===(a=this.cache[e])||void 0===a?void 0:a.ndarray]}))),request:n}),e.channelNames.forEach((e=>{if(!(e in this.cache)){var a;const n=null===(a=this.description)||void 0===a?void 0:a.data[e];if(void 0!==n){const a=n.dtype,t=n.shape;(0,o.cy)(t);const r=t.reduce(((e,a)=>e*a),1);void 0!==a&&(this.cache[e]={dtype:(0,o.UZ)(a),safeDtype:(0,o.UZ)((0,o.hO)(a)),shape:t,elementSize:r,raw:void 0,ndarray:void 0,nbItems:0})}}}));const i=e.channelNames.map((async a=>{var n;const i=this.cache[a];if(!i||!i.safeDtype)return void r.push(`channel name '${a}' in not part of the scan`);if(e.stop<=e.start)return void(i.ndarray=void 0);const c=null!==(n=i.nbItems)&&void 0!==n?n:0;if(e.stop<=c){const a=l(i.raw,e.start,e.stop);return void(i.ndarray=s()(a,[e.stop-e.start,...i.shape]))}const d=await t.Z.get(`/scans/data/binary/${this.scanId}`,{channel:a,selection:`${c}:${e.stop}`,dtype:"safe"},!0,"arraybuffer").then((e=>e.data)).catch((e=>{const n=e instanceof Error?e.message:String(e);r.push(`Error while fetching '${a}': ${n}`)}));if(void 0===d)return;const u=(0,o.Os)(d,i.safeDtype.numpy),h=function(e,a){if(void 0===e)return a;const n=new a.constructor(e.length+a.length);return n.set(e),n.set(a,e.length),n}(i.raw,u);if(i.raw=h,i.nbItems=h.length/i.elementSize,i.nbItems<=e.start)return void(i.ndarray=void 0);const p=l(h,e.start*i.elementSize,i.nbItems*i.elementSize);i.ndarray=s()(p,[i.nbItems-e.start,...i.shape])}));await Promise.all(i);const c=0===r.length?void 0:r;void 0===this.pendingRequest?(this.updateCallback({loading:!1,data:Object.fromEntries(e.channelNames.map((e=>{var a;return[e,null===(a=this.cache[e])||void 0===a?void 0:a.ndarray]}))),request:n,errors:c}),this.isFetching=!1):this.fetchPendingRequest(c)}fetchPendingRequest(e){if(this.pendingRequest){const a=this.pendingRequest;this.pendingRequest=void 0,this.fetchData(a,e)}}fetch(e){this.isAborted||(void 0===this.description||this.isFetching?this.pendingRequest=e:(this.isFetching=!0,this.fetchData(e)))}abort(){this.isAborted=!0}}function d(e){const[a,n]=(0,r.useState)({loading:void 0!==e.scanId,data:{}}),{scanId:t,channelNames:o,start:i,stop:s}=e,l=(0,r.useMemo)((()=>{if(void 0!==t)return new c(n,t)}),[t]);return(0,r.useEffect)((()=>()=>{l&&l.abort()}),[l]),(0,r.useEffect)((()=>{l&&o&&void 0!==i&&void 0!==s&&l.fetch({channelNames:o,start:i,stop:s})}),[l,JSON.stringify(o),i,s]),a}},35802:(e,a,n)=>{n.d(a,{P:()=>i,Q:()=>o});var t=n(96931),r=n(99646);function o(e){const{sz:a=null,sy:n=null,sampx:o=null,sampy:i=null,sampu:s=null,sampv:l=null}=e,c=new URL(`${(0,t.Z)()}/tomo/move`);n&&c.searchParams.append("sy",n.toString()),a&&c.searchParams.append("sz",a.toString()),o&&c.searchParams.append("sampx",o.toString()),i&&c.searchParams.append("sampy",i.toString()),s&&c.searchParams.append("sampu",s.toString()),l&&c.searchParams.append("sampv",l.toString()),c.searchParams.append("relative","false");const d=new XMLHttpRequest;d.open("GET",c.href,!0),r.Z.token&&d.setRequestHeader("Authorization",`Bearer ${r.Z.token}`),d.send()}function i(e){const{datacollectionid:a,axisposition:n,deltabeta:o,filename:i}=e;if(void 0===a)return;const s=new URL(`${(0,t.Z)()}/tomo/slice_reconstruction`);void 0!==a&&s.searchParams.append("datacollectionid",a.toString()),void 0!==n&&s.searchParams.append("axisposition",n.toString()),void 0!==o&&s.searchParams.append("deltabeta",o.toString()),void 0!==i&&s.searchParams.append("filename",i);const l=new XMLHttpRequest;l.open("GET",s.href,!0),r.Z.token&&l.setRequestHeader("Authorization",`Bearer ${r.Z.token}`),l.send()}},6935:(e,a,n)=>{n.d(a,{Z:()=>p});var t=n(20837),r=n(10612),o=n.n(r),i=n(86912),s=n(88237),l=n(30601),c=n(57459),d=n(69521);const u={id:o().string,href:o().string,onClick:o().func,title:o().node.isRequired,disabled:o().bool,align:c.r,menuRole:o().string,renderMenuOnMount:o().bool,rootCloseEvent:o().string,menuVariant:o().oneOf(["dark"]),flip:o().bool,bsPrefix:o().string,variant:o().string,size:o().string},h=t.forwardRef(((e,a)=>{let{title:n,children:t,bsPrefix:r,rootCloseEvent:o,variant:c,size:u,menuRole:h,renderMenuOnMount:p,disabled:v,href:m,id:g,menuVariant:f,flip:x,...y}=e;return(0,d.jsxs)(i.Z,{ref:a,...y,children:[(0,d.jsx)(s.Z,{id:g,href:m,size:u,variant:c,disabled:v,childBsPrefix:r,children:n}),(0,d.jsx)(l.Z,{role:h,renderOnMount:p,rootCloseEvent:o,variant:f,flip:x,children:t})]})}));h.displayName="DropdownButton",h.propTypes=u;const p=h}}]);
//# sourceMappingURL=30.712b7283.chunk.js.map