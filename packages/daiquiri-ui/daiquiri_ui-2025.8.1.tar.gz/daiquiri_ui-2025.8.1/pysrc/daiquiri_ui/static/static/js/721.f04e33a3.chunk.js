"use strict";(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[721],{63887:(e,n,t)=>{t.d(n,{D8:()=>a,DJ:()=>l,Lv:()=>m,WZ:()=>u,fP:()=>d,kw:()=>s,sI:()=>c});var i=t(62958),o=t.n(i),r=t(22268);function l(e){if(!e.properties.unit)throw new Error(`${e.name} don't have unit`);const n=e.properties.position;if(null===n)throw new Error(`${e.name} don't have position`);return new(o())(n,e.properties.unit).to("mm").scalar}function s(e){if(null===e)return null;if(!e.properties.unit)throw new Error(`${e.name} don't have unit`);const n=e.properties.position;return null===n?null:new(o())(n,e.properties.unit).to("mm").scalar}function a(e){if(!e.properties.unit)throw new Error(`${e.name} don't have unit`);const n=(0,r.$)(e)?1:-1,t=e.properties.position;if(null===t)throw new Error(`${e.name} don't have position`);return new(o())(n*t,e.properties.unit).to("rad").scalar}function d(e){if(null===e)return[0,0];const{limits:n,unit:t}=e.properties;if(!t)throw new Error(`${e.name} don't have unit`);if(null===n||void 0===n)return[0,0];const[i,r]=n;return[new(o())(i,t).to("mm").scalar,new(o())(r,t).to("mm").scalar]}function u(e,n){if(null===e||null===n)return null;const t=e.properties.sample_pixel_size,i=n.properties.size;if(null===i||null===t)return null;const o=t/1e3;return[i[0]*o,i[1]*o]}function c(e,n){if(null===e)return[n,"mm"];const t=e.properties.unit;return[new(o())(n,"mm").to(t).scalar,t]}function m(e,n){var t;if(null===e)return n;const i=null!==(t=e.alias)&&void 0!==t?t:e.name;return i||n}},4721:(e,n,t)=>{t.r(n),t.d(n,{default:()=>A});var i=t(52799),o=t(34718),r=t.n(o),l=t(18578),s=t(40714),a=t(82794),d=t(91328),u=t(38213),c=t(74773),m=t(50386),p=t(21399),v=t(23986),x=t(79008),h=t(45646),g=t(69521);function f(e){const{hardware:n}=e,t=n.online?n.properties.state:"OFFLINE",i={READY:"success",MOVING:"warning",STABILIZING:"warning",INVALID:"danger",INVALID_DETECTOR_BINNING_CHANGED:"danger",INVALID_DETECTOR_DISTANCE_CHANGED:"danger",INVALID_DETECTOR_CHANGED:"danger"},o=i[t]||i.UNKNOWN;return(0,g.jsx)(h.a,{state:t,minWidth:6,variant:o})}var j=t(43957),N=t(82337),y=t(20837);var w=t(18941),C=t(30839),b=t.n(C);function Z(e){const{coef:n=1}=e,t=(0,y.useRef)(null),[i,o]=(0,y.useState)(!1),[r,l]=(0,y.useState)(!1);function s(t){if(null===t)return"";const i=t*n;return void 0!==e.precision?i.toFixed(e.precision):i.toString()}function a(e){const n=s(e);null!==t&&void 0!==t&&t.current&&(t.current.value=n)}return(0,y.useEffect)((()=>{t.current&&(t.current.value=s(e.value),o(!1))}),[e.value,e.precision]),(0,g.jsx)(w.Z.Control,{className:b()({"form-control-edited":i,"form-control-error":r}),type:"number",ref:t,onChange:function(n){var t;o(!(n.target.value===(null===(t=e.value)||void 0===t?void 0:t.toString())))},onKeyDown:function(t){switch(t.key){case"Enter":{o(!1);const i=function(){try{return Number.parseFloat(t.target.value)/n}catch{return null}}(),r=e.onValidate(i);r&&r.catch((()=>{l(!0),setTimeout((()=>{a(e.value),l(!1)}),2e3)})),t.preventDefault(),t.stopPropagation();break}case"Esc":case"Escape":i&&(l(!1),o(!1),a(e.value)),t.target.blur(),t.preventDefault(),t.stopPropagation()}},disabled:e.readOnly,step:e.step})}var E=t(70624);function _(e){const{value:n,onValueChanged:t,disabled:i=!1}=e;return(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(w.Z.Control,{value:`${null!==n&&void 0!==n?n:""}`,disabled:i,readOnly:!0}),(0,g.jsx)(l.Z,{variant:2===n?"primary":"secondary",onClick:()=>{t(2)},disabled:i,children:"2"}),(0,g.jsx)(l.Z,{variant:3===n?"primary":"secondary",onClick:()=>{t(3)},disabled:i,children:"3"}),(0,g.jsx)(l.Z,{variant:4===n?"primary":"secondary",onClick:()=>{t(4)},disabled:i,children:"4"}),(0,g.jsx)(l.Z,{variant:5===n?"primary":"secondary",onClick:()=>{t(5)},disabled:i,children:"5"})]})}var D=t(96956);function $(e){const{style:n,position:t,distances:i,className:o,thumbClassName:r,thumbStyle:l={}}=e,s=(0,y.useMemo)((()=>{const e=[];if(i.length>1){const n=i[0].position,t=i[1].position;e.push(n-.5*(t-n))}for(const n of i)e.push(n.position);if(i.length>1){const n=i[i.length-2].position,t=i[i.length-1].position;e.push(t+.5*(t-n))}return e}),[i]),a=(0,y.useMemo)((()=>{if(null===t)return null;let e=s.length;for(const[r,l]of s.entries())if(t<l){e=r-1;break}if(e<=-1)return.5;if(e>=s.length)return s.length+.5;const n=s[e],i=s[e+1],o=(t-n)/(i-n);return(0===e?-.5:e)*(1-o)+(e===s.length-2?s.length-.5:e+1)*o}),[s,t]);if(null===a)return(0,g.jsx)(g.Fragment,{});const d=100*(0,D.clamp)((a-.5)/(s.length-2),0,1);return(0,g.jsx)("div",{className:`multi-linear-range ${o}`,style:n,children:(0,g.jsx)("i",{className:`${r}`,style:{...l,left:`${d}%`}})})}var R=t(62958),I=t.n(R),z=t(63887);r()("daiquiri.components.tomo.TomoDetector");function k(e,n,t,i){return(0,y.useMemo)((()=>{function o(e){return"um"===e?"\u03bcm":e}function r(e){return e.toFixed(i).replace(/\.?0+$/,"")}if(null===e)return"\u2205";if(n===t)return`${r(e)} ${o(t)}`;return`${r(I()(e,n).to(t).scalar)} ${o(t)}`}),[e,n,t,i])}function P(e){var n,t,i,o,r,s,a,d,u,c;const{distance:p,tomoDetector:v,moveToPosition:x,disabled:h=!1,gridColumn:f,stabilizing:j=!1,sx:N}=e,[w,C]=function(){const[e,n]=(0,y.useState)(!1),t=(0,y.useRef)(null),i=()=>n(!0),o=()=>n(!1);return(0,y.useEffect)((()=>{const e=t.current;return e?(e.addEventListener("mouseover",i),e.addEventListener("mouseout",o),()=>{e.removeEventListener("mouseover",i),e.removeEventListener("mouseout",o)}):()=>{}}),[t.current]),[t,e]}(),{onEnter:b,onLeave:Z}=e,E=(0,m.eY)(void 0===(_=null!==(n=null===v||void 0===v?void 0:v.properties.detector)&&void 0!==n?n:null)||null===_?null:_.replace("hardware:",""));var _;const D=null!==(t=null===E||void 0===E?void 0:E.properties.size)&&void 0!==t?t:[0,0],$=p.pixel_size*D[0],R=null!==(i=null===N||void 0===N||null===(o=N.properties)||void 0===o?void 0:o.tolerance)&&void 0!==i?i:.001,I=null!==(r=null===N||void 0===N||null===(s=N.properties)||void 0===s?void 0:s.display_digits)&&void 0!==r?r:3,z=null!==(a=null===N||void 0===N||null===(d=N.properties)||void 0===d?void 0:d.position)&&void 0!==a?a:null,P=null!==(u=null===N||void 0===N||null===(c=N.properties)||void 0===c?void 0:c.limits)&&void 0!==u?u:[0,1],F=null!==z&&Math.abs(p.position-z)<R,L=p.position>=P[0]&&p.position<=P[1],S="focal"===p.distanceName,T=F?j?"warning":"primary":L?"secondary":"danger",A=L?"":"Position is outside of the axis limits";function V(){return S?(0,g.jsx)("h5",{className:"py-1",children:"Focal"}):(0,g.jsx)("h5",{className:`rounded-4 bg-${T} text-bg-${T} py-1`,children:`Distance ${p.distanceNum}`})}(0,y.useEffect)((()=>{C?null===b||void 0===b||b():null===Z||void 0===Z||Z()}),[C]);const O=k(p.z1,"mm","um",I-3),M=k(p.pixel_size,"um","nm",3),G=k($,"um","um",3),B=k(p.position,"mm","um",I-3);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:{gridColumn:f,gridRow:1},className:"text-center",title:A,children:(0,g.jsx)(V,{})}),(0,g.jsx)("div",{style:{gridColumn:f,gridRow:2},className:"text-center",children:O}),(0,g.jsx)("div",{style:{gridColumn:f,gridRow:3},className:"text-center",children:!S&&`${M}`}),(0,g.jsx)("div",{style:{gridColumn:f,gridRow:4},className:"text-center",children:!S&&`${G}`}),(0,g.jsx)("div",{style:{gridColumn:f,gridRow:6},title:A,className:"text-center "+(L?"":"text-danger"),children:B}),(0,g.jsx)("div",{style:{gridColumn:f,gridRow:7},title:`${L?"":"Position is outside of the axis limits"}${L&&j?"Waiting for stabilization":""}`,children:(0,g.jsx)(l.Z,{ref:w,className:"w-100",variant:F?j?"warning":"primary":"secondary",onClick:()=>{x(p.distanceName)},disabled:h||!L||j,children:"Move to"})})]})}function F(e){const{tomoDetector:n,gridColumn:t}=e;if(null===n)return(0,g.jsx)(g.Fragment,{});const i=function(){var e;return(null!==(e=null===n||void 0===n?void 0:n.properties.detector)&&void 0!==e?e:"").replace("hardware:","")}(),o=n.properties.source_distance;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:{gridColumn:t,gridRow:1},className:"text-center",children:(0,g.jsx)("h5",{className:"py-1",children:"Detector"})}),(0,g.jsx)("div",{style:{gridColumn:t,gridRow:2},className:"text-center",children:o&&(0,g.jsxs)(g.Fragment,{children:[o.toFixed(2)," mm"]})}),(0,g.jsxs)("div",{style:{gridColumn:t,gridRow:5,zIndex:1},className:"text-center text-middle my-auto",children:[(0,g.jsx)("img",{className:"mx-auto my-auto",src:"resources/tomo/holo-detector.png",alt:"Detector",style:{gridColumn:7,gridRow:2,width:"92px",height:"92px",zIndex:0,imageRendering:"pixelated"}}),(0,g.jsx)("br",{}),i]})]})}function L(e){const n=e.includes("_hd.")?"default":"pixelated";return{"--sprite-sheet":`url(${e})`,"--spritesheet-rendering":n}}function S(e){var n,t,i,o,r,m,h,w,C,b,E,D,R,I,k,S,T,A;const{options:V}=e,{tomoconfig:O}=V,M=(0,v.V5)(null!==O&&void 0!==O?O:""),G=(0,c.kP)(null!==O&&void 0!==O?O:""),B=function(e){const n=(0,x.Cd)(e);return null===n||"tomoholo"!==n.type?null:n}(null!==(n=null===G||void 0===G?void 0:G.holotomo)&&void 0!==n?n:null),W=(0,x.wi)(null!==(t=null===B||void 0===B?void 0:B.id)&&void 0!==t?t:null),q=(0,j.vM)(null!==(i=null===G||void 0===G?void 0:G.tomoDetector)&&void 0!==i?i:null),H=(0,x.pC)(),Y=(0,N.ow)(null!==(o=null===G||void 0===G?void 0:G.sx)&&void 0!==o?o:null),K=(0,x.wi)(null!==(r=null===Y||void 0===Y?void 0:Y.id)&&void 0!==r?r:null),J="MOVING"===(null===Y||void 0===Y?void 0:Y.properties.state[0]),U=function(e,n){var t,i,o,r;const l=(0,p.oT)(null!==(t=null===e||void 0===e||null===(i=e.properties.sample_stage)||void 0===i?void 0:i.slice(9))&&void 0!==t?t:null),s=null!==(o=null===l||void 0===l?void 0:l.properties.x_axis_focal_pos)&&void 0!==o?o:null,a=null!==(r=null===n||void 0===n?void 0:n.properties.distances)&&void 0!==r?r:[];return(0,y.useMemo)((()=>{const e=[];s&&e.push({distanceName:"focal",distanceNum:-1,pixel_size:0,position:s,z1:0});for(const[n,t]of a.entries())e.push({...t,distanceName:`dist${n+1}`,distanceNum:n+1});return e}),[s,a])}(M,B),[Q,X]=(0,y.useState)(!1),ee=null!==(m=null===(h=(0,c.jR)().avatar)||void 0===h?void 0:h.sprite_sheet)&&void 0!==m?m:"resources/tomo/fox-yellow.png";if(!B)return(0,g.jsx)(s.Z,{variant:"warning",children:"No holotomo object found"});function ne(e){W.call("move",e)}const te=Q;const ie=function(){if(null===Y)return"tomo-avatar";if(!J)return te?"tomo-avatar stand":"tomo-avatar";const e=Y.properties;return null===e.position||null===e.target?"tomo-avatar":e.position<e.target?"tomo-avatar walk-right":e.position>e.target?"tomo-avatar walk-left":"tomo-avatar"}(),oe=(0,z.Lv)(Y,"sx");return(0,g.jsxs)("div",{className:"w-100",style:{flex:"1 1 0%",display:"flex",flexDirection:"column"},children:[(0,g.jsx)("h2",{children:"Configuration"}),(0,g.jsxs)(a.Z,{className:"g-0",children:[(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:2,children:(0,g.jsx)("div",{children:"State"})}),(0,g.jsx)(d.Z,{className:"p-1",xs:3,children:(0,g.jsx)(f,{hardware:B})})]}),(0,g.jsxs)(a.Z,{className:"g-0",children:[(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:2,children:(0,g.jsx)("div",{children:"Nb distances"})}),(0,g.jsx)(d.Z,{className:"p-1",xs:3,children:(0,g.jsx)(_,{value:null===(w=B.properties)||void 0===w?void 0:w.nb_distances,onValueChanged:e=>{W.setProperty("nb_distances",e)},disabled:!H})})]}),(0,g.jsxs)(a.Z,{className:"g-0",children:[(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:2,children:(0,g.jsx)("div",{children:"Pixel size"})}),(0,g.jsx)(d.Z,{className:"p-1",xs:3,children:(0,g.jsx)(Z,{value:null===(C=B.properties)||void 0===C?void 0:C.pixel_size,onValidate:e=>{W.setProperty("pixel_size",e)},coef:1e3,readOnly:!H})}),(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:1,children:(0,g.jsx)("div",{title:"Nanometer",children:"nm"})}),(0,g.jsx)(d.Z,{className:"p-1",xs:1,children:(0,g.jsx)(l.Z,{variant:"secondary",onClick:()=>{W.setProperty("pixel_size",null)},disabled:!H||null===(null!==(b=null===(E=B.properties)||void 0===E?void 0:E.pixel_size)&&void 0!==b?b:null),children:(0,g.jsx)("i",{className:"fa fa-trash"})})})]}),(0,g.jsxs)(a.Z,{className:"g-0",children:[(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:2,children:(0,g.jsxs)("div",{children:["Sample position (",oe,")"]})}),(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:3,children:(0,g.jsx)("div",{children:null===Y||void 0===Y||null===(D=Y.properties)||void 0===D||null===(R=D.position)||void 0===R?void 0:R.toFixed(null!==(I=null===Y||void 0===Y||null===(k=Y.properties)||void 0===k?void 0:k.display_digits)&&void 0!==I?I:3)})}),(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:1,children:(0,g.jsx)("div",{title:"Micrometer",children:null===Y||void 0===Y||null===(S=Y.properties)||void 0===S?void 0:S.unit})}),(0,g.jsx)(d.Z,{className:"p-1",xs:1,children:(0,g.jsx)(l.Z,{style:{visibility:J?"visible":"hidden"},variant:"danger",onClick:()=>{K.call("stop")},disabled:!H,children:(0,g.jsx)("i",{className:"fa fa-xmark"})})})]}),(0,g.jsxs)(a.Z,{className:"g-0",children:[(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:2,children:(0,g.jsx)("div",{children:"Settle time"})}),(0,g.jsx)(d.Z,{className:"p-1",xs:3,children:(0,g.jsx)(Z,{value:null===(T=B.properties)||void 0===T?void 0:T.settle_time,onValidate:e=>{W.setProperty("settle_time",e)},readOnly:!H})}),(0,g.jsx)(d.Z,{className:"p-1 text-nowrap my-auto",xs:1,children:(0,g.jsx)("div",{title:"Second",children:"s"})})]}),(0,g.jsx)("h2",{children:"Distances"}),0===U.length&&(0,g.jsx)(s.Z,{variant:"warning",children:"No distances are setup"}),U&&U.length>0&&(0,g.jsxs)(u.Z,{style:{display:"grid",gridGap:5,gridTemplateColumns:`auto 1fr 1fr ${"2fr ".repeat(U.length)}`},children:[(0,g.jsx)("div",{style:{gridColumn:1,gridRow:1},children:" "}),(0,g.jsx)("div",{style:{gridColumn:1,gridRow:2},className:"text-end",title:"Distance from the focal plan",children:"Distance"}),(0,g.jsx)("div",{style:{gridColumn:1,gridRow:3},className:"text-end",children:"Pixel size"}),(0,g.jsx)("div",{style:{gridColumn:1,gridRow:4},className:"text-end",children:"Field of view"}),(0,g.jsx)("div",{style:{gridColumn:1,gridRow:6},className:"text-end",title:"Position in the x-translation axis",children:"Position"}),U.map(((e,n)=>(0,g.jsx)(P,{gridColumn:`${0===n?n+2:n+3} / ${n+4}`,distance:e,tomoDetector:q,moveToPosition:ne,disabled:!H||"READY"!==B.properties.state,sx:Y,stabilizing:"STABILIZING"===B.properties.state,onEnter:()=>X(!0),onLeave:()=>X(!1)},n))),(0,g.jsx)("img",{className:"w-100 my-auto",alt:"Beam",src:"resources/tomo/holo-beam.svg",style:{gridColumn:`3 / ${U.length+4}`,gridRow:5,height:"8em",zIndex:0,objectFit:"fill"}}),(0,g.jsx)($,{thumbClassName:`${ie}`,style:{gridColumn:`2 / ${U.length+3}`,gridRow:5,zIndex:1},thumbStyle:L(ee),variant:J?"info":"primary",position:null!==(A=null===Y||void 0===Y?void 0:Y.properties.position)&&void 0!==A?A:null,distances:U}),(0,g.jsx)(F,{tomoDetector:q,gridColumn:U.length+3})]})]})}function T(e){return(0,g.jsx)(S,{...e})}function A(e){const{yamlNode:n,tomoconfig:t,...o}=e;i.Ee(n,"tomoconfig",t),i.ol(n,o);const r={tomoconfig:t};return(0,g.jsx)(T,{options:r})}}}]);
//# sourceMappingURL=721.f04e33a3.chunk.js.map