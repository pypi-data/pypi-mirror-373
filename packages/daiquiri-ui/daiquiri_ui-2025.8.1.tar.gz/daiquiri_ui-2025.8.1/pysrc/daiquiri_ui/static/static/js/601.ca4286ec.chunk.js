"use strict";(self.webpackChunkdaiquiri_ui=self.webpackChunkdaiquiri_ui||[]).push([[601],{79842:(e,t,n)=>{n.d(t,{Z:()=>f});var s=n(70775),i=n(20837),r=n(69521);const a=function(e){const{curve:t,onClick:n,onDoubleClick:s}=e;return(0,r.jsxs)("button",{className:"btn-clean entry",type:"button","data-not-visible":t.visible?void 0:"",onClick:()=>n(),onDoubleClick:()=>s(),children:[(0,r.jsx)("div",{className:"handle",style:{backgroundColor:t.color}}),t.name]},t.name)};const c=function(e){const{curves:t,onEntryClick:n,onEntryDoubleClick:s}=e;return(0,r.jsx)("div",{children:t.map(((e,t)=>(0,r.jsx)(a,{curve:e,onClick:()=>n(t),onDoubleClick:()=>s(t)},e.name)))})};const o=function(e){const{curves:t}=e,n=t[0].x,i=(0,s.ne)(n,!0),{abscissaConfig:a}=(0,s.ki)();return(0,r.jsx)(s.p9,{guides:"both",renderTooltip:e=>{const s=i(e);return(0,r.jsxs)("div",{className:"h5web-tooltip",children:[a.label||"x","=",n[s],t.filter((e=>e.visible)).map((e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("strong",{children:[e.name,":"]})," ",e.y[s]]},e.name)))]})}})};const l=function(e){const{onDataPointClick:t,...n}=e,{abscissas:a,ordinates:c,color:o}=n,[l,d]=(0,i.useState)(),h=(0,s.ne)(a,!0),{worldToData:p}=(0,s.ki)(),u=t?(e,n)=>{const{unprojectedPoint:s}=n,i=p(s),r=h(i.x);t(r,n)}:void 0,x=t?(e,t)=>{const{unprojectedPoint:n}=t,s=p(n);d(h(s.x))}:void 0,v=t?()=>d(void 0):void 0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.b0,{onDataPointClick:u,onDataPointEnter:x,onDataPointLeave:v,...n}),l&&(0,r.jsx)(s.q6,{x:a[l],y:c[l],center:!0,children:(0,r.jsx)("svg",{className:"line-hover-svg",style:{fill:o},children:(0,r.jsx)("circle",{r:4})})})]})};var d=n(22205),h=n(26799),p=n(15568);const u=function(e){const{shapes:t=[],annotations:n=[]}=e,{width:i,height:a}=(0,h.A)((e=>e.size)),{dataToHtml:c}=(0,s.ki)(),o=function(){const{abscissaScale:e,ordinateScale:t}=(0,s.ki)(),[n,i]=e.domain(),[r,a]=t.domain();return(e,t,s,c)=>{const o="paper"===s?n+e*(i-n):e,l="paper"===c?r+t*(a-r):t;return new p.Vector3(o,l)}}(),l=(0,s.Jk)((e=>t.map((t=>({v0:c(e,o(t.x0,t.y0,t.xref,t.yref)),v1:c(e,o(t.x1,t.y1,t.xref,t.yref)),...t})))),[t]),d=(0,s.Jk)((e=>n.map(((t,n)=>({v:c(e,o(t.x,t.y,t.xref,t.yref)),...t})))),[n]);return(0,r.jsx)(s.aV,{children:(0,r.jsxs)("svg",{width:i,height:a,children:[l.map(((e,t)=>{const{v0:n,v1:s,fillcolor:i,line:a,opacity:c}=e;return(0,r.jsx)("rect",{x:Math.min(n.x,s.x),y:Math.min(n.y,s.y),width:Math.abs(s.x-n.x),height:Math.abs(s.y-n.y),fill:i,strokeWidth:null===a||void 0===a?void 0:a.width,fillOpacity:c},t)})),d.map(((e,t)=>{const{text:n,v:s}=e;return(0,r.jsx)("text",{x:s.x,y:s.y,textAnchor:"middle",children:n},t)}))]})})};const x=function(e){const{onValidSelection:t}=e,n=(0,h.A)((e=>e.camera)),{ordinateConfig:i,dataToHtml:a,dataToWorld:c}=(0,s.ki)(),[o,l]=i.visDomain;return(0,r.jsx)(s.Br,{axis:"x",onValidSelection:e=>{const{data:s}=e,i=new p.Vector3(s[0].x,o),r=new p.Vector3(s[1].x,l);t({data:[i,r],html:[a(n,i),a(n,r)],world:[c(i),c(r)]})},children:e=>{let{html:t}=e;return(0,r.jsx)(s.y8,{children:(0,r.jsx)(s.Ev,{coords:t,fill:"gray",fillOpacity:.25})})}})},v=["#1f77b4","#ff7f0e","#2ca02c","#d62728"],m=[.1,1];const f=function(e){var t,n;const{data:a,insetLegend:h,onClick:p,curveType:f,layout:j,onRoiSelection:y}=e,[g,b]=(0,i.useState)(a.map((()=>!0))),S=a.filter(d.$K).flatMap(((e,t)=>{const{x:n,y:i,name:r}=e;if(!(0,d.cj)(i))return[];const a=(0,s.Bl)(n,i.length);return[{color:v[t%v.length],visible:g[t],name:r,x:Array.isArray(a)?a:[...a],y:i}]})),k=(0,s.k9)((0,s.J9)(S.map((e=>e.x))))||m,C=(0,s.k9)((0,s.J9)(S.map((e=>e.y))))||m;if(0===S.length)return(0,r.jsx)("div",{children:"No curve data. Please select a series."});const P=e=>{b(g.map(((t,n)=>n===e?!t:t)))},N=e=>{b(g.map(((t,n)=>n===e)))};return(0,r.jsxs)("div",{className:"h5web-plot",children:[(0,r.jsxs)(s.Ic,{abscissaConfig:{visDomain:k,showGrid:!0,label:null===j||void 0===j||null===(t=j.xaxis)||void 0===t?void 0:t.title},ordinateConfig:{visDomain:C,showGrid:!0,label:null===j||void 0===j||null===(n=j.yaxis)||void 0===n?void 0:n.title},raycasterThreshold:6,children:[S.map((e=>(0,r.jsx)(l,{abscissas:e.x,ordinates:e.y,color:e.color,visible:e.visible,onDataPointClick:p,glyphSize:6,glyphType:s.j$.Circle,curveType:f},e.name))),(0,r.jsx)(s.Ce,{}),(0,r.jsx)(s.LG,{}),(0,r.jsx)(s.XZ,{modifierKey:"Control"}),(0,r.jsx)(o,{curves:S}),(0,r.jsx)(s.DG,{}),h&&(0,r.jsx)(s.Vt,{children:S.length>1&&(0,r.jsx)("div",{className:"h5web-legend","data-inset":"",children:(0,r.jsx)(c,{curves:S,onEntryClick:P,onEntryDoubleClick:N})})}),j&&(0,r.jsx)(u,{shapes:j.shapes,annotations:j.annotations}),y&&(0,r.jsx)(x,{onValidSelection:y})]}),!h&&S.length>1&&(0,r.jsx)("div",{className:"h5web-legend",children:(0,r.jsx)(c,{curves:S,onEntryClick:P,onEntryDoubleClick:N})})]})}},22205:(e,t,n)=>{function s(e){const[t]=e;return!!t&&Object.getOwnPropertyNames(t).includes("marker")}function i(e){return void 0!==e&&null!==e}function r(e){return i(e)&&e.length>0}n.d(t,{$K:()=>i,cj:()=>r,sM:()=>s})},81925:(e,t,n)=>{n.d(t,{Z:()=>v});var s=n(60979),i=n(79842),r=n(20729),a=n(96956),c=n(20837),o=n(38213),l=n(18941),d=n(82794),h=n(91328),p=n(18578),u=n(91861),x=n(69521);class v extends c.Component{constructor(e){super(e),this.point=void 0,this.max=void 0,this.lastScanId=void 0,this.onChangePoint=e=>{const t=Number(e.target.value);t<this.max&&this.props.actions.selectPoint(t)},this.clearSelection=()=>{this.props.actions.clearPoint()},this.point=(0,c.createRef)(),this.max=0}componentDidUpdate(e){const{currentPoint:t}=this.props,{scanid:n,npoints_avail:s}=this.data();if(!n)return;const i=this.lastScanId!==n;this.lastScanId=n;const r=this.max!==s;this.max=s;const a=null!==t&&void 0!==t?t:this.max-1;this.point.current&&(this.point.current.value=`${a}`),-1!==a&&(e.currentPoint!==t&&null!==t&&void 0!==t&&this.fetchScanSpectra(t),null===t&&(i||r||null!==e.currentPoint)&&this.fetchScanSpectra(a))}data(){return this.props.data[this.selectedScan()]||{}}selectedScan(){return this.props.selectedScan?this.props.selectedScan:(0,u.JD)(this.props.scans)||0}async fetchScanSpectra(e){if(this.data().scanid&&!(e<0&&this.props.currentPoint&&this.props.currentPoint<0)&&!this.props.fetching)try{await this.props.actions.fetchScanSpectra({scanid:this.selectedScan(),point:e})}catch(t){console.log("Couldn't load scan spectra",t)}}generateXData(e,t){const{conversion:n}=t;return n?(0,a.range)(e.length).map((e=>e*n.scale+n.zero)):(0,a.range)(e.length)}generateSeries(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!e)return;const[s]=e.data;if(!s)return;return{x:[...n?t.data[n].data[0]:this.generateXData(s,t)],y:[...s],type:"scattergl",name:e.name}}render(){var e;if(0===Object.keys(this.props.spectra).length)return(0,x.jsx)("span",{children:"Waiting for scan spectra"});const{selectable:t=!0,options:n={},spectra:c}=this.props,{backend:u="h5web",preSelectedXAxis:v,preSelectedSeries:m,plotTitle:f,insetLegend:j}=n,y=[];if(m){(Array.isArray(m)?m:[m]).forEach((e=>{const t=c.data[e],n=this.generateSeries(t,c,v);n&&y.push(n)}))}else(0,a.each)(c.data,(e=>{const t=this.generateSeries(e,c);t&&y.push(t)}));return(0,x.jsxs)("div",{className:"plot1d-container",children:[t&&(0,x.jsx)(o.Z,{children:(0,x.jsxs)(l.Z.Group,{as:d.Z,children:[(0,x.jsx)(l.Z.Label,{column:!0,sm:3,children:"Point"}),(0,x.jsx)(h.Z,{children:(0,x.jsx)(l.Z.Control,{type:"number",ref:this.point,onChange:this.onChangePoint,min:"0",max:this.max})}),null!==this.props.currentPoint&&(0,x.jsx)(h.Z,{xs:2,children:(0,x.jsx)(p.Z,{onClick:this.clearSelection,children:"Follow"})}),this.props.fetching&&(0,x.jsx)(h.Z,{xs:1,children:(0,x.jsx)("div",{className:"my-auto ms-2",children:(0,x.jsx)("i",{className:"fa fa-spin fa-spinner"})})})]})}),(0,x.jsx)(r.Z,{children:"h5web"===u?(0,x.jsx)(i.Z,{insetLegend:j,data:y,layout:this.props.layout}):(0,x.jsx)(s.Z,{className:"plot",data:y,layout:null!==(e=this.props.layout)&&void 0!==e?e:{}})}),(v||m||f)&&(0,x.jsx)("span",{children:f||`${m} vs. ${v}`})]})}}},86601:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h});var s=n(52799),i=n(57209),r=n(81925),a=n(45425),c=n(12678),o=n(69048);const l=(0,a.Qg)({scans:c.Z})((0,i.$j)((0,o.Z)((function(e,t,n){return{data:t.providers.scans.data.selector("results",e),scans:t.providers.scans.list.selector("results",e),spectra:t.providers.scans.spectra.selector("results",e),fetching:t.providers.scans.spectra.selector("fetching",e),currentPoint:c.Z.selector("currentPoint",e),currentImageNode:c.Z.selector("currentImageNode",e),selectedScan:c.Z.selector("selectedScan",e)}})),(function(e,t){return{actions:{selectPoint:e=>c.Z.dispatch("SCAN_CURRENT_POINT",Number.parseInt(e,10)),clearPoint:()=>c.Z.dispatch("SCAN_CURRENT_POINT",null),fetchScanSpectra:e=>t.providers.scans.spectra.fetch(e),setPage:e=>t.providers.scans.spectra.setPage(e)}}}))(r.Z));var d=n(69521);function h(e){const{providers:t,yamlNode:n,backend:i,preSelectedXAxis:r,preSelectedSeries:a,plotTitle:c,insetLegend:o,...h}=e;return s.Xc(n,"backend",i),s.Xl(n,"preSelectedXAxis",r),s.m7(n,"preSelectedSeries",a),s.Xl(n,"title",c),s.kC(n,"insetLegend",o),s.ol(n,h),(0,d.jsx)(l,{providers:t,options:{backend:i,preSelectedXAxis:r,preSelectedSeries:a,plotTitle:c,insetLegend:o}})}},69048:(e,t,n)=>{n.d(t,{Z:()=>a});var s=n(96956),i=n.n(s);class r{constructor(){this.cache=void 0,this.cache={}}debounce(e,t){const n=this.cache[e];return i().isEqual(n,t)?n:(this.cache[e]=t,t)}memo(e,t,n){const s=[void 0,void 0],[r,a]=this.cache[e]||s;if(i().isEqual(a,n))return r;const c=t();return this.cache[e]=[c,n],c}}function a(e){const t=new r;return(n,s)=>e(n,s,t)}}}]);
//# sourceMappingURL=601.ca4286ec.chunk.js.map