import{_ as C,ae as j,q as i,v as c,b as n,a as u,B as b,x as g,a6 as I,F as f,A as p,d as K,C as w,E as h,H as B,w as _,l as y,ci as L,cj as P,ck as D,aN as E,cl as N,bc as v,bd as x,D as R,z as V}from"./main-BERoK-j2.js";import{V as G}from"./VTable-KYw5fCd8.js";import{C as z}from"./confirm-dialog-Bc3Bw4Wf.js";import{c as U}from"./copy-to-clipboard-DoUvDJVx.js";import{useAdminStore as T}from"./admin-D7dHJsJ4.js";import"./forwardRefs-CGimG8CQ.js";import"./VDialog-B1OSC1f5.js";const F={name:"StatsTable",props:{title:{type:String,required:!0},items:{type:Object,required:!0}},data(){return{}},methods:{valueTable(e){return e&&typeof e=="object"?e:{}},tdClasses(e){return{indent:e[0]==="+"}},tdLabel(e){return e.replace(/^\+/,"")},nf(e){return typeof e=="number"?j.format(e):e}}},H={class:"statBlock"},$={key:0},q={colspan:"2",class:"subtitleRow"},M={key:1},X={class:"indent"};function Y(e,t,a,s,l,o){return c(),i("div",H,[n("h3",null,b(a.title),1),u(G,{class:"highlight-table"},{default:g(()=>[(c(!0),i(f,null,p(Object.entries(a.items),([r,d])=>(c(),i("tbody",{key:r},[typeof d=="object"?(c(),i("tr",$,[n("th",q,b(r),1)])):(c(),i("tr",M,[n("td",{class:K(o.tdClasses(r))},b(o.tdLabel(r)),3),n("td",null,b(o.nf(d)),1)])),(c(!0),i(f,null,p(Object.entries(o.valueTable(d)),([m,O])=>(c(),i("tr",{key:m},[n("td",X,b(m),1),n("td",null,b(o.nf(O)),1)]))),128))]))),128)),I(e.$slots,"default",{},void 0,!0)]),_:3})])}const J=C(F,[["render",Y],["__scopeId","data-v-4bb3ecd9"]]),k={topGroup:E,orderBy:D,fitTo:P,readingDirection:L},S={authGroupCount:"Authorization Groups",libraryCount:"Libraries",userAnonymousCount:"Anonymous Users",userRegisteredCount:"Registered Users"};Object.freeze(S);Object.freeze(k);const A=new Set(["creditPersonsCount","creditRolesCount","identifierSourcesCount","storyArcNumbersCount"]);Object.freeze(A);const Q={name:"AdminTasksTab",components:{ConfirmDialog:z,StatsTable:J},data(){return{showTooltip:{show:!1},schemaHref:globalThis.CODEX.API_V3_PATH+"#/api/api_v3_admin_stats_retrieve"}},computed:{...h(R,{}),...h(T,{stats:e=>e.stats}),clipBoardEnabled(){return location.prototcal=="https:"},apiTooltip(){return this.clipBoardEnabled},clipBoardIcon(){return this.showTooltip?v:x},platformTable(){const e={};for(const[t,a]of Object.entries(this.stats?.platform)){const s=this.keyToLabel(t),l=t==="system"?`${a.name} ${a.release}`:a;e[s]=l}return e},configTable(){const e={};let t="";for(const[a,s]of Object.entries(this.stats?.config)){let l;if(a=="apiKey"){t=s;continue}else l=S[a];e[l]=s}return e["API Key"]=t,e},userSettingsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.sessions)){const s={},l=k[t];for(const[r,d]of Object.entries(a)){let m;m=l?l[N(r)]:r,s[m]=d}const o=this.keyToLabel(t);e[o]=s}return e},browserGroupsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.groups)){let s=this.keyToLabel(t);s!=="Series"&&(s+="s"),e[s]=a}return e},fileTypesTable(){const e={};for(const[t,a]of Object.entries(this.stats?.fileTypes)){const s=t==="unknown"?y(t):this.keyToLabel(t).toUpperCase();e[s]=a}return e},metadataTable(){const e={};for(const[t,a]of Object.entries(this.stats?.metadata)){let s=t==="countryCount"?"Countries":this.keyToLabel(t)+"s";A.has(t)&&(s=s.replace(/^\w+ /,"+")),e[s]=a}return e}},created(){this.loadStats()},methods:{...w(T,["loadStats","updateAPIKey"]),regenAPIKey(){this.updateAPIKey().then(this.loadStats).catch(console.warn)},onClickAPIKey(){this.clipBoardEnabled&&U(this.stats.config.apiKey,this.showTooltip)},keyToLabel(e){return e=e.replace(/Count$/,""),y(e)}}},W={key:0,id:"stats"},Z={id:"schemaDoc"},ee={colspan:"2"},te=["href"],se={colspan:"2"};function ae(e,t,a,s,l,o){const r=_("StatsTable"),d=_("ConfirmDialog");return e.stats?(c(),i("div",W,[u(r,{title:"Platform",items:o.platformTable},null,8,["items"]),u(r,{title:"Config",items:o.configTable},{default:g(()=>[n("tbody",null,[n("tr",Z,[n("td",ee,[t[0]||(t[0]=V(" The only endpoint accessible by API Key is ",-1)),n("a",{href:l.schemaHref,target:"_blank"},"/admin/stats",8,te)])]),n("tr",null,[n("td",se,[u(d,{"button-text":"Regenerate API Key","title-text":"Regenerate",text:"API Key","confirm-text":"Regenerate",onConfirm:o.regenAPIKey},null,8,["onConfirm"])])])])]),_:1},8,["items"]),u(r,{title:"User Settings",items:o.userSettingsTable},null,8,["items"]),u(r,{title:"Browser Groups",items:o.browserGroupsTable},null,8,["items"]),u(r,{title:"File Types",items:o.fileTypesTable},null,8,["items"]),u(r,{title:"Metadata",items:o.metadataTable},null,8,["items"])])):B("",!0)}const de=C(Q,[["render",ae],["__scopeId","data-v-b8d4ace0"]]);export{de as default};
