{
  "template_name": "piwik_event",
  "display_name": "Custom Event Tag",
  "description": "Sends custom events to Piwik PRO Analytics with category, action, optional name, value, and custom dimensions. Ideal for tracking interactions (clicks, downloads), conversions, and business-specific actions.",
  "ai_usage_guide": {
    "when_to_use": [
      "Track user interactions like button clicks and downloads",
      "Record business events such as sign-ups, purchases, or form submissions",
      "Send conversion events for marketing attribution",
      "Migrate existing event tracking to Piwik PRO"
    ],
    "common_use_cases": [
      "CTA button clicked",
      "File download",
      "Lead form submitted",
      "Purchase completed",
      "Video started/paused/finished"
    ]
  },
  "mcp_usage": {
    "create_tag": {
      "function_name": "create_tag",
      "description": "Create a new Piwik PRO Event tag using this template.",
      "required_parameters": {
        "app_id": {
          "type": "string",
          "description": "Piwik PRO app UUID"
        },
        "attributes": {
          "type": "object",
          "description": "Tag attributes for creation. Must include name, template='piwik_event', and required template_options.",
          "required": [
            "name",
            "template",
            "template_options.category",
            "template_options.action"
          ]
        }
      },
      "optional_parameters": {
        "triggers": {
          "type": "string",
          "description": "Comma-separated list of trigger UUIDs to attach to this tag",
          "default": ""
        }
      }
    },
    "update_tag": {
      "function_name": "update_tag",
      "description": "Update an existing event tag. Only editable fields are processed (create-only and read-only fields are ignored).",
      "required_parameters": {
        "app_id": {
          "type": "string",
          "description": "Piwik PRO app UUID"
        },
        "tag_id": {
          "type": "string",
          "description": "Tag UUID to update"
        },
        "attributes": {
          "type": "object",
          "description": "Editable tag attributes (e.g., name, is_active, template_options.*)"
        }
      },
      "optional_parameters": {
        "triggers": {
          "type": "string",
          "description": "Comma-separated trigger UUIDs. If omitted, triggers remain unchanged; empty string removes all triggers.",
          "default": "__unchanged__"
        }
      }
    }
  },
  "required_attributes": {
    "name": {
      "type": "string",
      "description": "Human-readable tag name",
      "mutability": "editable",
      "validation": {
        "required": true,
        "min_length": 1,
        "max_length": 255
      }
    },
    "template": {
      "type": "string",
      "description": "Must be 'piwik_event' for this template",
      "mutability": "create-only",
      "value": "piwik_event",
      "validation": {
        "required": true,
        "fixed_value": "piwik_event"
      },
      "edit_note": "‚ö†Ô∏è Cannot be changed after tag creation"
    },
    "template_options": {
      "type": "object",
      "description": "Configuration for the event payload.",
      "mutability": "editable",
      "required": [
        "category",
        "action"
      ],
      "properties": {
        "category": {
          "type": "string",
          "description": "Event category (string or variable reference)",
          "validation": {
            "required": true
          }
        },
        "action": {
          "type": "string",
          "description": "Event action (string or variable reference)",
          "validation": {
            "required": true
          }
        }
      }
    }
  },
  "optional_attributes": {
    "is_active": {
      "type": "boolean",
      "description": "Whether the tag is active",
      "mutability": "editable",
      "default": true
    },
    "priority": {
      "type": "integer",
      "description": "Firing order priority (higher numbers fire earlier)",
      "mutability": "editable",
      "default": 0,
      "range": "0 to 4294967295"
    },
    "consent_type": {
      "type": "string",
      "description": "Consent category required before firing (e.g., analytics, conversion_tracking)",
      "mutability": "editable",
      "examples": [
        "not_require_consent",
        "analytics",
        "conversion_tracking",
        "marketing_automation"
      ]
    },
    "disable_in_debug_mode": {
      "type": "boolean",
      "description": "Disable this tag when Tag Manager is in debug mode",
      "mutability": "editable",
      "default": false
    },
    "respect_visitors_privacy": {
      "type": "boolean",
      "description": "Respect visitor privacy settings (DNT header, opt-out)",
      "mutability": "editable",
      "default": true
    },
    "template_options.name": {
      "type": "string",
      "description": "Event name (string or variable reference)",
      "mutability": "editable"
    },
    "template_options.value": {
      "type": "number",
      "description": "Event numeric value (number/integer or variable reference)",
      "mutability": "editable"
    },
    "template_options.custom_dimensions": {
      "type": "object",
      "description": "Custom dimensions map as supported by Piwik PRO",
      "mutability": "editable"
    }
  },
  "read_only_attributes": {
    "created_at": {
      "mutability": "read-only",
      "description": "Creation timestamp"
    },
    "updated_at": {
      "mutability": "read-only",
      "description": "Last update timestamp"
    },
    "is_published": {
      "mutability": "read-only",
      "description": "Whether the tag is published"
    }
  },
  "field_mutability_guide": {
    "description": "Understanding field editability after tag creation",
    "mutability_types": {
      "editable": {
        "description": "‚úÖ Can be updated anytime",
        "examples": [
          "name",
          "is_active",
          "priority",
          "consent_type",
          "template_options.*"
        ]
      },
      "create-only": {
        "description": "‚ö†Ô∏è Set during creation, immutable after",
        "examples": [
          "template",
          "tag_type"
        ]
      },
      "read-only": {
        "description": "üö´ Auto-generated, never user-modifiable",
        "examples": [
          "created_at",
          "updated_at",
          "is_published"
        ]
      }
    }
  },
  "complete_examples": {
    "create_example": {
      "description": "Create an event tag for CTA button clicks",
      "mcp_call": {
        "function": "create_tag",
        "parameters": {
          "app_id": "12345678-1234-1234-1234-123456789012",
          "attributes": {
            "name": "CTA Click",
            "template": "piwik_event",
            "consent_type": "analytics",
            "template_options": {
              "category": "engagement",
              "action": "cta_click",
              "name": "Primary CTA"
            }
          },
          "triggers": "click-trigger-uuid"
        }
      }
    },
    "update_example": {
      "description": "Update event name and add value",
      "mcp_call": {
        "function": "update_tag",
        "parameters": {
          "app_id": "12345678-1234-1234-1234-123456789012",
          "tag_id": "87654321-4321-4321-4321-210987654321",
          "attributes": {
            "name": "CTA Click (Primary)",
            "template_options": {
              "value": 1
            }
          },
          "triggers": "__unchanged__"
        }
      }
    }
  },
  "common_mistakes": [
    "Omitting required template_options.category or template_options.action",
    "Using non-numeric values for template_options.value",
    "Forgetting to attach a trigger, causing the tag not to fire",
    "Changing create-only fields like template in updates (ignored)"
  ],
  "troubleshooting": {
    "event_not_recorded": [
      "Verify triggers are attached and firing",
      "Confirm consent requirements are met",
      "Check category/action values are non-empty",
      "Inspect browser console for blocked requests or errors"
    ]
  },
  "related_mcp_tools": {
    "discovery": [
      "piwik_get_available_templates()",
      "piwik_get_tag_template(template_name='piwik_event')"
    ],
    "management": [
      "piwik_create_tag(app_id, attributes, triggers)",
      "piwik_update_tag(app_id, tag_id, attributes, triggers)",
      "piwik_list_triggers(app_id)",
      "piwik_get_tag_triggers(app_id, tag_id)"
    ]
  }
}