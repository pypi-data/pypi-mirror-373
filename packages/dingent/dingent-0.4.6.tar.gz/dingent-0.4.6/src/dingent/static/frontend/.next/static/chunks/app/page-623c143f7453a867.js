(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9555:(e,t,r)=>{Promise.resolve().then(r.bind(r,99770))},16972:()=>{},99770:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(95155),l=r(53967),a=r(12115);r(16972);var s=r(15267),i=r(79737);function o(){let{threads:e,activeThreadId:t,setActiveThreadId:r,deleteAllThreads:l}=(0,s.xH)();return(0,n.jsxs)("div",{className:"flex flex-col h-screen w-64 bg-indigo-800 text-white p-4",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("button",{onClick:()=>{r((0,i.A)())},className:"w-full px-4 py-2 border border-white/50 rounded-md hover:bg-indigo-700 transition-colors duration-200",children:"+ New Chat"})}),(0,n.jsxs)("div",{className:"flex-grow overflow-y-auto",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2 px-2",children:"History"}),(0,n.jsx)("ul",{className:"space-y-1",children:e.map(e=>(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:()=>r(e.id),className:"w-full text-left px-3 py-2 rounded-md truncate text-sm transition-colors duration-200 ".concat(e.id===t?"bg-indigo-600 font-semibold":"hover:bg-indigo-700/50"),children:[e.title," "]})},e.id))})]}),(0,n.jsx)("button",{onClick:()=>{window.confirm("Are you sure you want to delete all conversations? This action cannot be undone.")&&l()},className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-red-500/50 text-red-300 rounded-md hover:bg-red-500 hover:text-white transition-colors duration-200",children:"Clear All Chats"})]})}var c=r(88145),u=r(90740),d=r(85070),f=r(57931),h=r(84151);function m(){let[e]=(0,a.useState)("#6366f1"),{widgets:t}=function(){let{state:e}=(0,u.Z9)({name:"dingent"});return function(e){let{clearOnEmptyIds:t=!0,autoFetch:r=!0,keepOrphanWidgets:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[l,s]=(0,a.useState)({}),[i,o]=(0,a.useState)([]),[c,u]=(0,a.useState)({}),d=(0,a.useRef)(new Set),f=(0,a.useRef)({}),h=(0,a.useRef)(!1),m=(0,a.useMemo)(()=>{if(e)return Array.from(new Set(e.filter(Boolean)))},[e]),g=(0,a.useCallback)(()=>{!n&&m&&s(e=>{let t={};for(let r of m)e[r]&&(t[r]=e[r]);return t})},[m,n]),p=(0,a.useCallback)((e,t)=>{if(!Array.isArray(e.display))throw Error("Invalid response: 'display' must be an array");return e.display.map((r,n)=>{let l="string"==typeof r.type&&r.type||"unknown",a="".concat(t,"::").concat(n);return"table"===l?{id:a,type:"table",payload:{type:"table",title:r.title,columns:Array.isArray(r.columns)?r.columns:[],rows:Array.isArray(r.rows)?r.rows:[],raw:r},metadata:e.metadata}:{id:a,type:l,payload:{type:l,title:r.title,...r},metadata:e.metadata}})},[]),b=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&d.current.has(e))return;f.current[e]&&f.current[e].abort();let r=new AbortController;f.current[e]=r,o(t=>t.includes(e)?t:[...t,e]),u(t=>{let{[e]:r,...n}=t;return n});try{let t=await fetch("/api/resource/".concat(e),{signal:r.signal});if(!t.ok)throw Error("HTTP ".concat(t.status));let n=await t.json(),l=p(n,e);s(t=>({...t,[e]:l})),d.current.add(e),h.current=!0}catch(r){if(r instanceof Error&&"AbortError"===r.name)return;let t="Unknown fetch error";r instanceof Error&&(t=r.message),u(r=>({...r,[e]:t}))}finally{o(t=>t.filter(t=>t!==e)),delete f.current[e]}},[p]),w=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";if(!m||0===m.length)return;let t="all"===e?m:e.filter(e=>m.includes(e));for(let e of t)d.current.delete(e);t.forEach(e=>{b(e,!0)})},[m,b]);return(0,a.useEffect)(()=>{if(void 0!==m){if(0===m.length){t&&(s(e=>0===Object.keys(e).length?e:{}),d.current.clear());return}if(g(),r)for(let e of m)d.current.has(e)||b(e)}},[m,r,t,g,b]),(0,a.useEffect)(()=>()=>{Object.values(f.current).forEach(e=>e.abort())},[]),{widgets:(0,a.useMemo)(()=>{if(void 0===m)return Object.values(l).flat();let e=[];for(let t of m){let r=l[t];r&&e.push(...r)}return e},[l,m]),loadingIds:i,errorById:c,refresh:w,hasFetched:h.current}}(e&&Object.prototype.hasOwnProperty.call(e,"artifact_ids")?e.artifact_ids:void 0)}();return!function(){let{messages:e,setMessages:t}=(0,d.B)(),{threadId:r,agentSession:n,runtimeClient:l}=(0,f.F)(),{threads:i,updateThreadTitle:o}=(0,s.xH)(),{setState:c}=(0,u.Z9)({name:"dingent"}),m=(0,a.useRef)(""),g=(0,a.useRef)(""),p=(0,a.useRef)(""),b=(0,a.useMemo)(()=>i.find(e=>e.id===r),[i,r]),w=(0,a.useRef)(b);(0,a.useEffect)(()=>{w.current=b},[b,t]),(0,a.useEffect)(()=>{let e=null==n?void 0:n.agentName;if(!r||!e||r===m.current&&e===g.current)return;let a=!1;return(async()=>{var n,s,i,o,u,d;let f=await l.loadAgentState({threadId:r,agentName:e});if(a)return;if(f.error){console.error("Failed to load agent state:",f.error),m.current=r,g.current=e;return}let b=null==(s=f.data)||null==(n=s.loadAgentState)?void 0:n.messages,w=null==(o=f.data)||null==(i=o.loadAgentState)?void 0:i.threadExists,y=null==(d=f.data)||null==(u=d.loadAgentState)?void 0:u.state;if(w){p.current=b||"",m.current=r,g.current=e;try{let e=(0,h.iD)(JSON.parse(b||"[]")),r=JSON.parse(y||"{}").artifact_ids||[];t(e),c({artifact_ids:r})}catch(e){console.error("Error parsing messages JSON:",e),t([]),c({artifact_ids:[]})}}else t([]),c({artifact_ids:[]}),m.current=r,g.current=e})(),()=>{a=!0}},[r,null==n?void 0:n.agentName,l,t,c]),(0,a.useEffect)(()=>{if(!(null==e?void 0:e.length)||!w.current)return;let t=w.current;if(t&&"New Chat"===t.title){let r=e.find(e=>"role"in e&&"user"===e.role);if(null==r?void 0:r.content){let e=r.content.substring(0,50).trim();e&&o(t.id,e)}}},[e,o])}(),(0,n.jsx)("main",{style:{"--copilot-kit-primary-color":e},children:(0,n.jsxs)("div",{className:"flex flex-row w-full h-screen",children:[(0,n.jsx)(o,{})," ",(0,n.jsxs)("div",{className:"relative flex-grow flex",children:[(0,n.jsx)(c.D,{widgets:t}),(0,n.jsx)(l.R,{clickOutsideToClose:!1,defaultOpen:!0,labels:{title:"Popup Assistant",initial:"\uD83D\uDC4B Select a conversation or start a new one!"}})]})]})})}}},e=>{e.O(0,[901,823,545,96,696,145,441,964,358],()=>e(e.s=9555)),_N_E=e.O()}]);