"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["9123"],{7214:function(t,i,s){s.d(i,{Cj:function(){return l},F7:function(){return r},Hs:function(){return H},Kd:function(){return S},Kj:function(){return y},Nw:function(){return p},PA:function(){return n},Py:function(){return c},Qm:function(){return I},Z0:function(){return w},_Y:function(){return _},_m:function(){return a},dL:function(){return d},dO:function(){return x},hN:function(){return f},h_:function(){return u},j2:function(){return b},q6:function(){return g},uR:function(){return h},yf:function(){return o}});s(39710),s(26847),s(81738),s(72489),s(56389),s(27530);var e=s(15459),r=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const n=99387==s.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,o=["L","gal","ft³","m³","CCF"],a=t=>t.sendMessagePromise({type:"recorder/info"}),h=(t,i)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:i}),c=(t,i)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:i}),d=(t,i,s,e,r="hour",n,o)=>t.callWS({type:"recorder/statistics_during_period",start_time:i.toISOString(),end_time:null==s?void 0:s.toISOString(),statistic_ids:e,period:r,units:n,types:o}),_=(t,i,s,e)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:i,units:e,fixed_period:s.fixed_period?{start_time:s.fixed_period.start instanceof Date?s.fixed_period.start.toISOString():s.fixed_period.start,end_time:s.fixed_period.end instanceof Date?s.fixed_period.end.toISOString():s.fixed_period.end}:void 0,calendar:s.calendar,rolling_window:s.rolling_window}),u=t=>t.callWS({type:"recorder/validate_statistics"}),l=(t,i,s)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:i,unit_of_measurement:s}),f=(t,i)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:i}),y=t=>{let i=null;if(!t)return null;for(const s of t)null!==s.change&&void 0!==s.change&&(null===i?i=s.change:i+=s.change);return i},g=(t,i)=>{let s=null;for(const e of i){if(!(e in t))continue;const i=y(t[e]);null!==i&&(null===s?s=i:s+=i)}return s},p=(t,i)=>t.some(t=>void 0!==t[i]&&null!==t[i]),m=["mean","min","max"],v=["sum","state","change"],w=(t,i)=>!(!m.includes(i)||0===t.mean_type)||!(!v.includes(i)||!t.has_sum),b=(t,i,s,e,r)=>{const n=new Date(s).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:i,start_time:n,adjustment:e,adjustment_unit_of_measurement:r})},S=(t,i,s)=>{const r=t.states[i];return r?(0,e.C)(r):(null==s?void 0:s.name)||i},x=(t,i,s)=>{let e;var r;i&&(e=null===(r=t.states[i])||void 0===r?void 0:r.attributes.unit_of_measurement);return void 0===e?null==s?void 0:s.statistics_unit_of_measurement:e},H=t=>t.includes(":"),I=t=>t.callWS({type:"recorder/update_statistics_issues"})},69782:function(t,i,s){s.a(t,async function(t,e){try{s.r(i),s.d(i,{DEFAULT_HOURS_TO_SHOW:function(){return x},HuiHistoryGraphCard:function(){return H}});s(40777),s(26847),s(2394),s(81738),s(22960),s(87799),s(1455),s(27530);var r=s(73742),n=s(59048),o=s(7616),a=s(31733),h=s(37528),c=s(96778),d=(s(12942),s(31138),s(5786),s(89166)),_=s(92523),u=s(93647),l=s(55577),f=s(64637),y=s(7214),g=t([c,d]);[c,d]=g.then?(await g)():g;let p,m,v,w,b,S=t=>t;const x=24;class H extends n.oi{static async getConfigElement(){return await Promise.all([s.e("73614"),s.e("15601"),s.e("15634"),s.e("26452"),s.e("2769"),s.e("19596"),s.e("95115")]).then(s.bind(s,23374)),document.createElement("hui-history-graph-card-editor")}static getStubConfig(){return{type:"history-graph",entities:["sun.sun"]}}getCardSize(){var t,i;return null!==(t=this._config)&&void 0!==t&&t.title?2:0+2*((null===(i=this._entityIds)||void 0===i?void 0:i.length)||1)}getGridOptions(){return{columns:12,min_columns:6,min_rows:2}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const i=t.entities?(0,l.A)(t.entities):[];this._entityIds=[],i.forEach(t=>{this._entityIds.push(t.entity),t.name&&(this._names[t.entity]=t.name)}),this._hoursToShow=t.hours_to_show||x,this._config=t}connectedCallback(){super.connectedCallback(),this.hasUpdated&&this._subscribeHistory()}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeHistory()}async _subscribeHistory(){if(!(0,h.p)(this.hass,"history")||this._subscribed)return;const{numeric_device_classes:t}=await(0,_.ib)(this.hass);this._subscribed=(0,d.xS)(this.hass,i=>{var s;this._subscribed&&(this._stateHistory=(0,d.Nu)(this.hass,i,this._entityIds,this.hass.localize,t,null===(s=this._config)||void 0===s?void 0:s.split_device_classes),this._mergeHistory())},this._hoursToShow,this._entityIds).catch(t=>{this._subscribed=void 0,this._error=t}),await this._fetchStatistics(t),this._setRedrawTimer()}_mergeHistory(){var t;this._stateHistory&&(this._history=(0,d.V3)(this._stateHistory,this._statisticsHistory,null===(t=this._config)||void 0===t?void 0:t.split_device_classes))}async _fetchStatistics(t){var i;const s=new Date,e=new Date;e.setHours(e.getHours()-this._hoursToShow);const r=await(0,y.dL)(this.hass,e,s,this._entityIds,"hour",void 0,["mean","state"]);this._statisticsHistory=(0,d.YA)(this.hass,r,this._entityIds,t,null===(i=this._config)||void 0===i?void 0:i.split_device_classes),this._mergeHistory()}_redrawGraph(){this._history&&(this._history=Object.assign({},this._history))}_setRedrawTimer(){clearInterval(this._interval),this._interval=window.setInterval(()=>this._redrawGraph(),6e4)}_unsubscribeHistory(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then(t=>null==t?void 0:t()),this._subscribed=void 0)}shouldUpdate(t){return(0,u.Wh)(this,t)||t.size>1||!t.has("hass")}updated(t){if(super.updated(t),!(this._config&&this.hass&&this._hoursToShow&&this._entityIds.length))return;if(!t.has("_config")&&!t.has("hass"))return;const i=t.get("_config");!t.has("_config")||(null==i?void 0:i.entities)===this._config.entities&&(null==i?void 0:i.hours_to_show)===this._config.hours_to_show||(this._unsubscribeHistory(),this._subscribeHistory())}render(){var t,i,s,e;if(!this.hass||!this._config)return n.Ld;const r=new Date;r.setHours(r.getHours()-this._hoursToShow);const o=`/history?${(0,f.ou)({entity_id:this._entityIds.join(","),start_date:r.toISOString()})}`,h=null!==(t=null===(i=this._config.grid_options)||void 0===i?void 0:i.columns)&&void 0!==t?t:12,c="number"==typeof h&&h<=12,d="number"==typeof(null===(s=this._config.grid_options)||void 0===s?void 0:s.rows);return(0,n.dy)(p||(p=S` <ha-card> ${0} <div class="content ${0}"> ${0} </div> </ha-card> `),this._config.title?(0,n.dy)(m||(m=S` <h1 class="card-header"> ${0} <a href="${0}"><ha-icon-next></ha-icon-next></a> </h1> `),this._config.title,o):n.Ld,(0,a.$)({"has-header":!!this._config.title,"has-rows":!(null===(e=this._config.grid_options)||void 0===e||!e.rows),"has-height":d}),this._error?(0,n.dy)(v||(v=S` <ha-alert alert-type="error"> ${0}: ${0} </ha-alert> `),this.hass.localize("ui.components.history_charts.error"),this._error.message||this._error.code):(0,n.dy)(w||(w=S` <state-history-charts .hass="${0}" .isLoadingData="${0}" .historyData="${0}" .names="${0}" up-to-now .hoursToShow="${0}" .showNames="${0}" .logarithmicScale="${0}" .minYAxis="${0}" .maxYAxis="${0}" .fitYData="${0}" .height="${0}" .narrow="${0}" .expandLegend="${0}"></state-history-charts> `),this.hass,!this._history,this._history,this._names,this._hoursToShow,void 0===this._config.show_names||this._config.show_names,this._config.logarithmic_scale||!1,this._config.min_y_axis,this._config.max_y_axis,this._config.fit_y_data||!1,d?"100%":void 0,c,this._config.expand_legend))}constructor(...t){super(...t),this._names={},this._entityIds=[],this._hoursToShow=x}}H.styles=(0,n.iv)(b||(b=S`ha-card{display:flex;flex-direction:column;height:100%}.card-header{justify-content:space-between;display:flex;padding-bottom:0}.card-header ha-icon-next{--mdc-icon-button-size:24px;line-height:24px;color:var(--primary-text-color)}.content{padding:0 16px 8px;flex:1;overflow:hidden}.has-header{padding-top:0}state-history-charts{--timeline-top-margin:16px}.has-height state-history-charts{height:100%}.has-rows{--chart-max-height:100%}`)),(0,r.__decorate)([(0,o.Cb)({attribute:!1})],H.prototype,"hass",void 0),(0,r.__decorate)([(0,o.SB)()],H.prototype,"_history",void 0),(0,r.__decorate)([(0,o.SB)()],H.prototype,"_statisticsHistory",void 0),(0,r.__decorate)([(0,o.SB)()],H.prototype,"_config",void 0),(0,r.__decorate)([(0,o.SB)()],H.prototype,"_error",void 0),H=(0,r.__decorate)([(0,o.Mo)("hui-history-graph-card")],H),e()}catch(p){e(p)}})}}]);
//# sourceMappingURL=9123.dcf11d709923408d.js.map