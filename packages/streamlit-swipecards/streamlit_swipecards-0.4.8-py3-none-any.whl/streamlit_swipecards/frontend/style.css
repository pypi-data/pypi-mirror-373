/* Swipe Cards Styles with Automatic Theming */

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* Theme variables - base values, overridden dynamically */
:root {
  /* Streamlit theme bindings */
  --primary-color: #ff4b4b;
  --background-color: #f8f9fa;
  --secondary-background-color: #ffffff;
  --text-color: #262730;

  /* Component mappings */
  --bg-color: var(--background-color);
  --card-bg: var(--secondary-background-color);
  --text-primary: var(--text-color);
  --text-secondary: #666666;
  --border-color: #e0e0e0;
  --card-border-color: #333333;
  --card-border: 1px solid var(--card-border-color);
  --button-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  /* Table and buttons */
  --table-font-size: 14px;
  --btn-like-bg: ;
  --btn-like-fg: ;
  --btn-pass-bg: ;
  --btn-pass-fg: ;
  --btn-back-bg: ;
  --btn-back-fg: ;
  --btn-border: var(--text-color);
}

/* Dark theme overrides */
[data-theme="dark"] {
  --background-color: #0e1117;
  --secondary-background-color: #262730;
  --text-color: #fafafa;
  --text-secondary: #a6a6a6;
  --border-color: #464748;
  --card-border-color: #fafafa;
  --card-border: 1px solid var(--card-border-color);
  --button-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --btn-border: var(--text-color);
}

body {
  font-family: var(--font, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif);
  background: var(--bg-color);
  margin: 0;
  padding: 0;
  width: 100%;
  transition: background-color 0.3s ease;
}

.swipe-container {
  width: 100%;
  max-width: 100%;
  height: auto;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  margin: 0 auto;
  padding: 0 8px;
}

.cards-stack {
  position: relative;
  width: 100%;
  max-width: 360px; /* unified desktop card width */
  height: 450px;
  margin-bottom: 15px;
}

.swipe-card {
  position: absolute;
  width: 100%;
  height: 100%;
  background: var(--card-bg);
  border-radius: 16px;
  cursor: grab;
  transition: transform 0.2s ease-out, opacity 0.2s ease-out, background-color 0.3s ease;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  user-select: none;
  border: var(--card-border);
}

.swipe-card:active {
  cursor: grabbing;
}

.swipe-card.dragging {
  transition: none;
  z-index: 1000;
}

.swipe-card.swiped-right {
  transform: translateX(400px) rotate(30deg);
  opacity: 0;
}

.swipe-card.swiped-left {
  transform: translateX(-400px) rotate(-30deg);
  opacity: 0;
}

.return-from-left {
  animation: return-from-left 0.3s ease-out;
}

.return-from-right {
  animation: return-from-right 0.3s ease-out;
}

@keyframes return-from-left {
  from {
    transform: translateX(-400px) rotate(-30deg);
    opacity: 0;
  }
  to {
    transform: translateX(0) rotate(0);
    opacity: 1;
  }
}

@keyframes return-from-right {
  from {
    transform: translateX(400px) rotate(30deg);
    opacity: 0;
  }
  to {
    transform: translateX(0) rotate(0);
    opacity: 1;
  }
}

.card-image {
  width: 100%;
  height: 75%;
  object-fit: cover;
  border-radius: 16px 16px 0 0;
  transition: filter 0.25s ease, opacity 0.25s ease;
}

.card-image.loading {
  filter: blur(8px);
  opacity: 0.7;
}

.card-content {
  padding: 12px 16px;
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  background: var(--card-bg);
  position: relative;
  z-index: 2;
  border-top: var(--card-border);
}

.card-name {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
  line-height: 1.2;
}

.card-description {
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.3;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  line-clamp: 1;
  -webkit-box-orient: vertical;
}

.card-pills {
  margin-top: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: flex-start;
}

.card-pill {
  display: inline-block;
  padding: 4px 12px;
  background: var(--border-color);
  color: var(--text-secondary);
  border-radius: 16px;
  font-size: 11px;
  font-weight: 500;
  border: 1px solid var(--border-color);
  transition: all 0.2s ease;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

/* Show all pills button */
.pills-show-more-btn {
  appearance: none;
  border: 1px solid var(--border-color);
  background: var(--card-bg);
  color: var(--text-secondary);
  width: 26px;
  height: 26px;
  border-radius: 50%;
  font-size: 12px;
  font-weight: 600;
  line-height: 26px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s ease;
  padding: 0;
}
.pills-show-more-btn:hover {
  background: var(--border-color);
  color: var(--text-primary);
}

/* Dark theme pills */
[data-theme="dark"] .card-pill {
  background: var(--border-color);
  color: var(--text-secondary);
  border-color: var(--border-color);
}

.card-pill:hover {
  background: var(--text-secondary);
  color: var(--card-bg);
}

/* Pills Modal */
.pills-modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.pills-modal {
  background: var(--card-bg);
  color: var(--text-primary);
  border-radius: 12px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
  max-width: 90vw;
  width: 520px;
  max-height: 75vh;
  display: flex;
  flex-direction: column;
  border: 1px solid var(--border-color);
}

.pills-modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border-color);
}

.pills-modal-title {
  font-weight: 600;
  font-size: 14px;
}

.pills-modal-close {
  appearance: none;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  font-size: 18px;
  line-height: 1;
  cursor: pointer;
}

.pills-modal-body {
  padding: 12px;
  overflow: auto;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

/* Prevent background scroll when modal open (within iframe) */
html.pills-modal-open, body.pills-modal-open {
  overflow: hidden;
}

.action-buttons {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 220px;
  margin-top: 10px;
  margin-bottom: 8px;
}

.results-section {
  margin-top: 8px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.swipe-counter {
  color: var(--text-secondary);
  font-size: 12px;
  text-align: center;
  opacity: 0.8;
}

/* Mode toggle styles */
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card-header-buttons {
  display: flex;
  gap: 8px;
}

.mode-toggle-btn {
  padding: 4px 12px;
  border-radius: 20px;
  border: 1px solid var(--border-color);
  background: var(--card-bg);
  color: var(--text-primary);
  cursor: pointer;
  font-size: 13px;
  transition: background 0.2s ease, color 0.2s ease;
  position: relative;
  z-index: 5;
  pointer-events: auto;
}

.swipe-container.inspect-mode .mode-toggle-btn {
  background: var(--button-gradient);
  color: #fff;
  border: none;
}

.action-btn {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 2px solid var(--btn-border, rgba(0, 0, 0, 0.15));
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: bold;
  transition: transform 0.2s ease;
  color: white;
}

/* Ensure border visibility in dark theme */
[data-theme="dark"] .action-btn {
  border-color: var(--btn-border, rgba(255, 255, 255, 0.25));
}

/* Disable interactions when in inspect mode */
.swipe-container.inspect-mode .swipe-card {
  cursor: default;
}

.swipe-container.inspect-mode .action-btn {
  opacity: 0.5;
}

.swipe-container.inspect-mode .ag-grid-container {
  pointer-events: auto;
}

.action-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 10px rgba(0,0,0,0.18);
}

.action-btn:active {
  transform: scale(0.95);
}

.action-btn:disabled {
  filter: grayscale(1);
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-pass {
  background: var(--btn-pass-bg, #262730);
  color: var(--btn-pass-fg, #fafafa);
}

.btn-back {
  background: var(--btn-back-bg, #262730);
  color: var(--btn-back-fg, #fafafa);
  border-color: var(--btn-border, #fafafa);
}

.btn-back svg {
  width: 24px;
  height: 24px;
  pointer-events: none;
}

.btn-like {
  background: var(--btn-like-bg, #262730);
  color: var(--btn-like-fg, #fafafa);
}

.action-indicator {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 48px;
  font-weight: bold;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  z-index: 10;
}

.action-indicator.like {
  right: 20px;
  color: #4ade80;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.action-indicator.pass {
  left: 20px;
  color: #ef4444;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.action-indicator.show {
  opacity: 1;
}

.no-more-cards {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 320px;
  color: var(--text-primary);
  text-align: center;
  background: var(--card-bg);
  border-radius: 16px;
  border: var(--card-border);
  padding: 20px;
}

.no-more-cards h3 {
  font-size: 24px;
  margin-bottom: 10px;
  color: var(--text-primary);
}

.no-more-cards p {
  font-size: 16px;
  opacity: 0.8;
  color: var(--text-secondary);
}

/* Stacking effect for cards behind */
.swipe-card {
  /* Base positioning for all cards */
  z-index: 1;
}

/* Use position classes instead of nth-child for consistent sizing */
.card-front {
  z-index: 3;
  /* Front card keeps normal size */
}

.card-second {
  transform: scale(1) translateY(0px);
  z-index: 2;
}

.card-third {
  transform: scale(1) translateY(0px);
  z-index: 1;
}

/* Hide any additional cards beyond the third in non-table mode */
.swipe-container:not(.table-mode) .swipe-card:nth-child(n+4) {
  display: none;
}

/* Mobile responsiveness */
@media (max-width: 480px) {
  .swipe-container {
    max-width: 100%;
    padding: 0 6px;
  }

  .cards-stack {
    width: 100%;
    height: 400px;
  }
  
  .card-name {
    font-size: 18px;
  }
  
  .card-description {
    font-size: 11px;
  }
  
  .action-buttons {
    width: 200px;
  }
  
  .action-btn {
    width: 55px;
    height: 55px;
    font-size: 22px;
  }

  .swipe-counter {
    font-size: 11px;
  }
}

/* Table card styles */
.table-card-image {
  width: 100%;
  height: 75%;
  overflow: hidden;
  border-radius: 16px 16px 0 0;
  background: var(--card-bg);
  position: relative;
}

.table-container {
  height: 100%;
  overflow: auto;
  padding: 12px;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

[data-theme="dark"] .table-container {
  background: linear-gradient(135deg, #1a1d23 0%, #262730 100%);
}

.data-table {
  width: 100%;
  /* Use separate borders to avoid collapsed-border conflicts hiding highlights */
  border-collapse: separate;
  border-spacing: 0;
  font-size: var(--table-font-size, 14px);
  color: var(--text-primary);
  background: var(--card-bg);
  border-radius: 8px;
  overflow: hidden;
}

.data-table th {
  background: var(--background-color);
  color: var(--text-color);
  padding: 10px 8px;
  text-align: left;
  font-weight: 600;
  font-size: calc(var(--table-font-size, 14px) - 2px);
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 10;
  text-shadow: none;
}

.data-table td {
  padding: 8px 8px;
  border: 1px solid var(--border-color);
  word-wrap: break-word;
  max-width: 80px;
  vertical-align: top;
  background: var(--card-bg);
  transition: all 0.3s ease;
  font-size: var(--table-font-size, 14px);
  color: var(--text-primary);
}

.data-table tbody tr:hover {
  background-color: var(--bg-color);
  /* Avoid scaling rows – it creates stacking contexts and hides borders */
  transform: none;
}


/* Highlighted cells with better styling */
.data-table td[style*="background-color"] {
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  position: relative;
  /* Ensure highlighted cells are not constrained in width in fallback table */
  max-width: none;
  white-space: normal;
  word-break: break-word;
  overflow-wrap: anywhere;
  /* Keep highlighted borders above neighbors */
  z-index: 1;
}

/* If a cell is highlighted via inline border, ensure it paints on top */
.data-table td[style*="border:"] {
  position: relative;
  z-index: 1;
}

.data-table td[style*="background-color"]::before {
  content: '✨';
  position: absolute;
  top: -2px;
  right: -2px;
  font-size: 8px;
  opacity: 0.7;
}

/* Scrollbar styling for table */
.table-container::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

.table-container::-webkit-scrollbar-track {
  background: transparent;
}

.table-container::-webkit-scrollbar-thumb {
  background: rgba(102, 126, 234, 0.3);
  border-radius: 2px;
}

.table-container::-webkit-scrollbar-thumb:hover {
  background: rgba(102, 126, 234, 0.5);
}

/* Adjust card size for table mode */
.swipe-container.table-mode {
  max-width: 100%;
}

.swipe-container.table-mode .cards-stack {
  width: 100%;
  max-width: 360px; /* default mobile width for table cards */
  height: 480px;
}

/* Tablet view - medium width cards (previously desktop behavior) */
.swipe-container.tablet-view .cards-stack {
  max-width: 800px;
}

/* Tablet view for table mode - override default table width */
.swipe-container.table-mode.tablet-view .cards-stack {
  max-width: 800px;
}

/* Desktop view - full width cards that take advantage of available space */
.swipe-container.desktop-view .cards-stack {
  max-width: 100%;
  width: 100%;
}

/* Desktop view for table mode - override default table width */
.swipe-container.table-mode.desktop-view .cards-stack {
  max-width: 100%;
  width: 100%;
}

/* Mobile responsiveness for table cards */
@media (max-width: 480px) {
  .swipe-container.table-mode {
    max-width: 100%;
  }

  .swipe-container.table-mode .cards-stack {
    width: 100%;
    height: 420px;
  }
  
  .data-table {
    font-size: 9px;
  }
  
  .data-table th {
    font-size: 8px;
    padding: 4px 3px;
  }
  
  .data-table td {
    padding: 4px 3px;
    max-width: 60px;
    font-size: 8px;
  }
  
  .table-container {
    padding: 8px;
  }
}

/* AG-Grid Integration Styles */
.ag-grid-container {
  height: 100%;
  width: 100%;
  border-radius: 8px;
  overflow: hidden;
  background: var(--card-bg);
  transition: filter 0.25s ease, opacity 0.25s ease, visibility 0.25s ease;
}

/* In swipe mode, prevent any table scrolling within the grid */
.swipe-container.swipe-mode .ag-grid-container .ag-body-horizontal-scroll,
.swipe-container.swipe-mode .ag-grid-container .ag-body-vertical-scroll {
  display: none !important;
}

.swipe-container.swipe-mode .ag-grid-container .ag-body-viewport,
.swipe-container.swipe-mode .ag-grid-container .ag-center-cols-viewport {
  overflow: hidden !important;
}

.ag-grid-container .ag-center-cols-container {
  padding-bottom: 16px;
}

.ag-grid-container.loading {
  filter: blur(8px);
  opacity: 0.7;
}

/* In swipe mode, hide column resize handles */
@media (pointer: coarse) {
  .swipe-container.swipe-mode .ag-grid-container .ag-header-cell-resize,
  .swipe-container.swipe-mode .ag-grid-container .ag-resizer {
    display: none !important;
    pointer-events: none !important;
  }
}

/* Ensure highlighted fallback cells are never width-capped on small screens */
@media (max-width: 480px) {
  .data-table td[style*="background-color"] {
    max-width: none !important;
  }
}

/* In inspect mode, allow manual panning by user */
.swipe-container.inspect-mode .ag-grid-container {
  cursor: grab;
  touch-action: none; /* let JS pan both directions */
}
.swipe-container.inspect-mode .ag-grid-container.panning {
  cursor: grabbing;
}

/* Loading overlay for table cards */

.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.4);
  z-index: 10;
  opacity: 1;
  transition: opacity 0.3s ease;
}

.loading-overlay.fade-out {
  opacity: 0;
}

.loading-snake {
  width: 24px;
  height: 24px;
  border: 3px solid #fff;
  border-top-color: transparent;
  border-right-color: transparent;
  border-radius: 50%;
  animation: loading-spin 1s linear infinite;
  margin-bottom: 8px;
}

@keyframes loading-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-btn {
  background: var(--button-gradient);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  cursor: default;
}

/* Hidden state for background cards */
.ag-grid-container[style*="visibility: hidden"] {
  pointer-events: none;
}

.ag-grid-container[style*="opacity: 0"] {
  pointer-events: none;
}

/* AG-Grid theme customization to match our design */
.ag-grid-container .ag-theme-alpine {
  --ag-background-color: var(--card-bg);
  --ag-header-background-color: var(--background-color);
  --ag-header-foreground-color: var(--text-color);
  --ag-odd-row-background-color: var(--card-bg);
  --ag-row-hover-color: var(--bg-color);
  --ag-selected-row-background-color: rgba(0, 123, 255, 0.1);
  --ag-border-color: var(--border-color);
  --ag-foreground-color: var(--text-primary);
  --ag-secondary-foreground-color: var(--text-secondary);
  --ag-font-size: var(--table-font-size, 14px);
  --ag-font-family: inherit;
  font-family: inherit;
  border-radius: 8px;
  color: var(--text-primary);
}

/* Header styling aligned with Streamlit theme */
.ag-grid-container .ag-header {
  background: var(--background-color) !important;
  border-radius: 8px 8px 0 0;
}

.ag-grid-container .ag-header-cell {
  background: transparent !important;
  color: var(--text-color) !important;
  font-weight: 600 !important;
  text-shadow: none !important;
  border-right: 1px solid var(--border-color) !important;
}

.ag-grid-container .ag-header-cell-label {
  color: var(--text-color) !important;
}

/* Row styling */
.ag-grid-container .ag-row {
  border-bottom: 1px solid var(--border-color) !important;
  transition: all 0.3s ease;
}

.ag-grid-container .ag-row:hover {
  background-color: var(--bg-color) !important;
  /* Avoid scaling rows – it can hide cell borders after autosize */
  transform: none;
}

/* Cell styling */
.ag-grid-container .ag-cell {
  border-right: 1px solid var(--border-color) !important;
  font-size: var(--table-font-size, 14px) !important;
  padding: 6px 8px !important;
  color: var(--text-primary) !important;
  background-color: var(--card-bg) !important;
}

/* Remove default focus outline */
.ag-grid-container .ag-cell:focus {
  outline: none !important;
}

/* Custom styling for highlighted cells in AG-Grid */
.ag-grid-container .ag-cell.highlighted-cell {
  font-weight: bold !important;
  position: relative;
}

.ag-grid-container .ag-cell.highlighted-cell::after {
  content: '✨';
  position: absolute;
  top: 1px;
  right: 2px;
  font-size: 8px;
  opacity: 0.7;
}

/* Scrollbar styling for AG-Grid */
.ag-grid-container .ag-body-horizontal-scroll {
  scrollbar-width: thin;
  scrollbar-color: rgba(102, 126, 234, 0.3) transparent;
}

.ag-grid-container .ag-body-vertical-scroll {
  scrollbar-width: thin;
  scrollbar-color: rgba(102, 126, 234, 0.3) transparent;
}

.ag-grid-container .ag-body-horizontal-scroll::-webkit-scrollbar,
.ag-grid-container .ag-body-vertical-scroll::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

.ag-grid-container .ag-body-horizontal-scroll::-webkit-scrollbar-track,
.ag-grid-container .ag-body-vertical-scroll::-webkit-scrollbar-track {
  background: transparent;
}

.ag-grid-container .ag-body-horizontal-scroll::-webkit-scrollbar-thumb,
.ag-grid-container .ag-body-vertical-scroll::-webkit-scrollbar-thumb {
  background: rgba(102, 126, 234, 0.3);
  border-radius: 2px;
}

.ag-grid-container .ag-body-horizontal-scroll::-webkit-scrollbar-thumb:hover,
.ag-grid-container .ag-body-vertical-scroll::-webkit-scrollbar-thumb:hover {
  background: rgba(102, 126, 234, 0.5);
}

/* Dark theme adjustments */
[data-theme="dark"] .ag-grid-container .ag-theme-alpine {
  --ag-background-color: var(--card-bg);
  --ag-odd-row-background-color: var(--card-bg);
  --ag-row-hover-color: rgba(255, 255, 255, 0.05);
}

/* Notification pop-up */
.swipe-notification {
  position: absolute;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--secondary-background-color);
  color: var(--text-color);
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid var(--primary-color);
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 1000;
  pointer-events: none;
}

.swipe-notification.visible {
  opacity: 1;
}
