database: golden
table_name: dim_category__scd1
owner: hungdv336
description: Bảng Fact chứa thông tin danh mục SLA HelpDesk
engine: ReplacingMergeTree(subcategory_id)
order_by: subcategory_id
# rebuild: True
sources:
  categorydefinition:
    select_columns: [categoryid, categoryname, categorydescription]
    transformations:
      - function: split_str_col_to_columns
        input_cols: categoryname
        output_col1: category_code
        output_col2: category_name
      - function: rename_columns
        input_cols:
          categoryid: category_id
      

  subcategorydefinition:
    transformations:
      - function: replace_column_values
        input_cols: name
        replace_values:
          Other Requests: '01.Other Requests'
      - function: split_str_col_to_columns
        input_cols: name
        output_col1: subcategory_code
        output_col2: subcategory_name
      - function: convert_str_bool_columns
        input_cols: isdeleted
      - function: rename_columns
        input_cols:
          description: subcategory_description
          subcategoryid: subcategory_id
          categoryid: category_id

join_configs:
  final:
    main: subcategorydefinition
    name: final_result
    other: 
      - table_name: categorydefinition
        on_condition: category_id
        how: left
    select_columns: [subcategory_id, category_id, subcategory_code, subcategory_name, category_code, category_name, subcategory_description, isdeleted]
    transformations:
      - function: replace_null_or_empty
        input_cols: subcategory_description
        fallback_col: categorydescription
