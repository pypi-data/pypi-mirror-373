name: jett
services:
  airflow:
    image: airflow-standalone-local
    container_name: airflow-dev
    build:
      context: ..
      dockerfile: ./.container/Dockerfile
      args:
        AIRFLOW_VERSION: ${AIRFLOW_VERSION:-2.11.0}
        PYTHON_VERSION: ${PYTHON_VERSION:-3.10}
    ports:
      - "8080:8080"
    entrypoint: /bin/bash
    command:
      - -c
      - |
        airflow standalone
#        airflow db migrate
#        airflow users create \
#            --username admin \
#            --firstname Peter \
#            --lastname Parker \
#            --role Admin \
#            --email spiderman@superhero.org
#        airflow webserver --port 8080
#        airflow scheduler
    environment:
      AIRFLOW_HOME: "/opt/airflow"
      AIRFLOW_CONFIG: "/opt/airflow/airflow.cfg"
      AIRFLOW_ENV: "${AIRFLOW_ENV:-dev}"
    volumes:
      - ${AIRFLOW_PROJ_DIR:-.}/dags:/opt/airflow/dags
      - ${AIRFLOW_PROJ_DIR:-.}/logs:/opt/airflow/logs
      - ${AIRFLOW_PROJ_DIR:-.}/.container/airflow.standalone.cfg:/opt/airflow/airflow.cfg
      - ${AIRFLOW_PROJ_DIR:-.}/.container/airflow_local_settings.py:/opt/airflow/config/airflow_local_settings.py
      # NOTE: Mount tool package suppose as it use GitSync on production instead
      #   of install via Python package.
      # - ${AIRFLOW_PROJ_DIR:-.}/jett:/opt/airflow/plugins/jett
      - ${AIRFLOW_PROJ_DIR:-.}/assets/data:/opt/airflow/data
