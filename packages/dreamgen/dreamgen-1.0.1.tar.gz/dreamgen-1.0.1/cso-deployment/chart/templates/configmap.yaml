apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "continuous-image-gen.fullname" . }}-config
  labels:
    {{- include "continuous-image-gen.labels" . | nindent 4 }}
data:
  app-config.yaml: |
    # Application Configuration
    environment: {{ .Values.global.cso.environment }}
    debug: false
    
    # Backend Configuration
    backend:
      host: 0.0.0.0
      port: 8000
      workers: 2
      reload: false
      
    # Model Configuration
    models:
      flux_model: {{ .Values.backend.env.FLUX_MODEL | default "black-forest-labs/FLUX.1-schnell" }}
      use_mock: {{ .Values.backend.env.USE_MOCK_GENERATOR | default "true" }}
      cache_dir: {{ .Values.storage.models.mountPath | default "/app/models" }}
      
    # Plugin Configuration
    plugins:
      enabled: true
      directory: /app/src/plugins
      active:
        - time_context
        - holiday_context
        - style_enhancer
        
    # Storage Configuration
    storage:
      output_dir: {{ .Values.storage.output.mountPath | default "/app/output" }}
      max_files: 1000
      cleanup_days: 30
      
    # Monitoring
    monitoring:
      metrics_enabled: {{ .Values.monitoring.metrics.enabled }}
      metrics_port: {{ .Values.monitoring.metrics.port }}
      tracing_enabled: {{ .Values.monitoring.tracing.enabled }}
      
  frontend-config.json: |
    {
      "apiUrl": "{{ .Values.frontend.env.NEXT_PUBLIC_API_URL }}",
      "environment": "{{ .Values.global.cso.environment }}",
      "features": {
        "gallery": true,
        "plugins": true,
        "batchGeneration": false,
        "advancedSettings": {{ if eq .Values.global.cso.environment "production" }}false{{ else }}true{{ end }}
      },
      "ui": {
        "theme": "dark",
        "animations": true,
        "maxImageSize": "50MB"
      }
    }