# Production overrides for continuous-image-gen CSO module
# These values override the defaults in values.yaml for production environments

global:
  cso:
    environment: production
    domain: agenticinsights.com

## Backend - Production Configuration
backend:
  replicaCount: 2
  
  image:
    tag: "1.0.0"  # Pin to specific version
    pullPolicy: Always
  
  resources:
    requests:
      cpu: 2000m
      memory: 8Gi
    limits:
      cpu: 4000m
      memory: 16Gi
  
  env:
    USE_MOCK_GENERATOR: "false"  # Use real models in production
    MOCK_MODE: "false"
    LOG_LEVEL: "WARNING"
    FLUX_MODEL: "black-forest-labs/FLUX.1-schnell"  # Commercial-friendly model
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 60
    targetMemoryUtilizationPercentage: 70

## Frontend - Production Configuration  
frontend:
  replicaCount: 3
  
  image:
    tag: "1.0.0"
    pullPolicy: Always
  
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  
  env:
    NODE_ENV: "production"
    NEXT_PUBLIC_API_URL: "https://image-gen.agenticinsights.com/api"

## Production Ingress
ingress:
  hosts:
    - host: image-gen.agenticinsights.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: backend
  tls:
    - secretName: image-gen-prod-tls
      hosts:
        - image-gen.agenticinsights.com

## Production Storage
storage:
  models:
    storageClass: fast-ssd-retain
    size: 200Gi  # Larger for production models
  
  output:
    storageClass: standard-retain
    size: 100Gi  # More space for generated images

## Production Database
database:
  external:
    enabled: true
    host: postgres.agenticinsights.com
    port: 5432
    database: imagegen_prod
    username: imagegen_prod
    existingSecret: postgres-prod-secret

postgresql:
  enabled: false  # Use external database in production

## Production Authentication
auth:
  oauth2Proxy:
    providerUrl: https://auth.agenticinsights.com/realms/production
    redirectUrl: https://image-gen.agenticinsights.com/oauth2/callback
    cookieDomain: .agenticinsights.com
    
    # Restrict to organization emails
    emailDomains:
      - agenticinsights.com

## Production Monitoring
monitoring:
  metrics:
    serviceMonitor:
      interval: 15s  # More frequent in production
  
  alerts:
    enabled: true
    rules:
      - name: ImageGenerationFailureRate
        expr: rate(image_generation_failures_total[5m]) > 0.05  # Stricter threshold
        severity: critical
      - name: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 5
        severity: warning
      - name: PodMemoryPressure
        expr: container_memory_usage_bytes / container_spec_memory_limit_bytes > 0.85
        severity: warning
  
  tracing:
    samplingRate: 0.01  # Lower sampling in production

## Production Security
security:
  networkPolicy:
    enabled: true
    
    # Stricter egress rules in production
    egress:
      # DNS
      - to:
          - namespaceSelector: {}
            podSelector:
              matchLabels:
                k8s-app: kube-dns
        ports:
          - protocol: UDP
            port: 53
      # Internal services only
      - to:
          - namespaceSelector:
              matchLabels:
                environment: production
      # Hugging Face API (specific IPs if known)
      - to:
          - ipBlock:
              cidr: 52.84.0.0/16  # CloudFront for Hugging Face
        ports:
          - protocol: TCP
            port: 443

## Production Backup
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # Keep 30 days of backups
  storageLocation: s3://backups.agenticinsights.com/continuous-image-gen

## Production Node Selection
nodeSelector:
  workload: gpu  # Schedule on GPU nodes if available
  
tolerations:
  - key: nvidia.com/gpu
    operator: Exists
    effect: NoSchedule

affinity:
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: instance-type
              operator: In
              values:
                - g4dn.xlarge
                - g4dn.2xlarge