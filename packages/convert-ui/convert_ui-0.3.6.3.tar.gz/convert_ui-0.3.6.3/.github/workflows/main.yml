name: Build and Publish Python Package

# 触发条件
on:
  release:
    types: [published]  # 创建或发布 release 都触发

permissions:
  contents: read                 # 读取仓库内容
  packages: write                # 上传 PyPI 需要

jobs:
  build-and-publish:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ 拉取代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ 设置 Python
      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      # 3️⃣ 安装 build 和 twine
      - name: Install build and twine
        run: |
          python -m pip install --upgrade pip
          pip install build twine

      # 4️⃣ Build + Upload，仅在 release 时
      - name: Build and Upload to PyPI
        env:
          TWINE_USERNAME: __token__                 # 固定值
          TWINE_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}  # 你在仓库里设置的 PyPI token
        run: |
          python -m build
          twine upload dist/*
