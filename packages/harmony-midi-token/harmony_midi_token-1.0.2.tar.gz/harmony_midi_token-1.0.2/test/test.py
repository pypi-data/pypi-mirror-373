from HarmonyMIDIToken import HarmonyMIDIToken as Tokenizer
import json

MIDI = Tokenizer()

#MIDI.set_id([128, 100, 10, -1, 2, 10, 3, -1, 10, 10, 81, 10, -1, 10, 84, 1, 81, 10, -1, 79, 10, 10, 10, -1, 1, 2, 10, 1, 2, 1, 1, 79, 10, 10, 1, 10, 84, 2, 1, 86, 1, 84, 1, 84, 83, 10, 10, 1, 84, 83, -1, 10, 10, 10, -1, 10, -1, 2, 10, 10, -1, 10, 10, 81, 1, 83, 1, 10, 1, 10, 1, 81, 1, 10, 2, 10, 10, 10, 84, 10, -1, 1, 84, 10, -1, 10, 10, 1, 10, 10, 84, 1, 10, -1, 1, 2, 2, 10, 2, 83, 3, 10, 84, 10, 10, -1, 84, 83, 81, 2, 2, 10, 10, 10, 10, -1, 10, 81, 79, 2, 2, 1, 84, 10, 10, 10, 1, 1, 10, 10, 10, 1, 3, 81, 10, 10, 1, 2, 2, 10, 84, 2, 79, 1, 10, 91, -1, 86, 81, 84, -1, 84, 10, -1, 10, 2, 10, 10, 10, 84, 83, 79, 10, -1, -1, 1, 3, 10, 84, 1, 84, 2, 10, 1, -1, 10, 10, 81, 84, 10, 83, 2, 84, 1, 10, 2, 10, 3, -1, 10, 2, 1, 84, 1, 84, 84, 10, 10, 86, 10, 84, 83, 2, 3, -1, 10, 3, 91, 84, 10, 84, 2, 10, 10, 10, 83, 84, 84, 2, 10, 10, 10, 10, 91, 84, 10, 2, 2, 2, 1, 2, 60, 2, 65, 20, 1, 200, 1, 1, 2, 2, 2, 2, 3, 20, 1, 1, 20, 1, 3, 1, 1, 1, 20, -1, 2, 1, 2, 1, 20, 60, 1, 1, 20, 20, 1, 20, 8, 1, 8, 20, 8, 20, 1, 1, 20, -1, 20, 1, -1, 60, 1, 8, 60, 2, 2, -1, 8, 20, -1, 60, -1, -1, 60, 1, 8, 20, 60, 20, 60, 20, 65, 8, 20, 5, -1, 60, 20, 67, 60, 69, -1, 8, 1, -1, 69, 65, 69, 20, 20, 69, 2, 5, -1, 20, 5, 8, 2, 69, 2, 1, 5, -1, 67, 20, -1, 5, 69, 20, 2, 20, 2, 2, 1, 69, -1, 2, 2, 1, 8, 8, 67, 5, 2, 20, 65, 1, 3, 20, 1, 2, 20, 67, 1, -1, -1, 20, 2, 65, -1, 67, 300, 20, 1, 2, 1, -1, 1, 20, 1, 20, 67, 60, 20, 65, 20, -1, 20, -1, 67, -1, 20, 1, 5, 2, 20, 20, -1, 20, -1, 69, 20, 20, 20, -1, -1, -1, 2, -1, 1, 1, -1, -1, 2, 2, 1, 2, 2, 20, 1, 1, -1, 20, 2, 3, 67, 2, 20, 60, -1, 2, 1, 60, -1, 1, 20, 20, 20, 20, 1, 69, -1, 1, 2, -1, 60, 20, 2, 60, 65, -1, 8, -1, 20, -1, 20, 4, 2, 20, -1, 20, 20, 8, 65, 5, 1, 8, -1, 69, 1, 20, 1, 69, -1, 1, 67, 69, 20, 8, -1, 2, 1, 2, -1, 1, -1, 2, -1, 1, 67, 65, 20, 1, 67, 20, 65, 20, 5, 2, 2, 1, 2, -1, -1, -1, 67, -1, 2, 65, -1, 1, 67])
MIDI.set_midi('test/test2.mid')
MIDI._midi = None  # Reset MIDI to None to test the generation of MIDI from stored values
print(MIDI.token_id)  # Print the token ID to verify the output

print(MIDI.to_json())
with open('test/test.json', 'w') as f:
    dic = json.loads(MIDI.to_json())

    dic["Melody"] = dic["Melody"][:3]
    dic["Chord"] = dic["Chord"][:3]
    dic["Bass"] = dic["Bass"][:3] # 예시용 json이라 대충 자름

    f.write(json.dumps(dic))

# midi= MIDI.to_midi() # This should generate MIDI from the stored melody and chords
# midi.write('midi', fp='test/test_output.mid')  # Save the generated MIDI to a file
