<?php

/**
 * Name: {{host_name | default(plugin_name)}}
 * Description: {{host_name | default(plugin_name)}}
 * PID: {{pid}} force
 * Dependencies: vericred_service_main
 */

require_once __DIR__ . '/../vericred_service_main/vericred_service_main.php';

class {{plugin_name}} extends vericred_service_main {
    protected $colHeaders = {{col_headers}};
    protected $baseUrl = '{{base_url}}';
    protected $domainUrl = '{{domain_url}}';
    private $cache;
    private $count;
    private $limit;

    public function __construct() {
        parent::__construct();
        $this->limit = 500;
        $this->count = 0;

        //$this->cache = new Vtx_Service_Data_Cache(__CLASS__);
        
    }

    public function newSession() {
        $this->resetCurl(true);
        $this->useProxy = true;

        /*
        $holaZone = 'grepsr';
        $holaCountry = 'US';
        if (method_exists($this, 'enableProxy')) {
            $this->enableProxy('HOLA', $holaCountry, $holaZone);
        } else {
            $this->resetHolaSuperProxy();
            $this->enableHola($holaCountry);
            $this->setHolaZone($holaZone);
        }
        */

        $this->setHeaders('Accept-Encoding', 'gzip, deflate, br');
        $this->setHeaders('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8');
        $this->setHeaders('Accept-Language', 'en-US,en;q=0.5');
        $this->setHeaders('Connection', 'keep-alive');
        $this->setHeaders('Upgrade-Insecure-Requests', '1');
        $this->setHeaders('User-Agent', 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36');

        //$this->setCurlOption(CURLOPT_CONNECTTIMEOUT, 180);
        //$this->setCurlOption(CURLOPT_TIMEOUT, 180);
    }

    public function main($params) {
	    echo("Crawling : " . $this->domainUrl . PHP_EOL);
        $this->dataSet->setPageName(get_class($this) . '_%s', [date('Ymd')]);
        $this->newSession();
        $this->switchProxy();

        //$this->loadDocument($this->baseUrl);

        return $this;
    }
}