#!/bin/bash

# VW2PX - –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./run_converter.sh [–ø—É—Ç—å_–∫_–ø—Ä–æ–µ–∫—Ç—É] [viewport] [dry_run]

echo "üöÄ VW2PX - –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫"
echo "========================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå –û—à–∏–±–∫–∞: Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
if [ ! -f "vw2px/converter.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª vw2px/converter.py –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
PROJECT_PATH=${1:-"."}
VIEWPORT=${2:-1920}
DRY_RUN=${3:-"--dry-run"}

# –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É, —É–±–∏—Ä–∞–µ–º dry-run
if [ "$1" != "" ]; then
    DRY_RUN=""
fi

echo "üìÅ –ü—Ä–æ–µ–∫—Ç: $PROJECT_PATH"
echo "üñ•Ô∏è  Viewport: ${VIEWPORT}px"
echo "üîç –†–µ–∂–∏–º: $([ -z "$DRY_RUN" ] && echo "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–º–µ–Ω" || echo "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä")"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä
python3 vw2px/converter.py --path "$PROJECT_PATH" --viewport "$VIEWPORT" $DRY_RUN

echo ""
echo "‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!"
